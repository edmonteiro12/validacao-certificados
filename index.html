<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#8B4513">
    <title>BBB FESTA - SISTEMA</title>
    <link rel="" type="" href="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k=">
    <link rel="manifest" href="manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #FF69B4 0%, #DDA0DD 25%, #FFB6C1 50%, #E6E6FA 75%, #FF69B4 100%);
            background-attachment: fixed;
            min-height: 100vh;
            color: #333;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(255, 215, 0, 0.8) 2px, transparent 2px),
                radial-gradient(circle at 85% 75%, rgba(255, 255, 255, 0.9) 1px, transparent 1px),
                radial-gradient(circle at 45% 15%, rgba(255, 182, 193, 0.7) 3px, transparent 3px),
                radial-gradient(circle at 25% 85%, rgba(221, 160, 221, 0.8) 2px, transparent 2px),
                radial-gradient(circle at 75% 35%, rgba(255, 255, 255, 0.6) 1px, transparent 1px),
                radial-gradient(circle at 55% 65%, rgba(255, 215, 0, 0.5) 2px, transparent 2px);
            background-size: 80px 80px, 60px 60px, 100px 100px, 70px 70px, 50px 50px, 90px 90px;
            animation: glitterMove 4s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }
        @keyframes glitterMove {
            0%, 100% { opacity: 0.8; transform: translateX(0) translateY(0); }
            25% { opacity: 1; transform: translateX(2px) translateY(-2px); }
            50% { opacity: 0.9; transform: translateX(-1px) translateY(1px); }
            75% { opacity: 1; transform: translateX(1px) translateY(-1px); }
        }
        .login-screen, .main-screen { display: none; }
        .login-screen.active, .main-screen.active { display: block; }
        
        .login-container {
            background: linear-gradient(145deg, rgba(255,255,255,0.95) 0%, rgba(248,240,255,0.95) 50%, rgba(255,224,240,0.95) 100%);
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            max-width: 450px;
            margin: 5rem auto;
            border: 2px solid rgba(255, 182, 193, 0.5);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1), 0 0 20px rgba(255, 215, 0, 0.2);
        }
        .login-title {
            color: #333;
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .navbar {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(221,160,221,0.3) 30%, rgba(255,182,193,0.3) 70%, rgba(255,255,255,0.9) 100%);
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255, 182, 193, 0.3);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05), 0 0 15px rgba(255, 215, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        .navbar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255,255,255,0.8) 1px, transparent 1px),
                radial-gradient(circle at 80% 80%, rgba(221,160,221,0.6) 1px, transparent 1px),
                radial-gradient(circle at 40% 60%, rgba(255,182,193,0.6) 1px, transparent 1px),
                radial-gradient(circle at 60% 40%, rgba(255,255,255,0.9) 1px, transparent 1px);
            background-size: 30px 30px, 25px 25px, 35px 35px, 20px 20px;
            animation: glitter 3s ease-in-out infinite;
            pointer-events: none;
        }
        @keyframes glitter {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        .navbar h1 {
            color: #333;
            text-align: center;
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            position: relative;
            z-index: 2;
        }
        .logo-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(255, 105, 180, 0.3);
        }
        .nav-menu {
            display: none;
        }
        .sidebar {
            position: absolute;
            left: 20px;
            top: 120px;
            width: 200px;
            z-index: 1000;
        }
        
        .widgets-panel {
            position: absolute;
            right: 20px;
            top: 120px;
            width: 300px;
            z-index: 1000;
        }
        
        .widget {
            background: linear-gradient(145deg, rgba(255,255,255,0.95) 0%, rgba(248,240,255,0.95) 100%);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 182, 193, 0.3);
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }
        
        .widget h4 {
            color: #8B4513;
            margin-bottom: 0.5rem;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .clock-display {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            color: #333;
            margin: 0.5rem 0;
        }
        
        .date-display {
            font-size: 0.9rem;
            text-align: center;
            color: #666;
        }
        
        .alarm-input {
            width: 100%;
            padding: 0.3rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 0.3rem 0;
            font-size: 0.8rem;
        }
        
        .alarm-btn {
            width: 100%;
            padding: 0.4rem;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .weather-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.3rem 0;
            border-bottom: 1px solid #eee;
            font-size: 0.8rem;
        }
        
        .weather-item:last-child {
            border-bottom: none;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            font-size: 0.7rem;
        }
        
        .calendar-day {
            padding: 0.2rem;
            text-align: center;
            border: 1px solid #eee;
            cursor: pointer;
        }
        
        .calendar-day.today {
            background: #007bff;
            color: white;
        }
        
        .calendar-day.other-month {
            color: #ccc;
        }
        .sidebar-btn {
            display: block;
            width: 100%;
            background: #ffffff;
            color: #333;
            padding: 0.8rem;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid #dee2e6;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            text-align: left;
        }
        .sidebar-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        .sidebar-submenu {
            display: none;
            margin-left: 1rem;
            margin-bottom: 0.5rem;
        }
        .sidebar-submenu.active {
            display: block;
        }
        .sidebar-subbtn {
            display: block;
            width: 100%;
            background: #f8f9fa;
            color: #666;
            padding: 0.6rem;
            text-decoration: none;
            border-radius: 4px;
            font-weight: 400;
            cursor: pointer;
            border: 1px solid #e9ecef;
            font-size: 0.8rem;
            margin-bottom: 0.3rem;
            text-align: left;
        }
        .sidebar-subbtn:hover {
            background: #e9ecef;
        }
        .btn-danger {
            background: #dc3545 !important;
            color: white !important;
            border-color: #dc3545 !important;
        }
        .btn-danger:hover {
            background: #c82333 !important;
            border-color: #c82333 !important;
        }
        @media (max-width: 768px) {
            .sidebar {
                position: relative;
                right: auto;
                top: auto;
                width: 100%;
                margin-bottom: 2rem;
            }
            .widgets-panel {
                position: relative;
                right: auto;
                top: auto;
                width: 100%;
                margin-bottom: 2rem;
            }
            .container {
                margin-left: 1rem;
                margin-right: 1rem;
                margin-top: 120px;
            }
        }
        .nav-btn {
            background: #ffffff;
            color: #333;
            padding: 0.5rem 1rem;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid #dee2e6;
            font-size: 0.9rem;
        }
        .nav-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
            border-color: #c82333;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            margin-left: 240px;
            margin-right: 340px;
            margin-top: 120px;
        }
        .card {
            background: linear-gradient(145deg, rgba(255,255,255,0.95) 0%, rgba(248,240,255,0.95) 100%);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08), 0 0 20px rgba(255, 215, 0, 0.1);
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 182, 193, 0.3);
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 500;
            color: #495057;
            font-size: 0.9rem;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 0.9rem;
            background: white;
            transition: border-color 0.2s ease;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 0.6rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn:hover {
            background: #0056b3;
        }
        .error { color: #B22222; margin-bottom: 1rem; padding: 1rem; background: #F8D7DA; border-radius: 5px; }
        .success { color: #155724; margin-bottom: 1rem; padding: 1rem; background: #D4EDDA; border-radius: 5px; }
        
        .page { display: none; }
        .page.active { display: block; }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .dashboard-card {
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .dashboard-card h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .dashboard-card .count {
            font-size: 3rem;
            font-weight: bold;
            margin: 1rem 0;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .menu-item {
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            color: white;
            transition: all 0.2s ease;
        }
        .menu-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div class="login-screen active" id="loginScreen">
        <div class="login-container">
            <div style="margin-bottom: 1rem;">
                <img src="c:\Users\Admin\Downloads\IMG_20251002_215210.jpg" alt="BBB FESTA" style="width: 80px; height: 80px; border-radius: 50%; margin-bottom: 1rem; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);">
            </div>
            <h1 class="login-title">
                <span></span>
                BBB FESTA
                <span></span>
            </h1>
            <p style="color: #666; font-size: 1.2rem; margin-bottom: 2rem;">Cadastro de Eventos</p>
            
            <div id="loginError" class="error" style="display: none;"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Usu√°rio:</label>
                    <input type="text" id="username" name="username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                
                <button type="submit" class="btn">Entrar</button>
            </form>
            
            <div style="margin-top: 2rem; padding: 1rem; background: #f0f8ff; border-radius: 10px; font-size: 0.9rem; color: #666;">
                <strong>Credenciais de acesso:</strong><br>
                ‚Ä¢ admin / admin123<br>
                ‚Ä¢ ed / 1986<br>
                ‚Ä¢ teste / adm123
            </div>
        </div>
    </div>

    <!-- Tela Principal -->
    <div class="main-screen" id="mainScreen">
        <nav class="navbar">
            <h1>
                <img src="c:\Users\Admin\Downloads\IMG_20251002_215210.jpg" alt="BBB FESTA" class="logo-icon">
                BBB FESTA - S
            </h1>
        </nav>
        
        <div class="sidebar">
            <button class="sidebar-btn" onclick="showPage('dashboard')">üè† Dashboard</button>
            
            <button class="sidebar-btn" onclick="toggleSubmenu('eventos-menu')">üéâ Eventos</button>
            <div id="eventos-menu" class="sidebar-submenu">
                <button class="sidebar-subbtn" onclick="showPage('reservar_evento')">Reservar Evento</button>
                <button class="sidebar-subbtn" onclick="showPage('todos_eventos')">Todos os Eventos</button>
                <button class="sidebar-subbtn" onclick="showPage('eventos_futuros')">Eventos Futuros</button>
                <button class="sidebar-subbtn" onclick="showPage('confirmar_dados')">Confirmar Dados</button>
                <button class="sidebar-subbtn" onclick="showPage('escalas')">Escalas</button>
                <button class="sidebar-subbtn" onclick="showPage('relatorios')">Relat√≥rios</button>
                <button class="sidebar-subbtn btn-danger" onclick="excluirTodosEventos()">üóëÔ∏è Excluir Todos</button>
            </div>
            
            <button class="sidebar-btn" onclick="toggleSubmenu('personagens-menu')">ü¶Å Personagens</button>
            <div id="personagens-menu" class="sidebar-submenu">
                <button class="sidebar-subbtn" onclick="showPage('cadastro_personagens')">Cadastro</button>
                <button class="sidebar-subbtn" onclick="showPage('lista_personagens')">Lista</button>
                <button class="sidebar-subbtn btn-danger" onclick="excluirTodosPersonagens()">üóëÔ∏è Excluir Todos</button>
            </div>
            
            <button class="sidebar-btn" onclick="toggleSubmenu('elenco-menu')">üé≠ Elenco</button>
            <div id="elenco-menu" class="sidebar-submenu">
                <button class="sidebar-subbtn" onclick="showPage('cadastro_elenco')">Cadastro</button>
                <button class="sidebar-subbtn" onclick="showPage('lista_elenco')">Lista</button>
                <button class="sidebar-subbtn btn-danger" onclick="excluirTodoElenco()">üóëÔ∏è Excluir Todos</button>
            </div>
            
            <button class="sidebar-btn" onclick="toggleSubmenu('motoristas-menu')">üöó Motoristas</button>
            <div id="motoristas-menu" class="sidebar-submenu">
                <button class="sidebar-subbtn" onclick="showPage('cadastro_motoristas')">Cadastro</button>
                <button class="sidebar-subbtn" onclick="showPage('lista_motoristas')">Lista</button>
                <button class="sidebar-subbtn btn-danger" onclick="excluirTodosMotoristas()">üóëÔ∏è Excluir Todos</button>
            </div>
            
            <button class="sidebar-btn" onclick="toggleSubmenu('casas-menu')">üè† Casa de Festas</button>
            <div id="casas-menu" class="sidebar-submenu">
                <button class="sidebar-subbtn" onclick="showPage('cadastro_casas')">Cadastro</button>
                <button class="sidebar-subbtn" onclick="showPage('lista_casas')">Lista</button>
                <button class="sidebar-subbtn btn-danger" onclick="excluirTodasCasas()">üóëÔ∏è Excluir Todos</button>
            </div>
            
            <button class="sidebar-btn" onclick="toggleSubmenu('clientes-menu')">üë• Clientes</button>
            <div id="clientes-menu" class="sidebar-submenu">
                <button class="sidebar-subbtn" onclick="showPage('cadastro_clientes')">Cadastro</button>
                <button class="sidebar-subbtn" onclick="showPage('lista_clientes')">Lista</button>
                <button class="sidebar-subbtn btn-danger" onclick="excluirTodosClientes()">üóëÔ∏è Excluir Todos</button>
            </div>
            
            <button class="sidebar-btn" onclick="toggleSubmenu('manutencao-menu')">üîß Manuten√ß√£o</button>
            <div id="manutencao-menu" class="sidebar-submenu">
                <button class="sidebar-subbtn" onclick="showPage('cadastro_manutencao')">Cadastro</button>
                <button class="sidebar-subbtn" onclick="showPage('lista_manutencao')">Lista</button>
                <button class="sidebar-subbtn btn-danger" onclick="excluirTodasManutencoes()">üóëÔ∏è Excluir Todos</button>
            </div>
            
            <button class="sidebar-btn" onclick="toggleSubmenu('financeiro-menu')">üí∞ Financeiro</button>
            <div id="financeiro-menu" class="sidebar-submenu">
                <button class="sidebar-subbtn" onclick="showPage('pagamentos_receber')">Pagamentos a Receber</button>
                <button class="sidebar-subbtn" onclick="showPage('pagamentos_pagos')">Pagamentos Pagos</button>
                <button class="sidebar-subbtn" onclick="showPage('fechamento_mensal')">Fechamento Mensal</button>
                <button class="sidebar-subbtn" onclick="showPage('pagamento_caches')">Pagamento de Cach√™s</button>
                <button class="sidebar-subbtn" onclick="excluirDadosFinanceiros()">üóëÔ∏è Excluir Dados</button>
                <button class="sidebar-subbtn" onclick="gerarRelatorioEventos()">üìä Relat√≥rio Eventos</button>
                <button class="sidebar-subbtn" onclick="gerarRelatorioPersonagens()">üìä Relat√≥rio Personagens</button>
                <button class="sidebar-subbtn" onclick="gerarRelatorioElenco()">üìä Relat√≥rio Elenco</button>
                <button class="sidebar-subbtn" onclick="gerarRelatorioMotoristas()">üìä Relat√≥rio Motoristas</button>
                <button class="sidebar-subbtn" onclick="gerarRelatorioCasas()">üìä Relat√≥rio Casas</button>
                <button class="sidebar-subbtn" onclick="gerarRelatorioClientes()">üìä Relat√≥rio Clientes</button>
                <button class="sidebar-subbtn" onclick="gerarRelatorioManutencao()">üìä Relat√≥rio Manuten√ß√£o</button>
                <button class="sidebar-subbtn" onclick="gerarRelatorioFinanceiro()">üìä Relat√≥rio Financeiro</button>
            </div>
            
            <button class="sidebar-btn" onclick="toggleSubmenu('config-menu')">‚öôÔ∏è Configura√ß√µes</button>
            <div id="config-menu" class="sidebar-submenu">
                <button class="sidebar-subbtn" onclick="showPage('cadastro_usuarios')">Cadastro de Usu√°rios</button>
                <button class="sidebar-subbtn" onclick="showPage('usuarios_cadastrados')">Usu√°rios Cadastrados</button>
            </div>
            
            <button class="sidebar-btn btn-danger" onclick="logout()">üö™ Sair</button>
        </div>
        
        <!-- Widgets Panel -->
        <div class="widgets-panel">
            <!-- Previs√£o para Locais de Eventos -->
            <div class="widget">
                <h4>üéâ Tempo nos Eventos</h4>
                <div id="eventWeatherDisplay">Carregando previs√µes...</div>
            </div>
            
            <!-- Rel√≥gio Digital -->
            <div class="widget">
                <h4>üïê Rel√≥gio</h4>
                <div class="clock-display" id="clockDisplay">00:00:00</div>
                <div class="date-display" id="dateDisplay">--/--/----</div>
            </div>
            
            <!-- Calend√°rio -->
            <div class="widget">
                <h4>üìÖ Calend√°rio</h4>
                <div style="text-align: center; margin-bottom: 0.5rem;">
                    <button onclick="changeMonth(-1)" style="background: none; border: none; cursor: pointer;">‚óÄ</button>
                    <span id="monthYear" style="margin: 0 1rem; font-weight: bold;"></span>
                    <button onclick="changeMonth(1)" style="background: none; border: none; cursor: pointer;">‚ñ∂</button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
            
            <!-- Despertador -->
            <div class="widget">
                <h4>‚è∞ Despertador</h4>
                <input type="time" class="alarm-input" id="alarmTime" placeholder="Hora do alarme">
                <button class="alarm-btn" onclick="setAlarm()">Definir Alarme</button>
                <div id="alarmStatus" style="font-size: 0.8rem; text-align: center; margin-top: 0.5rem; color: #666;"></div>
            </div>
            
            <!-- Previs√£o do Tempo Geral -->
            <div class="widget">
                <h4>üå§Ô∏è Previs√£o do Tempo</h4>
                <div style="margin-bottom: 0.5rem;">
                    <input type="text" id="cityInput" placeholder="Digite a cidade" style="width: 70%; padding: 0.3rem; border: 1px solid #ddd; border-radius: 3px; font-size: 0.8rem;">
                    <button onclick="getWeather()" style="width: 25%; padding: 0.3rem; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 0.8rem;">üîç</button>
                </div>
                <div id="weatherDisplay">Digite uma cidade para ver a previs√£o</div>
            </div>
        </div>

        <div class="container">
            <!-- Dashboard -->
            <div class="page active" id="dashboard">
                <div class="card">
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">üè† DASHBOARD</h2>
                    <div class="dashboard-grid">
                        <div class="dashboard-card" style="background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);" onclick="showPage('personagens')">
                            <h3>ü¶Å Personagens</h3>
                            <div class="count" id="countPersonagens">0</div>
                            <p>Personagens cadastrados</p>
                        </div>
                        <div class="dashboard-card" style="background: linear-gradient(135deg, #228B22 0%, #32CD32 100%);" onclick="showPage('elenco')">
                            <h3>üé≠ Elenco</h3>
                            <div class="count" id="countElenco">0</div>
                            <p>Membros do elenco</p>
                        </div>
                        <div class="dashboard-card" style="background: linear-gradient(135deg, #DAA520 0%, #FFD700 100%);" onclick="showPage('motoristas')">
                            <h3>üöó Motoristas</h3>
                            <div class="count" id="countMotoristas">0</div>
                            <p>Motoristas cadastrados</p>
                        </div>
                        <div class="dashboard-card" style="background: linear-gradient(135deg, #CD853F 0%, #D2691E 100%);" onclick="showPage('casas_festas')">
                            <h3>üè† Casa de Festas</h3>
                            <div class="count" id="countCasas">0</div>
                            <p>Locais cadastrados</p>
                        </div>
                        <div class="dashboard-card" style="background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%);" onclick="showPage('clientes')">
                            <h3>üë• Clientes</h3>
                            <div class="count" id="countClientes">0</div>
                            <p>Clientes cadastrados</p>
                        </div>
                        <div class="dashboard-card" style="background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%);" onclick="showPage('eventos')">
                            <h3>üéâ Eventos</h3>
                            <div class="count" id="countEventos">0</div>
                            <p>Eventos cadastrados</p>
                        </div>
                        <div class="dashboard-card" style="background: linear-gradient(135deg, #fd7e14 0%, #dc3545 100%);" onclick="showPage('manutencao')">
                            <h3>üîß Manuten√ß√£o</h3>
                            <div class="count" id="countManutencao">0</div>
                            <p>Itens em manuten√ß√£o</p>
                        </div>
                        <div class="dashboard-card" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);" onclick="showPage('financeiro')">
                            <h3>üí∞ Financeiro</h3>
                            <div class="count" id="countFinanceiro">R$ 0</div>
                            <p>Controle financeiro</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Eventos -->
            <div class="page" id="eventos">
                <div class="card">
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">üéâ EVENTOS</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                        <div style="background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%); color: white; padding: 2rem; border-radius: 10px; text-align: center; cursor: pointer;" onclick="showPage('reservar_evento')">
                            <h3>üìÖ Reservar Evento</h3>
                            <p>Reserve novos eventos com clientes e locais</p>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #228B22 0%, #32CD32 100%); color: white; padding: 2rem; border-radius: 10px; text-align: center; cursor: pointer;" onclick="showPage('todos_eventos')">
                            <h3>üìã Todos os Eventos</h3>
                            <p>Visualize todos os eventos cadastrados</p>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #DAA520 0%, #FFD700 100%); color: white; padding: 2rem; border-radius: 10px; text-align: center; cursor: pointer;" onclick="showPage('eventos_futuros')">
                            <h3>üï∞Ô∏è Eventos Futuros</h3>
                            <p>Pr√≥ximos 15 eventos a partir de hoje</p>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 2rem; border-radius: 10px; text-align: center; cursor: pointer;" onclick="showPage('confirmar_dados')">
                            <h3>‚úÖ Confirmar Dados</h3>
                            <p>Eventos com sinal pago para confirma√ß√£o</p>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #6f42c1 0%, #e83e8c 100%); color: white; padding: 2rem; border-radius: 10px; text-align: center; cursor: pointer;" onclick="showPage('escalas')">
                            <h3>üìÖ Escalas</h3>
                            <p>Gerenciamento de escala√ß√µes</p>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%); color: white; padding: 2rem; border-radius: 10px; text-align: center; cursor: pointer;" onclick="showPage('relatorios')">
                            <h3>üìä Relat√≥rios</h3>
                            <p>Relat√≥rios de eventos e escala√ß√µes</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reservar Evento -->
            <div class="page" id="reservar_evento">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('eventos')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìÖ RESERVAR EVENTO</h2>
                    
                    <form id="eventoForm">
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">üë• DADOS DO CLIENTE</h3>
                        <div class="form-group">
                            <label>Tipo de Documento:</label>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <button type="button" id="btn_cpf_evento" onclick="selecionarTipoDocEvento('cpf')" style="background: #28a745; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">CPF</button>
                                <button type="button" id="btn_cnpj_evento" onclick="selecionarTipoDocEvento('cnpj')" style="background: #6c757d; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">CNPJ</button>
                            </div>
                            <input type="text" id="cpf_evento" name="cpf_cliente" placeholder="000.000.000-00" required maxlength="14">
                        </div>
                        <div class="form-group" id="campo_nome_empresa_evento" style="display: none;">
                            <label for="nome_empresa_evento">üè¢ Nome da Empresa:</label>
                            <input type="text" id="nome_empresa_evento" name="nome_empresa_evento" placeholder="Nome da empresa">
                        </div>
                        
                        <div id="dadosClienteEvento" style="display: none; margin-bottom: 2rem; padding: 1rem; background: #e9ecef; border-radius: 10px;">
                            <h5 style="color: #8B4513; margin-bottom: 0.5rem;">Dados do Cliente Encontrado:</h5>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
                                <div>
                                    <h5 style="color: #666; margin-bottom: 0.5rem;">Cliente:</h5>
                                    <p id="cliente_nome"></p>
                                    <p id="cliente_cpf"></p>
                                    <p id="cliente_idade"></p>
                                    <p id="cliente_telefone"></p>
                                    <p id="cliente_email"></p>
                                </div>
                                <div>
                                    <h5 style="color: #666; margin-bottom: 0.5rem;">Aniversariante:</h5>
                                    <p id="aniversariante_nome"></p>
                                    <p id="aniversariante_idade"></p>
                                </div>
                                <div>
                                    <h5 style="color: #666; margin-bottom: 0.5rem;">Endere√ßo:</h5>
                                    <p id="cliente_endereco"></p>
                                    <p id="cliente_bairro"></p>
                                    <p id="cliente_cidade"></p>
                                </div>
                            </div>
                        </div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">üè† LOCAL DO EVENTO</h3>
                        <div style="display: grid; grid-template-columns: 1fr auto; gap: 1rem; margin-bottom: 1rem;">
                            <div class="form-group">
                                <label for="casa_festa">Casa de Festas:</label>
                                <select id="casa_festa" name="casa_festa">
                                    <option value="">Selecione uma casa de festas</option>
                                </select>
                            </div>
                            <div style="display: flex; align-items: end;">
                                <button type="button" id="btn_outro_local" onclick="ativarOutroLocal()" class="btn" style="padding: 0.75rem 1.5rem; background: #ffc107; color: black;">üè† Outro Local</button>
                            </div>
                        </div>
                        
                        <div id="campos_outro_local" style="display: none; margin-bottom: 2rem;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="form-group">
                                    <label for="cep_evento">CEP do Local:</label>
                                    <input type="text" id="cep_evento" name="cep_evento" placeholder="00000-000">
                                </div>
                                <div class="form-group">
                                    <label for="endereco_evento">Endere√ßo:</label>
                                    <input type="text" id="endereco_evento" name="endereco_evento">
                                </div>
                                <div class="form-group">
                                    <label for="numero_evento">N√∫mero:</label>
                                    <input type="text" id="numero_evento" name="numero_evento">
                                </div>
                                <div class="form-group">
                                    <label for="complemento_evento">Complemento:</label>
                                    <input type="text" id="complemento_evento" name="complemento_evento">
                                </div>
                                <div class="form-group">
                                    <label for="bairro_evento">Bairro:</label>
                                    <input type="text" id="bairro_evento" name="bairro_evento">
                                </div>
                                <div class="form-group">
                                    <label for="cidade_evento">Cidade:</label>
                                    <input type="text" id="cidade_evento" name="cidade_evento">
                                </div>
                                <div class="form-group">
                                    <label for="estado_evento">Estado:</label>
                                    <input type="text" id="estado_evento" name="estado_evento">
                                </div>
                                <div class="form-group">
                                    <label for="telefone_evento">Telefone do Local:</label>
                                    <input type="text" id="telefone_evento" name="telefone_evento" placeholder="(00) 0000-0000">
                                </div>
                            </div>
                        </div>
                        
                        <div id="dados_casa_selecionada" style="display: none; margin-bottom: 2rem; padding: 1rem; background: #e9ecef; border-radius: 10px;">
                            <h5 style="color: #8B4513; margin-bottom: 0.5rem;">Dados da Casa Selecionada:</h5>
                            <div id="info_casa_selecionada"></div>
                        </div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">üìÖ DADOS DO EVENTO</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="form-group">
                                <label for="data_evento">Data do Evento:</label>
                                <input type="date" id="data_evento" name="data_evento" required>
                            </div>
                            <div class="form-group">
                                <label for="hora_entrada">Hora da Entrada:</label>
                                <input type="time" id="hora_entrada" name="hora_entrada" required>
                            </div>
                            <div class="form-group">
                                <label for="duracao">Dura√ß√£o (horas):</label>
                                <input type="number" id="duracao" name="duracao" min="1" max="12" required>
                            </div>
                            <div class="form-group">
                                <label for="hora_saida">Hora de Sa√≠da:</label>
                                <input type="time" id="hora_saida" name="hora_saida" readonly style="background: #f8f9fa;">
                            </div>
                        </div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">ü¶Å PERSONAGENS</h3>
                        <div style="display: grid; grid-template-columns: 1fr auto; gap: 1rem; margin-bottom: 1rem;">
                            <div class="form-group">
                                <label for="personagem_select">Selecionar Personagem:</label>
                                <select id="personagem_select" name="personagem_select">
                                    <option value="">Escolha um personagem</option>
                                </select>
                            </div>
                            <div style="display: flex; align-items: end;">
                                <button type="button" onclick="adicionarPersonagemEvento()" class="btn" style="padding: 0.75rem 1.5rem;">‚ûï Adicionar</button>
                            </div>
                        </div>
                        <div id="personagensSelecionados" style="margin-bottom: 2rem;"></div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">üí∞ VALORES</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                            <div class="form-group">
                                <label for="valor_sinal">Valor do Sinal:</label>
                                <input type="text" id="valor_sinal" name="valor_sinal" placeholder="R$ 0,00">
                            </div>
                            <div class="form-group">
                                <label for="forma_pagamento_sinal">Forma Pagamento Sinal:</label>
                                <select id="forma_pagamento_sinal" name="forma_pagamento_sinal">
                                    <option value="Dinheiro">Dinheiro</option>
                                    <option value="Cart√£o">Cart√£o</option>
                                    <option value="PIX">PIX</option>
                                    <option value="Transfer√™ncia">Transfer√™ncia</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="sinal_pago_status">Sinal Pago:</label>
                                <select id="sinal_pago_status" name="sinal_pago_status" onchange="toggleDataPagamentoSinal()">
                                    <option value="false">N√£o</option>
                                    <option value="true">Sim</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="dataPagamentoSinalDiv" style="display: none; margin-bottom: 1rem;">
                            <label>Data do Pagamento do Sinal:</label>
                            <input type="text" id="dataPagamentoSinal" readonly style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px; background: #f8f9fa;">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                            <div class="form-group">
                                <label for="pagamento_total_pago">Valor Restante Pago:</label>
                                <select id="pagamento_total_pago" name="pagamento_total_pago" onchange="toggleDataPagamentoRestante()">
                                    <option value="false">N√£o</option>
                                    <option value="true">Sim</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="dataPagamentoRestanteDiv" style="display: none; margin-bottom: 1rem;">
                            <label>Data do Pagamento Restante:</label>
                            <input type="text" id="dataPagamentoRestante" readonly style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px; background: #f8f9fa;">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                            <div class="form-group">
                                <label for="desconto">Desconto:</label>
                                <input type="text" id="desconto" name="desconto" placeholder="R$ 0,00">
                            </div>
                            <div class="form-group">
                                <label for="valor_avulso">Valor Avulso:</label>
                                <input type="text" id="valor_avulso" name="valor_avulso" placeholder="R$ 0,00">
                            </div>
                            <div class="form-group">
                                <label for="forma_pagamento_avulso">Forma Pagamento Avulso:</label>
                                <select id="forma_pagamento_avulso" name="forma_pagamento_avulso">
                                    <option value="Dinheiro">Dinheiro</option>
                                    <option value="Cart√£o">Cart√£o</option>
                                    <option value="PIX">PIX</option>
                                    <option value="Transfer√™ncia">Transfer√™ncia</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="valor_avulso_pago">Valor Avulso Pago:</label>
                                <select id="valor_avulso_pago" name="valor_avulso_pago" onchange="toggleDataPagamentoAvulso()">
                                    <option value="false">N√£o</option>
                                    <option value="true">Sim</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="deslocamento">Deslocamento:</label>
                                <input type="text" id="deslocamento" name="deslocamento" placeholder="R$ 0,00">
                            </div>
                            <div class="form-group">
                                <label for="valor_falta_receber" style="color: #dc3545;">Valor que Falta Receber:</label>
                                <input type="text" id="valor_falta_receber" name="valor_falta_receber" placeholder="R$ 0,00" readonly style="background: #f8f9fa; color: #dc3545; font-weight: bold;">
                            </div>
                            <div class="form-group">
                                <label for="forma_pagamento_restante">Forma Pagamento Restante:</label>
                                <select id="forma_pagamento_restante" name="forma_pagamento_restante">
                                    <option value="Dinheiro">Dinheiro</option>
                                    <option value="Cart√£o">Cart√£o</option>
                                    <option value="PIX">PIX</option>
                                    <option value="Transfer√™ncia">Transfer√™ncia</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="valor_total">Valor Total:</label>
                                <input type="text" id="valor_total" name="valor_total" placeholder="R$ 0,00" readonly style="background: #f8f9fa; font-weight: bold;">
                            </div>
                        </div>
                        
                        <div id="dataPagamentoAvulsoDiv" style="display: none; margin-bottom: 1rem;">
                            <label>Data do Pagamento Avulso:</label>
                            <input type="text" id="dataPagamentoAvulso" readonly style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px; background: #f8f9fa;">
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 2rem;">
                            <label for="observacoes">Observa√ß√µes:</label>
                            <textarea id="observacoes" name="observacoes" rows="4" style="width: 100%; resize: vertical; min-height: 100px;"></textarea>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">RESERVAR EVENTO</button>
                        </div>
                    </form>
                    
                    <div id="eventoSuccess" class="success" style="display: none;"></div>
                </div>
            </div>

            <!-- Todos os Eventos -->
            <div class="page" id="todos_eventos">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('eventos')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìã TODOS OS EVENTOS</h2>
                    <div style="margin-bottom: 2rem; padding: 1rem; background: #f0f8ff; border-radius: 10px;">
                        <h4>Legenda de Cores:</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 1rem;">
                            <span style="background: #007bff; color: white; padding: 0.3rem 0.8rem; border-radius: 6px;">üîµ Mais de 5 dias</span>
                            <span style="background: #ffc107; color: black; padding: 0.3rem 0.8rem; border-radius: 6px;">üü° Entre 4 a 2 dias</span>
                            <span style="background: #dc3545; color: white; padding: 0.3rem 0.8rem; border-radius: 6px;">üî¥ 1 dia</span>
                            <span style="background: #28a745; color: white; padding: 0.3rem 0.8rem; border-radius: 6px;">üü¢ Dia do evento</span>
                            <span style="background: #6c757d; color: white; padding: 0.3rem 0.8rem; border-radius: 6px;">‚ö´ Evento finalizado</span>
                            <span style="background: #6f42c1; color: white; padding: 0.3rem 0.8rem; border-radius: 6px;">üü£ Sinal n√£o pago</span>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <button onclick="navegarEventos(-1)" id="btnAnterior" style="background: #007bff; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">‚Üê</button>
                        <span id="infoEventos" style="font-weight: bold;"></span>
                        <button onclick="navegarEventos(1)" id="btnProximo" style="background: #007bff; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">‚Üí</button>
                    </div>
                    <div id="listaTodosEventos"></div>
                </div>
            </div>

            <!-- Eventos Futuros -->
            <div class="page" id="eventos_futuros">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('eventos')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üï∞Ô∏è EVENTOS FUTUROS</h2>
                    <div style="margin-bottom: 2rem; padding: 1rem; background: #f0f8ff; border-radius: 10px;">
                        <h4>Legenda de Cores:</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 1rem;">
                            <span style="background: #007bff; color: white; padding: 0.3rem 0.8rem; border-radius: 15px;">üîµ Mais de 5 dias</span>
                            <span style="background: #ffc107; color: black; padding: 0.3rem 0.8rem; border-radius: 15px;">üü° Entre 4 a 2 dias</span>
                            <span style="background: #dc3545; color: white; padding: 0.3rem 0.8rem; border-radius: 15px;">üî¥ 1 dia</span>
                            <span style="background: #28a745; color: white; padding: 0.3rem 0.8rem; border-radius: 15px;">üü¢ Dia do evento</span>
                            <span style="background: #6f42c1; color: white; padding: 0.3rem 0.8rem; border-radius: 15px;">üü£ Sinal n√£o pago</span>
                        </div>
                    </div>
                    <div id="listaEventosFuturos"></div>
                </div>
            </div>

            <!-- Confirmar Dados -->
            <div class="page" id="confirmar_dados">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('eventos')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">‚úÖ CONFIRMAR DADOS</h2>
                    <div id="listaConfirmarDados"></div>
                </div>
            </div>

            <!-- Escalas -->
            <div class="page" id="escalas">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('eventos')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìÖ ESCALAS</h2>
                    <div class="menu-grid">
                        <div class="menu-item" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);" onclick="showPage('equipe_escalada')">
                            <h3>üë• Equipe Escalada</h3>
                            <p>Eventos com equipe j√° escalada</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);" onclick="showPage('eventos_pendente_escala')">
                            <h3>‚è≥ Pendente de Escala</h3>
                            <p>Eventos aguardando escala√ß√£o</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Equipe Escalada -->
            <div class="page" id="equipe_escalada">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('escalas')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üë• EQUIPE ESCALADA</h2>
                    <div id="listaEquipeEscalada"></div>
                </div>
            </div>
            
            <!-- Eventos Pendente de Escala -->
            <div class="page" id="eventos_pendente_escala">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('escalas')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">‚è≥ EVENTOS PENDENTE DE ESCALA</h2>
                    <div id="listaEventosPendenteEscala"></div>
                </div>
            </div>
            
            <!-- Relat√≥rios -->
            <div class="page" id="relatorios">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('eventos')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìä RELAT√ìRIOS</h2>
                    <div class="menu-grid">
                        <div class="menu-item" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);" onclick="showPage('relatorio_escalacoes')">
                            <h3>üìÖ Relat√≥rio de Escala√ß√µes</h3>
                            <p>Eventos finalizados com escala√ß√£o</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #007bff 0%, #6f42c1 100%);" onclick="showPage('relatorio_eventos_finalizados')">
                            <h3>üéâ Eventos Finalizados</h3>
                            <p>Todos os eventos j√° realizados</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);" onclick="showPage('relatorio_confirmacao_dados')">
                            <h3>‚úÖ Confirma√ß√£o de Dados</h3>
                            <p>Eventos com dados confirmados</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Relat√≥rio de Escala√ß√µes -->
            <div class="page" id="relatorio_escalacoes">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('relatorios')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìÖ RELAT√ìRIO DE ESCALA√á√ïES</h2>
                    <div id="listaRelatorioEscalacoes"></div>
                </div>
            </div>
            
            <!-- Relat√≥rio de Eventos Finalizados -->
            <div class="page" id="relatorio_eventos_finalizados">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('relatorios')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üéâ EVENTOS FINALIZADOS</h2>
                    <div id="listaEventosFinalizados"></div>
                </div>
            </div>
            
            <!-- Relat√≥rio de Confirma√ß√£o de Dados -->
            <div class="page" id="relatorio_confirmacao_dados">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('relatorios')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">‚úÖ CONFIRMA√á√ÉO DE DADOS</h2>
                    <div id="listaRelatorioConfirmacao"></div>
                </div>
            </div>
            
            <!-- Personagens -->
            <div class="page" id="personagens">
                <div class="card">
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">ü¶Å PERSONAGENS</h2>
                    <div class="menu-grid">
                        <div class="menu-item" style="background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);" onclick="showPage('cadastro_personagens')">
                            <h3>üìù Cadastro de Personagens</h3>
                            <p>Cadastre novos personagens com figurino, tema, valores e foto</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #228B22 0%, #32CD32 100%);" onclick="showPage('lista_personagens')">
                            <h3>üìã Lista de Personagens</h3>
                            <p>Visualize todos os personagens cadastrados</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cadastro Personagens -->
            <div class="page" id="cadastro_personagens">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('personagens')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìù CADASTRO DE PERSONAGENS</h2>
                    
                    <form id="personagensForm">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label for="personagem">Personagem:</label>
                                <input type="text" id="personagem" name="personagem" required>
                            </div>
                            <div class="form-group">
                                <label for="figurino">Figurino:</label>
                                <input type="text" id="figurino" name="figurino">
                            </div>
                            <div class="form-group">
                                <label for="tema">Tema:</label>
                                <input type="text" id="tema" name="tema">
                            </div>
                            <div class="form-group">
                                <label for="quantidade">Quantidade:</label>
                                <input type="number" id="quantidade" name="quantidade" required min="1">
                            </div>
                            <div class="form-group">
                                <label for="valor">Valor:</label>
                                <input type="text" id="valor" name="valor" placeholder="R$ 0,00" required>
                            </div>
                            <div class="form-group">
                                <label for="cache_personagem">Cach√™ Individual (R$):</label>
                                <input type="text" id="cache_personagem" name="cache_personagem" placeholder="R$ 0,00">
                            </div>
                            <div class="form-group">
                                <label for="foto">Foto:</label>
                                <input type="file" id="foto" name="foto" accept="image/*">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">SALVAR PERSONAGEM</button>
                        </div>
                    </form>
                    
                    <div id="personagensSuccess" class="success" style="display: none;"></div>
                </div>
            </div>

            <!-- Lista Personagens -->
            <div class="page" id="lista_personagens">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('personagens')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìã LISTA DE PERSONAGENS</h2>
                    <div id="listaPersonagens"></div>
                </div>
            </div>

            <!-- Elenco -->
            <div class="page" id="elenco">
                <div class="card">
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">üé≠ ELENCO</h2>
                    <div class="menu-grid">
                        <div class="menu-item" style="background: linear-gradient(135deg, #228B22 0%, #32CD32 100%);" onclick="showPage('cadastro_elenco')">
                            <h3>üìù Cadastro de Elenco</h3>
                            <p>Cadastre membros do elenco com m√∫ltiplos perfis</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #DAA520 0%, #FFD700 100%);" onclick="showPage('lista_elenco')">
                            <h3>üìã Lista de Elenco</h3>
                            <p>Visualize todos os membros cadastrados</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cadastro Elenco -->
            <div class="page" id="cadastro_elenco">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('elenco')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìù CADASTRO DE ELENCO</h2>
                    
                    <form id="elencoForm">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label for="nome_completo">Nome Completo:</label>
                                <input type="text" id="nome_completo" name="nome_completo" required>
                            </div>
                            <div class="form-group">
                                <label for="cpf_elenco">CPF:</label>
                                <input type="text" id="cpf_elenco" name="cpf" placeholder="000.000.000-00" required>
                            </div>
                            <div class="form-group">
                                <label for="data_nascimento_elenco">Data de Nascimento:</label>
                                <input type="date" id="data_nascimento_elenco" name="data_nascimento" required>
                            </div>
                            <div class="form-group">
                                <label for="whatsapp">WhatsApp:</label>
                                <input type="text" id="whatsapp" name="whatsapp">
                            </div>
                            <div class="form-group">
                                <label for="altura">Altura (cm):</label>
                                <input type="number" id="altura" name="altura" min="100" max="250">
                            </div>
                            <div class="form-group">
                                <label for="calcado">Cal√ßado:</label>
                                <input type="text" id="calcado" name="calcado" placeholder="Ex: 38, 40, 42">
                            </div>
                            <div class="form-group">
                                <label for="chave_pix_elenco">Chave PIX:</label>
                                <input type="text" id="chave_pix_elenco" name="chave_pix">
                            </div>
                            <div class="form-group">
                                <label for="cache_elenco">Cach√™ Individual (R$):</label>
                                <input type="text" id="cache_elenco" name="cache" placeholder="R$ 0,00" required>
                            </div>
                            <div class="form-group">
                                <label for="foto_elenco">Foto:</label>
                                <input type="file" id="foto_elenco" name="foto" accept="image/*">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Perfil (m√∫ltipla escolha):</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
                                <label><input type="checkbox" name="perfil" value="CABE√á√ÉO"> CABE√á√ÉO</label>
                                <label><input type="checkbox" name="perfil" value="CARA LIMPA"> CARA LIMPA</label>
                                <label><input type="checkbox" name="perfil" value="HER√ìIS"> HER√ìIS</label>
                                <label><input type="checkbox" name="perfil" value="DRIVE"> DRIVE</label>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">SALVAR ELENCO</button>
                        </div>
                    </form>
                    
                    <div id="elencoSuccess" class="success" style="display: none;"></div>
                </div>
            </div>

            <!-- Lista Elenco -->
            <div class="page" id="lista_elenco">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('elenco')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìã LISTA DE ELENCO</h2>
                    <div id="listaElenco"></div>
                </div>
            </div>
            
            <!-- Motoristas -->
            <div class="page" id="motoristas">
                <div class="card">
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">üöó MOTORISTAS</h2>
                    <div class="menu-grid">
                        <div class="menu-item" style="background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);" onclick="showPage('cadastro_motoristas')">
                            <h3>üìù Cadastro de Motoristas</h3>
                            <p>Cadastre motoristas com dados pessoais e ve√≠culo</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #228B22 0%, #32CD32 100%);" onclick="showPage('lista_motoristas')">
                            <h3>üìã Lista de Motoristas</h3>
                            <p>Visualize todos os motoristas cadastrados</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cadastro Motoristas -->
            <div class="page" id="cadastro_motoristas">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('motoristas')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìù CADASTRO DE MOTORISTAS</h2>
                    
                    <form id="motoristasForm">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label for="nome_completo_motorista">Nome Completo:</label>
                                <input type="text" id="nome_completo_motorista" name="nome_completo" required>
                            </div>
                            <div class="form-group">
                                <label for="cpf_motorista">CPF:</label>
                                <input type="text" id="cpf_motorista" name="cpf" placeholder="000.000.000-00" required>
                            </div>
                            <div class="form-group">
                                <label for="whatsapp_motorista">WhatsApp:</label>
                                <input type="text" id="whatsapp_motorista" name="whatsapp" placeholder="(00) 00000-0000">
                            </div>
                            <div class="form-group">
                                <label for="modelo_carro">Modelo do Carro:</label>
                                <input type="text" id="modelo_carro" name="modelo_carro" required>
                            </div>
                            <div class="form-group">
                                <label for="chave_pix_motorista">Chave PIX:</label>
                                <input type="text" id="chave_pix_motorista" name="chave_pix">
                            </div>
                            <div class="form-group">
                                <label for="foto_motorista">Foto:</label>
                                <input type="file" id="foto_motorista" name="foto" accept="image/*">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Perfil:</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
                                <label><input type="checkbox" name="perfil_motorista" value="DRIVE" checked disabled> DRIVE</label>
                                <label><input type="checkbox" name="perfil_motorista" value="CABE√á√ÉO"> CABE√á√ÉO</label>
                                <label><input type="checkbox" name="perfil_motorista" value="CARA LIMPA"> CARA LIMPA</label>
                                <label><input type="checkbox" name="perfil_motorista" value="HER√ìIS"> HER√ìIS</label>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">SALVAR MOTORISTA</button>
                        </div>
                    </form>
                    
                    <div id="motoristasSuccess" class="success" style="display: none;"></div>
                </div>
            </div>

            <!-- Lista Motoristas -->
            <div class="page" id="lista_motoristas">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('motoristas')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìã LISTA DE MOTORISTAS</h2>
                    <div id="listaMotoristas"></div>
                </div>
            </div>
            
            <!-- Casas de Festas -->
            <div class="page" id="casas_festas">
                <div class="card">
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">üè† CASAS DE FESTAS</h2>
                    <div class="menu-grid">
                        <div class="menu-item" style="background: linear-gradient(135deg, #DAA520 0%, #FFD700 100%);" onclick="showPage('cadastro_casas')">
                            <h3>üìù Cadastro de Casas</h3>
                            <p>Cadastre casas de festas com endere√ßo completo</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #228B22 0%, #32CD32 100%);" onclick="showPage('lista_casas')">
                            <h3>üìã Lista de Casas</h3>
                            <p>Visualize todas as casas de festas cadastradas</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cadastro Casas de Festas -->
            <div class="page" id="cadastro_casas">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('casas_festas')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìù CADASTRO DE CASAS DE FESTAS</h2>
                    
                    <form id="casasForm">
                        <div class="form-group">
                            <label for="nome_casa">Nome da Casa de Festas:</label>
                            <input type="text" id="nome_casa" name="nome_casa" required>
                        </div>
                        
                        <h3 style="color: #8B4513; margin: 2rem 0 1rem 0;">Endere√ßo</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label for="cep_casa">CEP:</label>
                                <input type="text" id="cep_casa" name="cep" placeholder="00000-000" required>
                            </div>
                            <div class="form-group">
                                <label for="logradouro_casa">Logradouro:</label>
                                <input type="text" id="logradouro_casa" name="logradouro" required>
                            </div>
                            <div class="form-group">
                                <label for="numero_casa">N√∫mero:</label>
                                <input type="text" id="numero_casa" name="numero" required>
                            </div>
                            <div class="form-group">
                                <label for="complemento_casa">Complemento:</label>
                                <input type="text" id="complemento_casa" name="complemento">
                            </div>
                            <div class="form-group">
                                <label for="bairro_casa">Bairro:</label>
                                <input type="text" id="bairro_casa" name="bairro" required>
                            </div>
                            <div class="form-group">
                                <label for="cidade_casa">Cidade:</label>
                                <input type="text" id="cidade_casa" name="cidade" required>
                            </div>
                            <div class="form-group">
                                <label for="estado_casa">Estado:</label>
                                <input type="text" id="estado_casa" name="estado" required>
                            </div>
                            <div class="form-group">
                                <label for="telefone_casa">Telefone:</label>
                                <input type="text" id="telefone_casa" name="telefone" placeholder="(00) 0000-0000">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">SALVAR CASA DE FESTAS</button>
                        </div>
                    </form>
                    
                    <div id="casasSuccess" class="success" style="display: none;"></div>
                </div>
            </div>

            <!-- Lista Casas de Festas -->
            <div class="page" id="lista_casas">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('casas_festas')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìã LISTA DE CASAS DE FESTAS</h2>
                    <div id="listaCasas"></div>
                </div>
            </div>
            
            <!-- Clientes -->
            <div class="page" id="clientes">
                <div class="card">
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">üë• CLIENTES</h2>
                    <div class="menu-grid">
                        <div class="menu-item" style="background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);" onclick="showPage('cadastro_clientes')">
                            <h3>üìù Cadastro de Clientes</h3>
                            <p>Cadastre clientes com dados pessoais e do aniversariante</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #228B22 0%, #32CD32 100%);" onclick="showPage('lista_clientes')">
                            <h3>üìã Lista de Clientes</h3>
                            <p>Visualize todos os clientes cadastrados</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cadastro Clientes -->
            <div class="page" id="cadastro_clientes">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('clientes')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìù CADASTRO DE CLIENTES</h2>
                    
                    <form id="clientesForm">
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">Dados do Cliente</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="form-group">
                                <label for="nome_cliente">Nome Completo:</label>
                                <input type="text" id="nome_cliente" name="nome_cliente" required>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Documento:</label>
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <button type="button" id="btn_cpf" onclick="selecionarTipoDoc('cpf')" style="background: #28a745; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">CPF</button>
                                    <button type="button" id="btn_cnpj" onclick="selecionarTipoDoc('cnpj')" style="background: #6c757d; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">CNPJ</button>
                                </div>
                                <input type="text" id="cpf_cliente" name="cpf_cliente" placeholder="000.000.000-00" required maxlength="14">
                            </div>
                            <div class="form-group" id="campo_nome_empresa" style="display: none;">
                                <label for="nome_empresa_cliente">üè¢ Nome da Empresa:</label>
                                <input type="text" id="nome_empresa_cliente" name="nome_empresa_cliente" placeholder="Nome da empresa">
                            </div>
                            <div class="form-group">
                                <label id="label_data_nascimento" for="data_nascimento_cliente">üìÖ Data de Nascimento:</label>
                                <input type="date" id="data_nascimento_cliente" name="data_nascimento_cliente" required>
                            </div>
                            <div class="form-group">
                                <label for="email_cliente">Email:</label>
                                <input type="email" id="email_cliente" name="email_cliente">
                            </div>
                            <div class="form-group">
                                <label for="telefone_cliente">Telefone:</label>
                                <input type="text" id="telefone_cliente" name="telefone_cliente" placeholder="(00) 0000-0000">
                            </div>
                        </div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">Endere√ßo do Cliente</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="form-group">
                                <label for="cep_cliente">CEP:</label>
                                <input type="text" id="cep_cliente" name="cep_cliente" placeholder="00000-000" required>
                            </div>
                            <div class="form-group">
                                <label for="logradouro_cliente">Logradouro:</label>
                                <input type="text" id="logradouro_cliente" name="logradouro_cliente" required>
                            </div>
                            <div class="form-group">
                                <label for="numero_cliente">N√∫mero:</label>
                                <input type="text" id="numero_cliente" name="numero_cliente" required>
                            </div>
                            <div class="form-group">
                                <label for="complemento_cliente">Complemento:</label>
                                <input type="text" id="complemento_cliente" name="complemento_cliente">
                            </div>
                            <div class="form-group">
                                <label for="bairro_cliente">Bairro:</label>
                                <input type="text" id="bairro_cliente" name="bairro_cliente" required>
                            </div>
                            <div class="form-group">
                                <label for="cidade_cliente">Cidade:</label>
                                <input type="text" id="cidade_cliente" name="cidade_cliente" required>
                            </div>
                            <div class="form-group">
                                <label for="estado_cliente">Estado:</label>
                                <input type="text" id="estado_cliente" name="estado_cliente" required>
                            </div>
                        </div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">Dados do Aniversariante</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="form-group">
                                <label for="nome_aniversariante">Nome do Aniversariante:</label>
                                <input type="text" id="nome_aniversariante" name="nome_aniversariante" required>
                            </div>
                            <div class="form-group">
                                <label for="data_nascimento_aniversariante">Data de Nascimento:</label>
                                <input type="date" id="data_nascimento_aniversariante" name="data_nascimento_aniversariante" required>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">SALVAR CLIENTE</button>
                        </div>
                    </form>
                    
                    <div id="clientesSuccess" class="success" style="display: none;"></div>
                </div>
            </div>

            <!-- Lista Clientes -->
            <div class="page" id="lista_clientes">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('clientes')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìã LISTA DE CLIENTES</h2>
                    <div id="listaClientes"></div>
                </div>
            </div>

            <!-- Manuten√ß√£o -->
            <div class="page" id="manutencao">
                <div class="card">
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">üîß MANUTEN√á√ÉO</h2>
                    <div class="menu-grid">
                        <div class="menu-item" style="background: linear-gradient(135deg, #fd7e14 0%, #dc3545 100%);" onclick="showPage('cadastro_manutencao')">
                            <h3>üìù Cadastro de Manuten√ß√£o</h3>
                            <p>Registre itens para manuten√ß√£o</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);" onclick="showPage('lista_manutencao')">
                            <h3>üìã Lista de Manuten√ß√µes</h3>
                            <p>Visualize todas as manuten√ß√µes</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cadastro Manuten√ß√£o -->
            <div class="page" id="cadastro_manutencao">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('manutencao')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìù CADASTRO DE MANUTEN√á√ÉO</h2>
                    
                    <form id="manutencaoForm">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="form-group">
                                <label for="data_registro">Data de Registro:</label>
                                <input type="date" id="data_registro" name="data_registro" required>
                            </div>
                            <div class="form-group">
                                <label for="personagem_manutencao">Personagem:</label>
                                <select id="personagem_manutencao" name="personagem_manutencao" required>
                                    <option value="">Selecione um personagem</option>
                                </select>
                            </div>
                        </div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">üîß ITENS PARA MANUTEN√á√ÉO</h3>
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; align-items: end;">
                            <div class="form-group" style="flex: 1;">
                                <label for="tipo_item">Tipo de Item:</label>
                                <input type="text" id="tipo_item" name="tipo_item" placeholder="Ex: Cabe√ßa, Roupa, Sapato">
                            </div>
                            <button type="button" onclick="adicionarItem()" class="btn" style="padding: 0.75rem 1.5rem;">‚ûï Adicionar Item</button>
                        </div>
                        
                        <div id="itensManutencao" style="margin-bottom: 2rem;"></div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">SALVAR MANUTEN√á√ÉO</button>
                        </div>
                    </form>
                    
                    <div id="manutencaoSuccess" class="success" style="display: none;"></div>
                </div>
            </div>

            <!-- Lista Manuten√ß√£o -->
            <div class="page" id="lista_manutencao">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('manutencao')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìã LISTA DE MANUTEN√á√ïES</h2>
                    <div style="margin-bottom: 2rem; padding: 1rem; background: #f0f8ff; border-radius: 10px;">
                        <h4>Legenda de Status:</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 1rem;">
                            <span style="background: #6c757d; color: white; padding: 0.3rem 0.8rem; border-radius: 6px;">üîò Pendente</span>
                            <span style="background: #ffc107; color: black; padding: 0.3rem 0.8rem; border-radius: 6px;">üü° Em Andamento</span>
                            <span style="background: #28a745; color: white; padding: 0.3rem 0.8rem; border-radius: 6px;">üü¢ Realizado</span>
                        </div>
                    </div>
                    <div id="listaManutencoes"></div>
                </div>
            </div>

            <!-- Realizar Manuten√ß√£o -->
            <div class="page" id="realizar_manutencao">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('lista_manutencao')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üîß REALIZAR MANUTEN√á√ÉO</h2>
                    
                    <div id="dadosManutencao" style="margin-bottom: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 10px;"></div>
                    
                    <form id="realizarManutencaoForm">
                        <input type="hidden" id="manutencao_id" name="manutencao_id">
                        
                        <div class="form-group">
                            <label for="status_manutencao">Status:</label>
                            <select id="status_manutencao" name="status" required>
                                <option value="pendente">Pendente</option>
                                <option value="em_andamento">Em Andamento</option>
                                <option value="realizado">Realizado</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="informacoes_realizadas">Informa√ß√µes do que foi realizado:</label>
                            <textarea id="informacoes_realizadas" name="informacoes_realizadas" rows="4" style="width: 100%; resize: vertical; min-height: 100px;" placeholder="Descreva o que foi feito na manuten√ß√£o..."></textarea>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">ATUALIZAR MANUTEN√á√ÉO</button>
                        </div>
                    </form>
                    
                    <div id="realizarManutencaoSuccess" class="success" style="display: none;"></div>
                </div>
            </div>

            <!-- Financeiro -->
            <div class="page" id="financeiro">
                <div class="card">
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">üí∞ FINANCEIRO</h2>
                    <div class="menu-grid">
                        <div class="menu-item" style="background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);" onclick="showPage('pagamentos_receber')">
                            <h3>üíµ Pagamentos a Receber</h3>
                            <p>Valores pendentes de recebimento</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);" onclick="showPage('pagamentos_pagos')">
                            <h3>‚úÖ Pagamentos Pagos</h3>
                            <p>Valores j√° recebidos</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #007bff 0%, #6f42c1 100%);" onclick="showPage('fechamento_mensal')">
                            <h3>üìÖ Fechamento Mensal</h3>
                            <p>Relat√≥rio por m√™s</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);" onclick="showPage('pagamento_caches')">
                            <h3>üí¥ Pagamento de Cach√™s</h3>
                            <p>Controle de pagamentos do elenco</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pagamentos a Receber -->
            <div class="page" id="pagamentos_receber">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('financeiro')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üíµ PAGAMENTOS A RECEBER</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div style="background: #dc3545; color: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                            <h3>Sinais Pendentes</h3>
                            <div style="font-size: 2rem; font-weight: bold;" id="totalSinaisPendentes">R$ 0,00</div>
                        </div>
                        <div style="background: #fd7e14; color: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                            <h3>Valores Restantes</h3>
                            <div style="font-size: 2rem; font-weight: bold;" id="totalValoresRestantes">R$ 0,00</div>
                        </div>
                        <div style="background: #6f42c1; color: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                            <h3>Total a Receber</h3>
                            <div style="font-size: 2rem; font-weight: bold;" id="totalAReceber">R$ 0,00</div>
                        </div>
                    </div>
                    
                    <div id="listaEventosReceber"></div>
                </div>
            </div>

            <!-- Pagamentos Pagos -->
            <div class="page" id="pagamentos_pagos">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('financeiro')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">‚úÖ PAGAMENTOS PAGOS</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div style="background: #28a745; color: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                            <h3>Sinais Pagos</h3>
                            <div style="font-size: 2rem; font-weight: bold;" id="totalSinaisPagos">R$ 0,00</div>
                        </div>
                        <div style="background: #20c997; color: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                            <h3>Deslocamentos</h3>
                            <div style="font-size: 2rem; font-weight: bold;" id="totalDeslocamentos">R$ 0,00</div>
                        </div>
                        <div style="background: #007bff; color: white; padding: 1.5rem; border-radius: 10px; text-align: center;">
                            <h3>Valores Totais Pagos</h3>
                            <div style="font-size: 2rem; font-weight: bold;" id="totalValoresPagos">R$ 0,00</div>
                        </div>
                        <div style="background: #ffc107; color: black; padding: 1.5rem; border-radius: 10px; text-align: center;">
                            <h3>Descontos</h3>
                            <div style="font-size: 2rem; font-weight: bold;" id="totalDescontos">R$ 0,00</div>
                        </div>
                    </div>
                    
                    <div id="listaEventosPagos"></div>
                </div>
            </div>

            <!-- Fechamento Mensal -->
            <div class="page" id="fechamento_mensal">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('financeiro')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üìÖ FECHAMENTO MENSAL</h2>
                    
                    <div style="display: flex; gap: 1rem; margin-bottom: 2rem; align-items: end;">
                        <div class="form-group" style="flex: 1;">
                            <label for="mesAno">M√™s/Ano:</label>
                            <input type="month" id="mesAno" name="mesAno">
                        </div>
                        <button onclick="gerarFechamento()" class="btn">üìà Gerar Fechamento</button>
                    </div>
                    
                    <div id="resultadoFechamento"></div>
                </div>
            </div>

            <!-- Pagamento de Cach√™s -->
            <div class="page" id="pagamento_caches">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('financeiro')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üí¥ PAGAMENTO DE CACH√äS</h2>
                    
                    <div style="display: flex; gap: 1rem; margin-bottom: 2rem; align-items: end;">
                        <div class="form-group" style="flex: 1;">
                            <label for="mesAnoCaches">M√™s/Ano:</label>
                            <input type="month" id="mesAnoCaches" name="mesAnoCaches">
                        </div>
                        <button onclick="carregarCaches()" class="btn">üìà Carregar Cach√™s</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div style="background: #28a745; color: white; padding: 1rem; border-radius: 10px; text-align: center;">
                            <h4>Cach√™s Pagos</h4>
                            <div style="font-size: 1.5rem; font-weight: bold;" id="totalCachesPagos">R$ 0,00</div>
                        </div>
                        <div style="background: #dc3545; color: white; padding: 1rem; border-radius: 10px; text-align: center;">
                            <h4>Cach√™s a Pagar</h4>
                            <div style="font-size: 1.5rem; font-weight: bold;" id="totalCachesAPagar">R$ 0,00</div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <button onclick="mostrarTipo('elenco')" id="btnElenco" class="btn" style="background: #6f42c1;">üé≠ Elenco</button>
                        <button onclick="mostrarTipo('drive')" id="btnDrive" class="btn" style="background: #fd7e14;">üöó Drive</button>
                        <button onclick="mostrarTipo('todos')" id="btnTodos" class="btn" style="background: #007bff;">üìã Todos</button>
                    </div>
                    
                    <div id="listaCaches"></div>
                </div>
            </div>

            <!-- Informa√ß√µes de Pagamento -->
            <div class="page" id="informacoes_pagamento">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('pagamento_caches')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üíµ INFORMA√á√ïES DE PAGAMENTO</h2>
                    
                    <div id="dadosPagamento" style="margin-bottom: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 10px;"></div>
                    
                    <form id="informacoesPagamentoForm">
                        <input type="hidden" id="pagamento_tipo">
                        <input type="hidden" id="pagamento_id">
                        
                        <div class="form-group">
                            <label for="status_pagamento">Status do Pagamento:</label>
                            <select id="status_pagamento" name="status_pagamento" required>
                                <option value="falta_pagar">Falta Pagar</option>
                                <option value="pago">Pago</option>
                            </select>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">SALVAR STATUS</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Configura√ß√µes -->
            <div class="page" id="configuracoes">
                <div class="card">
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">‚öôÔ∏è CONFIGURA√á√ïES</h2>
                    <div class="menu-grid">
                        <div class="menu-item" style="background: linear-gradient(135deg, #007bff 0%, #6f42c1 100%);" onclick="showPage('cadastro_usuarios')">
                            <h3>üë• Cadastro de Usu√°rios</h3>
                            <p>Gerenciar usu√°rios e permiss√µes do sistema</p>
                        </div>
                        <div class="menu-item" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);" onclick="showPage('usuarios_cadastrados')">
                            <h3>üìã Usu√°rios Cadastrados</h3>
                            <p>Visualizar e gerenciar usu√°rios existentes</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cadastro de Usu√°rios -->
            <div class="page" id="cadastro_usuarios">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('configuracoes')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">üë• CADASTRO DE USU√ÅRIOS</h2>
                    
                    <form id="usuarioForm">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label for="nome_usuario">Nome Completo:</label>
                                <input type="text" id="nome_usuario" name="nome_usuario" required>
                            </div>
                            <div class="form-group">
                                <label for="cpf_usuario">CPF:</label>
                                <input type="text" id="cpf_usuario" name="cpf_usuario" placeholder="000.000.000-00" required>
                            </div>
                            <div class="form-group">
                                <label for="telefone_usuario">Telefone:</label>
                                <input type="text" id="telefone_usuario" name="telefone_usuario" placeholder="(00) 00000-0000">
                            </div>
                            <div class="form-group">
                                <label for="login_usuario">Login:</label>
                                <input type="text" id="login_usuario" name="login_usuario" required>
                            </div>
                            <div class="form-group">
                                <label for="senha_usuario">Senha:</label>
                                <input type="password" id="senha_usuario" name="senha_usuario" required>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">CADASTRAR USU√ÅRIO</button>
                        </div>
                    </form>
                    
                    <div id="usuarioSuccess" class="success" style="display: none;"></div>
                </div>
            </div>

            <!-- Usu√°rios Cadastrados -->
            <div class="page" id="usuarios_cadastrados">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('configuracoes')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">üìã USU√ÅRIOS CADASTRADOS</h2>
                    <div id="listaUsuarios"></div>
                </div>
            </div>

            <!-- Gerenciar Permiss√µes -->
            <div class="page" id="gerenciar_permissoes">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('cadastro_usuarios')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #333; text-align: center; margin-bottom: 2rem;">üîê GERENCIAR PERMISS√ïES</h2>
                    
                    <div id="dadosUsuarioPermissoes" style="margin-bottom: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 10px;"></div>
                    
                    <form id="permissoesForm">
                        <input type="hidden" id="usuario_id_permissoes">
                        
                        <h3 style="color: #333; margin-bottom: 1rem;">üìã M√≥dulos do Sistema</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label><input type="checkbox" name="permissao" value="dashboard"> üè† Dashboard</label>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" name="permissao" value="eventos"> üéâ Eventos</label>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" name="permissao" value="personagens"> ü¶Å Personagens</label>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" name="permissao" value="elenco"> üé≠ Elenco</label>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" name="permissao" value="motoristas"> üöó Motoristas</label>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" name="permissao" value="casas_festas"> üè† Casa de Festas</label>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" name="permissao" value="clientes"> üë• Clientes</label>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" name="permissao" value="manutencao"> üîß Manuten√ß√£o</label>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" name="permissao" value="financeiro"> üí∞ Financeiro</label>
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" name="permissao" value="configuracoes"> ‚öôÔ∏è Configura√ß√µes</label>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">SALVAR PERMISS√ïES</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Escalar Evento -->
            <div class="page" id="escalar_evento">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('eventos_futuros')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">üë• ESCALAR EVENTO</h2>
                    
                    <div id="dadosEventoEscala" style="margin-bottom: 2rem; padding: 1.5rem; background: linear-gradient(145deg, #FFF8DC 0%, #F5F5DC 100%); border-radius: 15px; border: 2px solid #DEB887;"></div>
                    
                    <form id="escalarEventoForm">
                        <input type="hidden" id="escala_evento_id">
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem; text-align: center; background: linear-gradient(135deg, #8B4513, #DAA520); color: white; padding: 0.8rem; border-radius: 10px;">ü¶Å PERSONAGENS E ELENCO</h3>
                        <div id="personagensEscala" style="margin-bottom: 2rem;"></div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem; text-align: center; background: linear-gradient(135deg, #8B4513, #DAA520); color: white; padding: 0.8rem; border-radius: 10px;">üöó MOTORISTAS</h3>
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; align-items: end;">
                            <div class="form-group" style="flex: 1;">
                                <label for="motorista_select">Selecionar Motorista:</label>
                                <select id="motorista_select">
                                    <option value="">Escolha um motorista</option>
                                </select>
                            </div>
                            <div class="form-group" style="width: 150px;">
                                <label for="valor_cache_motorista">Valor do Cach√™:</label>
                                <input type="text" id="valor_cache_motorista" placeholder="R$ 0,00" style="width: 100%;">
                            </div>
                            <button type="button" onclick="adicionarMotoristaEscala()" class="btn" style="padding: 0.75rem 1.5rem;">‚ûï Adicionar</button>
                        </div>
                        <div id="motoristasEscala" style="margin-bottom: 2rem;"></div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem; text-align: center; background: linear-gradient(135deg, #8B4513, #DAA520); color: white; padding: 0.8rem; border-radius: 10px;">üë®‚Äçüíº COORDENADOR GERAL</h3>
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; align-items: end;">
                            <div class="form-group" style="flex: 1;">
                                <label for="coordenador_select">Selecionar Coordenador:</label>
                                <select id="coordenador_select">
                                    <option value="">Escolha um coordenador</option>
                                </select>
                            </div>
                            <div class="form-group" style="width: 150px;">
                                <label for="valor_cache_coordenador">Valor do Cach√™:</label>
                                <input type="text" id="valor_cache_coordenador" placeholder="R$ 0,00" style="width: 100%;">
                            </div>
                            <button type="button" onclick="adicionarCoordenadorEscala()" class="btn" style="padding: 0.75rem 1.5rem;">‚ûï Adicionar</button>
                        </div>
                        <div id="coordenadoresEscala" style="margin-bottom: 2rem;"></div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem; text-align: center; background: linear-gradient(135deg, #8B4513, #DAA520); color: white; padding: 0.8rem; border-radius: 10px;">üé¨ PRODU√á√ÉO</h3>
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; align-items: end;">
                            <div class="form-group" style="flex: 1;">
                                <label for="producao_select">Selecionar Produ√ß√£o:</label>
                                <select id="producao_select">
                                    <option value="">Escolha um membro da produ√ß√£o</option>
                                </select>
                            </div>
                            <div class="form-group" style="width: 150px;">
                                <label for="valor_cache_producao">Valor do Cach√™:</label>
                                <input type="text" id="valor_cache_producao" placeholder="R$ 0,00" style="width: 100%;">
                            </div>
                            <button type="button" onclick="adicionarProducaoEscala()" class="btn" style="padding: 0.75rem 1.5rem;">‚ûï Adicionar</button>
                        </div>
                        <div id="producaoEscala" style="margin-bottom: 2rem;"></div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn" style="font-size: 1.2rem; padding: 1rem 2rem;">SALVAR ESCALA√á√ÉO</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Editar Evento -->
            <div class="page" id="editar_evento">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('todos_eventos')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">‚úèÔ∏è EDITAR EVENTO</h2>
                    
                    <form id="editarEventoForm">
                        <input type="hidden" id="edit_evento_id">
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">üë• DADOS DO CLIENTE</h3>
                        <div class="form-group">
                            <label>Tipo de Documento:</label>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <button type="button" id="edit_btn_cpf_evento" onclick="selecionarTipoDocEventoEdicao('cpf')" style="background: #28a745; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">CPF</button>
                                <button type="button" id="edit_btn_cnpj_evento" onclick="selecionarTipoDocEventoEdicao('cnpj')" style="background: #6c757d; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">CNPJ</button>
                            </div>
                            <input type="text" id="edit_cpf_evento" placeholder="000.000.000-00" required maxlength="14">
                        </div>
                        <div class="form-group" id="edit_campo_nome_empresa_evento" style="display: none;">
                            <label for="edit_nome_empresa_evento">üè¢ Nome da Empresa:</label>
                            <input type="text" id="edit_nome_empresa_evento" name="edit_nome_empresa_evento" placeholder="Nome da empresa">
                        </div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">üìÖ DADOS DO EVENTO</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="form-group">
                                <label for="edit_data_evento">Data do Evento:</label>
                                <input type="date" id="edit_data_evento" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_hora_entrada">Hora da Entrada:</label>
                                <input type="time" id="edit_hora_entrada" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_duracao">Dura√ß√£o (horas):</label>
                                <input type="number" id="edit_duracao" min="1" max="12" required>
                            </div>
                        </div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">ü¶Å PERSONAGENS</h3>
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem; align-items: end;">
                            <div class="form-group" style="flex: 1;">
                                <label for="edit_personagem_select">Selecionar Personagem:</label>
                                <select id="edit_personagem_select">
                                    <option value="">Escolha um personagem</option>
                                </select>
                            </div>
                            <button type="button" onclick="adicionarPersonagemEdicao()" class="btn" style="padding: 0.75rem 1.5rem;">‚ûï Adicionar</button>
                        </div>
                        <div id="edit_personagensSelecionados" style="margin-bottom: 2rem;"></div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">üí∞ VALORES</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                            <div class="form-group">
                                <label for="edit_valor_sinal">Valor do Sinal:</label>
                                <input type="text" id="edit_valor_sinal" placeholder="R$ 0,00">
                            </div>
                            <div class="form-group">
                                <label for="edit_sinal_pago_status">Sinal Pago:</label>
                                <select id="edit_sinal_pago_status">
                                    <option value="false">N√£o</option>
                                    <option value="true">Sim</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="edit_desconto">Desconto:</label>
                                <input type="text" id="edit_desconto" placeholder="R$ 0,00">
                            </div>
                            <div class="form-group">
                                <label for="edit_deslocamento">Deslocamento:</label>
                                <input type="text" id="edit_deslocamento" placeholder="R$ 0,00">
                            </div>
                            <div class="form-group">
                                <label for="edit_pagamento_total_pago">Pagamento Total Pago:</label>
                                <select id="edit_pagamento_total_pago">
                                    <option value="false">N√£o</option>
                                    <option value="true">Sim</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="edit_valor_total">Valor Total:</label>
                                <input type="text" id="edit_valor_total" placeholder="R$ 0,00" readonly style="background: #f8f9fa;">
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 2rem;">
                            <label for="edit_observacoes">Observa√ß√µes:</label>
                            <textarea id="edit_observacoes" rows="4" style="width: 100%; resize: vertical;"></textarea>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">SALVAR ALTERA√á√ïES</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Editar Personagem -->
            <div class="page" id="editar_personagem">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('lista_personagens')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">‚úèÔ∏è EDITAR PERSONAGEM</h2>
                    
                    <form id="editarPersonagemForm">
                        <input type="hidden" id="edit_personagem_id">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label for="edit_personagem">Personagem:</label>
                                <input type="text" id="edit_personagem" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_figurino">Figurino:</label>
                                <input type="text" id="edit_figurino">
                            </div>
                            <div class="form-group">
                                <label for="edit_tema">Tema:</label>
                                <input type="text" id="edit_tema">
                            </div>
                            <div class="form-group">
                                <label for="edit_quantidade">Quantidade:</label>
                                <input type="number" id="edit_quantidade" required min="1">
                            </div>
                            <div class="form-group">
                                <label for="edit_valor">Valor:</label>
                                <input type="text" id="edit_valor" placeholder="R$ 0,00" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_cache_personagem">Cach√™ Individual (R$):</label>
                                <input type="text" id="edit_cache_personagem" placeholder="R$ 0,00">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">SALVAR ALTERA√á√ïES</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Editar Casa de Festas -->
            <div class="page" id="editar_casa">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('lista_casas')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">‚úèÔ∏è EDITAR CASA DE FESTAS</h2>
                    
                    <form id="editarCasaForm">
                        <input type="hidden" id="edit_casa_id">
                        
                        <div class="form-group">
                            <label for="edit_nome_casa">Nome da Casa de Festas:</label>
                            <input type="text" id="edit_nome_casa" required>
                        </div>
                        
                        <h3 style="color: #8B4513; margin: 2rem 0 1rem 0;">Endere√ßo</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            <div class="form-group">
                                <label for="edit_cep_casa">CEP:</label>
                                <input type="text" id="edit_cep_casa" placeholder="00000-000" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_logradouro_casa">Logradouro:</label>
                                <input type="text" id="edit_logradouro_casa" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_numero_casa">N√∫mero:</label>
                                <input type="text" id="edit_numero_casa" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_complemento_casa">Complemento:</label>
                                <input type="text" id="edit_complemento_casa">
                            </div>
                            <div class="form-group">
                                <label for="edit_bairro_casa">Bairro:</label>
                                <input type="text" id="edit_bairro_casa" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_cidade_casa">Cidade:</label>
                                <input type="text" id="edit_cidade_casa" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_estado_casa">Estado:</label>
                                <input type="text" id="edit_estado_casa" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_telefone_casa">Telefone:</label>
                                <input type="text" id="edit_telefone_casa" placeholder="(00) 0000-0000">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">SALVAR ALTERA√á√ïES</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Editar Cliente -->
            <div class="page" id="editar_cliente">
                <div class="card">
                    <button class="nav-btn" onclick="showPage('lista_clientes')" style="margin-bottom: 1rem;">‚Üê Voltar</button>
                    <h2 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">‚úèÔ∏è EDITAR CLIENTE</h2>
                    
                    <form id="editarClienteForm">
                        <input type="hidden" id="edit_cliente_id">
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">Dados do Cliente</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="form-group">
                                <label for="edit_nome_cliente">Nome Completo:</label>
                                <input type="text" id="edit_nome_cliente" required>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Documento:</label>
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <button type="button" id="edit_btn_cpf" onclick="selecionarTipoDocEdicao('cpf')" style="background: #28a745; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">CPF</button>
                                    <button type="button" id="edit_btn_cnpj" onclick="selecionarTipoDocEdicao('cnpj')" style="background: #6c757d; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">CNPJ</button>
                                </div>
                                <input type="text" id="edit_cpf_cliente" placeholder="000.000.000-00" required maxlength="14">
                            </div>
                            <div class="form-group" id="edit_campo_nome_empresa" style="display: none;">
                                <label for="edit_nome_empresa_cliente">üè¢ Nome da Empresa:</label>
                                <input type="text" id="edit_nome_empresa_cliente" name="edit_nome_empresa_cliente" placeholder="Nome da empresa">
                            </div>
                            <div class="form-group">
                                <label id="edit_label_data_nascimento" for="edit_data_nascimento_cliente">üìÖ Data de Nascimento:</label>
                                <input type="date" id="edit_data_nascimento_cliente" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_email_cliente">Email:</label>
                                <input type="email" id="edit_email_cliente">
                            </div>
                            <div class="form-group">
                                <label for="edit_telefone_cliente">Telefone:</label>
                                <input type="text" id="edit_telefone_cliente" placeholder="(00) 0000-0000">
                            </div>
                        </div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">Endere√ßo do Cliente</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="form-group">
                                <label for="edit_cep_cliente">CEP:</label>
                                <input type="text" id="edit_cep_cliente" placeholder="00000-000" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_logradouro_cliente">Logradouro:</label>
                                <input type="text" id="edit_logradouro_cliente" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_numero_cliente">N√∫mero:</label>
                                <input type="text" id="edit_numero_cliente" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_complemento_cliente">Complemento:</label>
                                <input type="text" id="edit_complemento_cliente">
                            </div>
                            <div class="form-group">
                                <label for="edit_bairro_cliente">Bairro:</label>
                                <input type="text" id="edit_bairro_cliente" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_cidade_cliente">Cidade:</label>
                                <input type="text" id="edit_cidade_cliente" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_estado_cliente">Estado:</label>
                                <input type="text" id="edit_estado_cliente" required>
                            </div>
                        </div>
                        
                        <h3 style="color: #8B4513; margin-bottom: 1rem;">Dados do Anivers√°riante</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="form-group">
                                <label for="edit_nome_aniversariante">Nome do Anivers√°riante:</label>
                                <input type="text" id="edit_nome_aniversariante" required>
                            </div>
                            <div class="form-group">
                                <label for="edit_data_nascimento_aniversariante">Data de Nascimento:</label>
                                <input type="date" id="edit_data_nascimento_aniversariante" required>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn">SALVAR ALTERA√á√ïES</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Carregar dados do localStorage
        function recarregarDados() {
            personagens = JSON.parse(localStorage.getItem('personagens')) || [];
            elenco = JSON.parse(localStorage.getItem('elenco')) || [];
            motoristas = JSON.parse(localStorage.getItem('motoristas')) || [];
            casas = JSON.parse(localStorage.getItem('casas')) || [];
            clientes = JSON.parse(localStorage.getItem('clientes')) || [];
            eventos = JSON.parse(localStorage.getItem('eventos')) || [];
            manutencoes = JSON.parse(localStorage.getItem('manutencoes')) || [];
            usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
        }
        
        let personagens = JSON.parse(localStorage.getItem('personagens')) || [];
        let elenco = JSON.parse(localStorage.getItem('elenco')) || [];
        let motoristas = JSON.parse(localStorage.getItem('motoristas')) || [];
        let casas = JSON.parse(localStorage.getItem('casas')) || [];
        let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
        let eventos = JSON.parse(localStorage.getItem('eventos')) || [];
        let manutencoes = JSON.parse(localStorage.getItem('manutencoes')) || [];
        let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
        
        // Inicializar usu√°rios padr√£o se n√£o existirem
        if (usuarios.length === 0) {
            usuarios = [
                {
                    id: 1,
                    nome: 'Administrador',
                    cpf: '000.000.000-00',
                    telefone: '',
                    login: 'admin',
                    senha: 'admin123',
                    ativo: true,
                    permissoes: ['dashboard', 'eventos', 'personagens', 'elenco', 'motoristas', 'casas_festas', 'clientes', 'manutencao', 'financeiro', 'configuracoes']
                },
                {
                    id: 2,
                    nome: 'Ed Monteiro',
                    cpf: '111.111.111-11',
                    telefone: '',
                    login: 'ed',
                    senha: '1986',
                    ativo: true,
                    permissoes: ['dashboard', 'eventos', 'personagens', 'elenco', 'motoristas', 'casas_festas', 'clientes', 'manutencao', 'financeiro']
                },
                {
                    id: 3,
                    nome: 'Usu√°rio Teste',
                    cpf: '222.222.222-22',
                    telefone: '',
                    login: 'teste',
                    senha: 'adm123',
                    ativo: true,
                    permissoes: ['dashboard', 'eventos', 'clientes']
                }
            ];
            localStorage.setItem('usuarios', JSON.stringify(usuarios));
        }
        
        // Inicializar status_contrato e campos de valor avulso para eventos existentes
        eventos.forEach(evento => {
            if (!evento.status_contrato) {
                evento.status_contrato = 'pendente';
            }
            if (evento.valor_avulso === undefined) {
                evento.valor_avulso = '0';
                evento.forma_pagamento_avulso = 'Dinheiro';
                evento.valor_avulso_pago = false;
                evento.data_pagamento_avulso = null;
            }
        });
        localStorage.setItem('eventos', JSON.stringify(eventos));

        // Vari√°veis globais para manuten√ß√£o
        let itensManutencaoSelecionados = [];
        
        // Vari√°veis globais para cach√™s
        let cachesData = {};
        let tipoVisualizacao = 'todos';
        
        // Vari√°veis globais para edi√ß√£o de eventos
        let personagensEdicaoSelecionados = [];
        
        // Vari√°veis globais para escala√ß√£o
        let escalacoesEventos = JSON.parse(localStorage.getItem('escalacoes')) || {};
        let motoristasEscalaSelecionados = [];
        
        // Vari√°veis para pagina√ß√£o de eventos
        let paginaAtualEventos = 0;
        const eventosPorPagina = 10;
        
        // Vari√°veis para widgets
        let alarmTime = null;
        let alarmSet = false;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        
        // Fun√ß√£o para confirmar evento
        function confirmarEvento(eventoId) {
            if (confirm('Confirmar os dados deste evento?')) {
                const evento = eventos.find(e => e.id === eventoId);
                if (evento) {
                    evento.confirmado = true;
                    evento.data_confirmacao = new Date().toISOString();
                    localStorage.setItem('eventos', JSON.stringify(eventos));
                    
                    // Mostrar notifica√ß√£o de sucesso
                    const notification = document.createElement('div');
                    notification.innerHTML = '‚úÖ Evento confirmado com sucesso!';
                    notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 1rem; border-radius: 8px; z-index: 10001; font-weight: bold;';
                    document.body.appendChild(notification);
                    setTimeout(() => notification.remove(), 3000);
                    
                    carregarConfirmarDados();
                    atualizarContadores();
                }
            }
        }
        
        function carregarTodosEventos() {
            console.log('Carregando todos os eventos. Total:', eventos.length);
            eventos = JSON.parse(localStorage.getItem('eventos')) || [];
            console.log('Eventos ap√≥s reload:', eventos.length);
            
            if (eventos.length === 0) {
                document.getElementById('listaTodosEventos').innerHTML = '<div style="text-align: center; padding: 3rem; background: #f8f9fa; border-radius: 10px; color: #666;"><h3>üìã Nenhum evento cadastrado</h3><p>Cadastre seu primeiro evento para come√ßar!</p></div>';
                document.getElementById('infoEventos').textContent = 'Nenhum evento encontrado';
                return;
            }
            
            const eventosOrdenados = [...eventos].sort((a, b) => new Date(a.data_evento) - new Date(b.data_evento));
            
            const totalEventos = eventosOrdenados.length;
            const inicio = paginaAtualEventos * eventosPorPagina;
            const fim = inicio + eventosPorPagina;
            const eventosPagina = eventosOrdenados.slice(inicio, fim);
            
            document.getElementById('infoEventos').textContent = `P√°gina ${paginaAtualEventos + 1} de ${Math.ceil(totalEventos / eventosPorPagina)} (${totalEventos} eventos)`;
            
            document.getElementById('btnAnterior').disabled = paginaAtualEventos === 0;
            document.getElementById('btnProximo').disabled = fim >= totalEventos;
            
            let html = '';
            eventosPagina.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                
                const dataEvento = new Date(evento.data_evento);
                const hoje = new Date();
                hoje.setHours(0, 0, 0, 0);
                dataEvento.setHours(0, 0, 0, 0);
                
                const diasRestantes = Math.ceil((dataEvento - hoje) / (1000 * 60 * 60 * 24));
                
                let corCard = '#ffffff';
                let statusTexto = '';
                
                if (diasRestantes < 0) {
                    corCard = '#6c757d';
                    statusTexto = '‚ö´ Evento finalizado';
                } else if (diasRestantes === 0) {
                    corCard = '#28a745';
                    statusTexto = 'üü¢ Dia do evento';
                } else if (diasRestantes === 1) {
                    corCard = '#dc3545';
                    statusTexto = 'üî¥ 1 dia';
                } else if (diasRestantes <= 4) {
                    corCard = '#ffc107';
                    statusTexto = `üü° ${diasRestantes} dias`;
                } else {
                    corCard = '#007bff';
                    statusTexto = `üîµ ${diasRestantes} dias`;
                }
                
                if (!evento.sinal_pago) {
                    corCard = '#6f42c1';
                    statusTexto = 'üü£ Sinal n√£o pago';
                }
                
                let local = 'Local n√£o definido';
                if (casa) {
                    local = casa.nome_casa;
                } else if (evento.endereco_evento) {
                    local = `${evento.endereco_evento}, ${evento.numero_evento} - ${evento.bairro_evento}`;
                }
                
                html += `
                    <div style="background: ${corCard}; color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h4 style="margin: 0; font-size: 1.1rem;">${statusTexto}</h4>
                            <div style="display: flex; gap: 0.5rem;">
                                <button onclick="editarEvento(${evento.id})" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 0.5rem; border-radius: 5px; cursor: pointer;">‚úèÔ∏è</button>
                                <button onclick="excluirEvento(${evento.id})" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 0.5rem; border-radius: 5px; cursor: pointer;">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; font-size: 0.9rem;">
                            <div>
                                <strong>üìÖ Data:</strong> ${new Date(evento.data_evento).toLocaleDateString('pt-BR')}<br>
                                <strong>‚è∞ Hor√°rio:</strong> ${evento.hora_entrada} - ${evento.hora_saida}<br>
                                <strong>üë• Cliente:</strong> ${cliente?.nome_cliente || 'N√£o encontrado'}
                            </div>
                            <div>
                                <strong>üè† Local:</strong> ${local}<br>
                                <strong>üí∞ Valor Total:</strong> R$ ${parseFloat(evento.valor_total || 0).toFixed(2).replace('.', ',')}<br>
                                <strong>üíµ Sinal:</strong> ${evento.sinal_pago ? '‚úÖ Pago' : '‚ùå Pendente'}
                            </div>
                            <div>
                                <strong>ü¶Å Personagens:</strong> ${evento.personagens?.length || 0}<br>
                                <strong>üìã Status:</strong> ${evento.confirmado ? '‚úÖ Confirmado' : '‚è≥ Pendente'}<br>
                                <strong>üí≥ Restante:</strong> ${evento.pagamento_total_pago ? '‚úÖ Pago' : '‚ùå Pendente'}
                            </div>
                        </div>
                        
                        ${evento.observacoes ? `<div style="margin-top: 1rem; padding: 0.8rem; background: rgba(255,255,255,0.1); border-radius: 5px;"><strong>üìù Observa√ß√µes:</strong> ${evento.observacoes}</div>` : ''}
                    </div>
                `;
            });
            
            document.getElementById('listaTodosEventos').innerHTML = html;
        }
        
        function carregarEventosFuturos() {
            console.log('Carregando eventos futuros. Total de eventos:', eventos.length);
            eventos = JSON.parse(localStorage.getItem('eventos')) || [];
            console.log('Eventos futuros ap√≥s reload:', eventos.length);
            
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            const eventosFuturos = eventos.filter(e => {
                const dataEvento = new Date(e.data_evento);
                dataEvento.setHours(0, 0, 0, 0);
                return dataEvento >= hoje;
            }).sort((a, b) => new Date(a.data_evento) - new Date(b.data_evento)).slice(0, 15);
            
            console.log('Eventos futuros encontrados:', eventosFuturos.length);
            
            if (eventosFuturos.length === 0) {
                document.getElementById('listaEventosFuturos').innerHTML = '<div style="text-align: center; padding: 3rem; background: #f8f9fa; border-radius: 10px; color: #666;"><h3>üìÖ Nenhum evento futuro</h3><p>Todos os eventos est√£o no passado ou n√£o h√° eventos cadastrados.</p></div>';
                return;
            }
            
            let html = '';
            eventosFuturos.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                
                const dataEvento = new Date(evento.data_evento);
                const diasRestantes = Math.ceil((dataEvento - hoje) / (1000 * 60 * 60 * 24));
                
                let corCard = '#ffffff';
                let statusTexto = '';
                
                if (diasRestantes === 0) {
                    corCard = '#28a745';
                    statusTexto = 'üü¢ Hoje';
                } else if (diasRestantes === 1) {
                    corCard = '#dc3545';
                    statusTexto = 'üî¥ Amanh√£';
                } else if (diasRestantes <= 4) {
                    corCard = '#ffc107';
                    statusTexto = `üü° ${diasRestantes} dias`;
                } else {
                    corCard = '#007bff';
                    statusTexto = `üîµ ${diasRestantes} dias`;
                }
                
                if (!evento.sinal_pago) {
                    corCard = '#6f42c1';
                    statusTexto = 'üü£ Sinal n√£o pago';
                }
                
                let local = 'Local n√£o definido';
                if (casa) {
                    local = casa.nome_casa;
                } else if (evento.endereco_evento) {
                    local = `${evento.endereco_evento}, ${evento.numero_evento} - ${evento.bairro_evento}`;
                }
                
                html += `
                    <div style="background: ${corCard}; color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h4 style="margin: 0; font-size: 1.1rem;">${statusTexto}</h4>
                            <div style="display: flex; gap: 0.5rem;">
                                <button onclick="escalarEvento(${evento.id})" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 0.5rem; border-radius: 5px; cursor: pointer;">üë• Escalar</button>
                                <button onclick="editarEvento(${evento.id})" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 0.5rem; border-radius: 5px; cursor: pointer;">‚úèÔ∏è</button>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; font-size: 0.9rem;">
                            <div>
                                <strong>üìÖ Data:</strong> ${new Date(evento.data_evento).toLocaleDateString('pt-BR')}<br>
                                <strong>‚è∞ Hor√°rio:</strong> ${evento.hora_entrada} - ${evento.hora_saida}<br>
                                <strong>üë• Cliente:</strong> ${cliente?.nome_cliente || 'N√£o encontrado'}
                            </div>
                            <div>
                                <strong>üè† Local:</strong> ${local}<br>
                                <strong>üí∞ Valor Total:</strong> R$ ${parseFloat(evento.valor_total || 0).toFixed(2).replace('.', ',')}<br>
                                <strong>üíµ Sinal:</strong> ${evento.sinal_pago ? '‚úÖ Pago' : '‚ùå Pendente'}
                            </div>
                            <div>
                                <strong>ü¶Å Personagens:</strong> ${evento.personagens?.length || 0}<br>
                                <strong>üìã Status:</strong> ${evento.confirmado ? '‚úÖ Confirmado' : '‚è≥ Pendente'}<br>
                                <strong>üí≥ Restante:</strong> ${evento.pagamento_total_pago ? '‚úÖ Pago' : '‚ùå Pendente'}
                            </div>
                        </div>
                        
                        ${evento.observacoes ? `<div style="margin-top: 1rem; padding: 0.8rem; background: rgba(255,255,255,0.1); border-radius: 5px;"><strong>üìù Observa√ß√µes:</strong> ${evento.observacoes}</div>` : ''}
                    </div>
                `;
            });
            
            document.getElementById('listaEventosFuturos').innerHTML = html;
        }
        
        function carregarConfirmarDados() {
            console.log('Carregando eventos para confirmar dados. Total de eventos:', eventos.length);
            eventos = JSON.parse(localStorage.getItem('eventos')) || [];
            console.log('Eventos confirmar ap√≥s reload:', eventos.length);
            
            const eventosSinalPago = eventos.filter(e => {
                console.log(`Evento ${e.id}: sinal_pago=${e.sinal_pago}, confirmado=${e.confirmado}`);
                return e.sinal_pago && !e.confirmado;
            });
            
            console.log('Eventos com sinal pago para confirmar:', eventosSinalPago.length);
            
            if (eventosSinalPago.length === 0) {
                document.getElementById('listaConfirmarDados').innerHTML = '<div style="text-align: center; padding: 3rem; background: #f8f9fa; border-radius: 10px; color: #666;"><h3>‚úÖ Nenhum evento para confirmar</h3><p>Todos os eventos com sinal pago j√° foram confirmados ou n√£o h√° eventos com sinal pago.</p></div>';
                return;
            }
            
            let html = '';
            eventosSinalPago.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                
                let local = 'Local n√£o definido';
                if (casa) {
                    local = casa.nome_casa;
                } else if (evento.endereco_evento) {
                    local = `${evento.endereco_evento}, ${evento.numero_evento} - ${evento.bairro_evento}`;
                }
                
                html += `
                    <div style="background: #28a745; color: white; padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h4 style="margin: 0; font-size: 1.1rem;">‚úÖ Sinal Pago - Aguardando Confirma√ß√£o</h4>
                            <button onclick="confirmarEvento(${evento.id})" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 5px; cursor: pointer; font-weight: bold;">‚úÖ CONFIRMAR</button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; font-size: 0.9rem;">
                            <div>
                                <strong>üìÖ Data:</strong> ${new Date(evento.data_evento).toLocaleDateString('pt-BR')}<br>
                                <strong>‚è∞ Hor√°rio:</strong> ${evento.hora_entrada} - ${evento.hora_saida}<br>
                                <strong>üë• Cliente:</strong> ${cliente?.nome_cliente || 'N√£o encontrado'}
                            </div>
                            <div>
                                <strong>üè† Local:</strong> ${local}<br>
                                <strong>üí∞ Valor Total:</strong> R$ ${parseFloat(evento.valor_total || 0).toFixed(2).replace('.', ',')}<br>
                                <strong>üíµ Sinal:</strong> R$ ${parseFloat(evento.valor_sinal || 0).toFixed(2).replace('.', ',')}
                            </div>
                            <div>
                                <strong>ü¶Å Personagens:</strong> ${evento.personagens?.length || 0}<br>
                                <strong>üìÖ Pago em:</strong> ${evento.data_pagamento_sinal || 'N√£o informado'}<br>
                                <strong>üí≥ Forma:</strong> ${evento.forma_pagamento_sinal || 'N√£o informado'}
                            </div>
                        </div>
                        
                        ${evento.observacoes ? `<div style="margin-top: 1rem; padding: 0.8rem; background: rgba(255,255,255,0.1); border-radius: 5px;"><strong>üìù Observa√ß√µes:</strong> ${evento.observacoes}</div>` : ''}
                    </div>
                `;
            });
            
            document.getElementById('listaConfirmarDados').innerHTML = html;
        }
        
        function navegarEventos(direcao) {
            const totalEventos = eventos.length;
            const totalPaginas = Math.ceil(totalEventos / eventosPorPagina);
            
            paginaAtualEventos += direcao;
            
            if (paginaAtualEventos < 0) {
                paginaAtualEventos = 0;
            } else if (paginaAtualEventos >= totalPaginas) {
                paginaAtualEventos = totalPaginas - 1;
            }
            
            carregarTodosEventos();
        }
        
        // Inicializar widgets
        function initializeWidgets() {
            updateClock();
            updateCalendar();
            loadEventWeather();
            
            // Atualizar rel√≥gio a cada segundo
            setInterval(updateClock, 1000);
            
            // Verificar alarme a cada segundo
            setInterval(checkAlarm, 1000);
        }
        
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR');
            const dateString = now.toLocaleDateString('pt-BR');
            
            document.getElementById('clockDisplay').textContent = timeString;
            document.getElementById('dateDisplay').textContent = dateString;
        }
        
        function setAlarm() {
            const timeInput = document.getElementById('alarmTime').value;
            if (timeInput) {
                alarmTime = timeInput;
                alarmSet = true;
                document.getElementById('alarmStatus').innerHTML = `‚è∞ Alarme definido para ${timeInput}`;
                document.getElementById('alarmStatus').style.color = '#28a745';
            } else {
                alert('Por favor, defina um hor√°rio para o alarme!');
            }
        }
        
        function checkAlarm() {
            if (alarmSet && alarmTime) {
                const now = new Date();
                const currentTime = now.toTimeString().slice(0, 5);
                
                if (currentTime === alarmTime) {
                    alert('‚è∞ ALARME! Hora do compromisso!');
                    // Tocar som (se suportado pelo navegador)
                    try {
                        const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT');
                        audio.play();
                    } catch (e) {
                        console.log('Som do alarme n√£o suportado');
                    }
                    
                    alarmSet = false;
                    document.getElementById('alarmStatus').innerHTML = 'Alarme tocou!';
                    document.getElementById('alarmStatus').style.color = '#dc3545';
                }
            }
        }
        
        function updateCalendar() {
            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            document.getElementById('monthYear').textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const today = new Date();
            
            let calendarHTML = '';
            
            // Cabe√ßalho dos dias da semana
            const dayNames = ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'];
            dayNames.forEach(day => {
                calendarHTML += `<div style="font-weight: bold; background: #f0f0f0;">${day}</div>`;
            });
            
            // Dias vazios do in√≠cio
            for (let i = 0; i < firstDay; i++) {
                calendarHTML += '<div class="calendar-day other-month"></div>';
            }
            
            // Dias do m√™s
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = today.getDate() === day && 
                               today.getMonth() === currentMonth && 
                               today.getFullYear() === currentYear;
                
                calendarHTML += `<div class="calendar-day ${isToday ? 'today' : ''}">${day}</div>`;
            }
            
            document.getElementById('calendarGrid').innerHTML = calendarHTML;
        }
        
        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            updateCalendar();
        }
        
        function getWeather() {
            const city = document.getElementById('cityInput').value.trim();
            if (!city) {
                alert('Por favor, digite o nome de uma cidade!');
                return;
            }
            
            // Simula√ß√£o de previs√£o do tempo (em produ√ß√£o, usar API real)
            const weatherData = {
                city: city,
                temperature: Math.floor(Math.random() * 15) + 20, // 20-35¬∞C
                condition: ['Ensolarado', 'Parcialmente nublado', 'Nublado', 'Chuvoso'][Math.floor(Math.random() * 4)],
                humidity: Math.floor(Math.random() * 40) + 40, // 40-80%
                forecast: []
            };
            
            // Gerar previs√£o para 5 dias
            for (let i = 0; i < 5; i++) {
                const date = new Date();
                date.setDate(date.getDate() + i);
                weatherData.forecast.push({
                    date: date.toLocaleDateString('pt-BR', { weekday: 'short', day: '2-digit' }),
                    temp: Math.floor(Math.random() * 15) + 20,
                    condition: ['‚òÄÔ∏è', '‚õÖ', '‚òÅÔ∏è', 'üåßÔ∏è'][Math.floor(Math.random() * 4)]
                });
            }
            
            displayWeather(weatherData);
        }
        
        function displayWeather(data) {
            let html = `
                <div style="text-align: center; margin-bottom: 0.5rem;">
                    <strong>${data.city}</strong><br>
                    <span style="font-size: 1.2rem;">${data.temperature}¬∞C</span><br>
                    <span style="font-size: 0.8rem;">${data.condition}</span><br>
                    <span style="font-size: 0.7rem;">Umidade: ${data.humidity}%</span>
                </div>
                <div style="border-top: 1px solid #eee; padding-top: 0.5rem;">
                    <div style="font-size: 0.8rem; font-weight: bold; margin-bottom: 0.3rem;">Pr√≥ximos 5 dias:</div>
            `;
            
            data.forecast.forEach(day => {
                html += `
                    <div class="weather-item">
                        <span>${day.date}</span>
                        <span>${day.condition} ${day.temp}¬∞C</span>
                    </div>
                `;
            });
            
            html += '</div>';
            document.getElementById('weatherDisplay').innerHTML = html;
        }
        
        function loadEventWeather() {
            // Carregar previs√£o do tempo para locais de eventos futuros (hoje + 15 dias)
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            const quinzeDias = new Date(hoje);
            quinzeDias.setDate(hoje.getDate() + 15);
            
            const eventosProximos = eventos.filter(e => {
                const dataEvento = new Date(e.data_evento);
                dataEvento.setHours(0, 0, 0, 0);
                return dataEvento >= hoje && dataEvento <= quinzeDias;
            }).sort((a, b) => new Date(a.data_evento) - new Date(b.data_evento));
            
            if (eventosProximos.length === 0) {
                document.getElementById('eventWeatherDisplay').innerHTML = '<div style="text-align: center; color: #666; font-size: 0.8rem; padding: 1rem;">Nenhum evento nos pr√≥ximos 15 dias</div>';
                return;
            }
            
            let html = '';
            eventosProximos.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                
                let local = 'Local n√£o definido';
                let endereco = '';
                let cidade = '';
                if (casa) {
                    local = casa.nome_casa;
                    endereco = `${casa.logradouro}, ${casa.numero} - ${casa.bairro}, ${casa.cidade}/${casa.estado}`;
                    cidade = casa.cidade;
                } else if (evento.endereco_evento) {
                    local = 'Local do Evento';
                    endereco = `${evento.endereco_evento}, ${evento.numero_evento} - ${evento.bairro_evento}, ${evento.cidade_evento}/${evento.estado_evento}`;
                    cidade = evento.cidade_evento;
                }
                
                // Simula√ß√£o de previs√£o em tempo real baseada na data
                const dataEvento = new Date(evento.data_evento);
                const diasRestantes = Math.ceil((dataEvento - hoje) / (1000 * 60 * 60 * 24));
                
                // Temperatura baseada na √©poca do ano e localiza√ß√£o
                const mes = dataEvento.getMonth();
                let tempBase = 25;
                if (mes >= 5 && mes <= 8) tempBase = 20; // Inverno
                else if (mes >= 11 || mes <= 2) tempBase = 30; // Ver√£o
                const temp = tempBase + Math.floor(Math.random() * 10) - 5;
                
                const conditions = ['‚òÄÔ∏è', '‚õÖ', '‚òÅÔ∏è', 'üåßÔ∏è'];
                const conditionNames = ['Ensolarado', 'Parcialmente nublado', 'Nublado', 'Chuvoso'];
                const conditionIndex = Math.floor(Math.random() * 4);
                const condition = conditions[conditionIndex];
                const conditionName = conditionNames[conditionIndex];
                
                // Tr√¢nsito em tempo real baseado no hor√°rio e dia da semana
                const diaSemana = dataEvento.getDay();
                const horaEvento = evento.hora_entrada ? parseInt(evento.hora_entrada.split(':')[0]) : 14;
                
                let transitoStatus = 'livre';
                let transitoDetalhes = 'Vias fluindo normalmente';
                
                // L√≥gica de tr√¢nsito mais realista
                if (diaSemana >= 1 && diaSemana <= 5) { // Dias √∫teis
                    if ((horaEvento >= 7 && horaEvento <= 9) || (horaEvento >= 17 && horaEvento <= 19)) {
                        transitoStatus = Math.random() > 0.3 ? 'congestionado' : 'atencao';
                        transitoDetalhes = transitoStatus === 'congestionado' ? 'Tr√¢nsito intenso - hor√°rio de pico' : 'Movimento moderado';
                    } else if (horaEvento >= 11 && horaEvento <= 16) {
                        transitoStatus = Math.random() > 0.7 ? 'atencao' : 'livre';
                        transitoDetalhes = transitoStatus === 'atencao' ? 'Tr√¢nsito moderado' : 'Vias livres';
                    }
                } else { // Fins de semana
                    if (horaEvento >= 14 && horaEvento <= 18) {
                        transitoStatus = Math.random() > 0.5 ? 'atencao' : 'livre';
                        transitoDetalhes = transitoStatus === 'atencao' ? 'Movimento de fim de semana' : 'Vias livres';
                    }
                }
                
                // Adicionar fatores aleat√≥rios para acidentes/obras
                if (Math.random() > 0.9) {
                    transitoStatus = 'acidente';
                    transitoDetalhes = 'Acidente reportado na regi√£o';
                }
                
                const transitoIcon = {
                    'livre': 'üü¢',
                    'atencao': 'üü°',
                    'congestionado': 'üî¥',
                    'acidente': 'üö®'
                };
                
                const transitoTexto = {
                    'livre': 'Livre',
                    'atencao': 'Moderado',
                    'congestionado': 'Intenso',
                    'acidente': 'Acidente'
                };
                
                // Cor do card baseada na proximidade do evento
                let corCard = '#f8f9fa';
                if (diasRestantes === 0) corCard = '#d4edda'; // Verde - hoje
                else if (diasRestantes === 1) corCard = '#fff3cd'; // Amarelo - amanh√£
                else if (diasRestantes <= 3) corCard = '#f8d7da'; // Vermelho - 2-3 dias
                
                html += `
                    <div class="weather-item" style="flex-direction: column; align-items: flex-start; padding: 0.8rem; cursor: pointer; border-radius: 8px; background: ${corCard}; margin-bottom: 0.5rem; border: 1px solid #dee2e6; transition: all 0.2s;" onclick="showEventWeatherDetail('${evento.id}', '${local}', '${evento.data_evento}', '${endereco}', '${cidade}', '${conditionName}', ${temp}, '${transitoDetalhes}', '${transitoStatus}')" onmouseover="this.style.transform='scale(1.02)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none'">
                        <div style="display: flex; justify-content: space-between; width: 100%; margin-bottom: 0.3rem;">
                            <div style="font-weight: bold; font-size: 0.85rem; color: #333;">${new Date(evento.data_evento).toLocaleDateString('pt-BR')}</div>
                            <div style="font-size: 0.7rem; color: #666; background: white; padding: 0.2rem 0.4rem; border-radius: 10px;">${diasRestantes === 0 ? 'HOJE' : diasRestantes === 1 ? 'AMANH√É' : `${diasRestantes} dias`}</div>
                        </div>
                        <div style="font-size: 0.75rem; color: #666; margin-bottom: 0.2rem;">${cliente?.nome_cliente || 'Cliente n√£o encontrado'}</div>
                        <div style="font-size: 0.75rem; margin-bottom: 0.4rem; font-weight: 500;">${local}</div>
                        <div style="font-size: 0.7rem; color: #666; margin-bottom: 0.4rem;">${cidade || 'Cidade n√£o informada'} ‚Ä¢ ${evento.hora_entrada || 'Hor√°rio n√£o definido'}</div>
                        <div style="display: flex; justify-content: space-between; width: 100%; font-size: 0.75rem;">
                            <span style="display: flex; align-items: center; gap: 0.3rem;"><span style="font-size: 1rem;">${condition}</span> ${temp}¬∞C</span>
                            <span style="display: flex; align-items: center; gap: 0.3rem; font-weight: 500;"><span style="font-size: 1rem;">${transitoIcon[transitoStatus]}</span> ${transitoTexto[transitoStatus]}</span>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('eventWeatherDisplay').innerHTML = html;
            
            // Atualizar a cada 2 minutos para simular tempo real
            setTimeout(loadEventWeather, 120000);
        }
        
        function showEventWeatherDetail(eventoId, local, dataEvento, endereco, cidade, conditionName, temp, transitoDetalhes, transitoStatus) {
            // Dados mais detalhados baseados nos par√¢metros recebidos
            const humidity = Math.floor(Math.random() * 40) + 40;
            const windSpeed = Math.floor(Math.random() * 20) + 5;
            const pressure = Math.floor(Math.random() * 50) + 1000;
            const uvIndex = Math.floor(Math.random() * 11);
            
            const icons = {
                'Ensolarado': '‚òÄÔ∏è',
                'Parcialmente nublado': '‚õÖ',
                'Nublado': '‚òÅÔ∏è',
                'Chuvoso': 'üåßÔ∏è'
            };
            const icon = icons[conditionName] || '‚òÄÔ∏è';
            
            const transitoInfo = {
                'livre': { icon: 'üü¢', texto: 'Tr√¢nsito Livre', cor: '#28a745' },
                'atencao': { icon: 'üü°', texto: 'Moderado', cor: '#ffc107' },
                'congestionado': { icon: 'üî¥', texto: 'Intenso', cor: '#dc3545' },
                'acidente': { icon: 'üö®', texto: 'Acidente', cor: '#6f42c1' }
            };
            
            // Buscar dados do evento
            const evento = eventos.find(e => e.id == eventoId);
            const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento?.cpf_cliente.replace(/\D/g, ''));
            
            // Calcular tempo estimado de viagem baseado no tr√¢nsito
            let tempoViagem = '25-35 min';
            if (transitoStatus === 'congestionado') tempoViagem = '45-60 min';
            else if (transitoStatus === 'atencao') tempoViagem = '30-40 min';
            else if (transitoStatus === 'acidente') tempoViagem = '60+ min';
            
            // Recomenda√ß√µes baseadas no clima e tr√¢nsito
            let recomendacoes = [];
            if (conditionName === 'Chuvoso') recomendacoes.push('üåßÔ∏è Leve guarda-chuva');
            if (temp > 30) recomendacoes.push('üå°Ô∏è Dia quente - hidrate-se');
            if (temp < 18) recomendacoes.push('üß• Dia frio - leve casaco');
            if (transitoStatus === 'congestionado') recomendacoes.push('üöó Saia com anteced√™ncia');
            if (transitoStatus === 'acidente') recomendacoes.push('üö® Considere rota alternativa');
            
            const detailHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 10000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(3px);" onclick="closeWeatherDetail()">
                    <div style="background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%); padding: 2rem; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 500px; width: 95%; max-height: 90vh; overflow-y: auto;" onclick="event.stopPropagation()">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 style="color: #8B4513; margin: 0;">üå§Ô∏è Condi√ß√µes em Tempo Real</h3>
                            <button onclick="closeWeatherDetail()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">√ó</button>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 2rem; padding: 1.5rem; background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); border-radius: 15px;">
                            <div style="font-size: 4rem; margin-bottom: 0.5rem;">${icon}</div>
                            <div style="font-size: 2.5rem; font-weight: bold; color: #333; margin-bottom: 0.3rem;">${temp}¬∞C</div>
                            <div style="font-size: 1.2rem; color: #666; margin-bottom: 0.5rem;">${conditionName}</div>
                            <div style="font-size: 0.9rem; color: #888;">${cidade || 'Localiza√ß√£o'}</div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; border: 1px solid #dee2e6;">
                            <div style="font-weight: bold; margin-bottom: 1rem; color: #8B4513; display: flex; align-items: center; gap: 0.5rem;">üìç Informa√ß√µes do Evento</div>
                            <div style="font-size: 0.95rem; line-height: 1.6;">
                                <div style="margin-bottom: 0.5rem;"><strong>Data:</strong> ${new Date(dataEvento).toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
                                <div style="margin-bottom: 0.5rem;"><strong>Hor√°rio:</strong> ${evento?.hora_entrada || 'N√£o definido'}</div>
                                <div style="margin-bottom: 0.5rem;"><strong>Cliente:</strong> ${cliente?.nome_cliente || 'N√£o encontrado'}</div>
                                <div style="margin-bottom: 0.5rem;"><strong>Local:</strong> ${local}</div>
                                <div><strong>Endere√ßo:</strong> ${endereco || 'N√£o informado'}</div>
                            </div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, ${transitoInfo[transitoStatus].cor}15 0%, ${transitoInfo[transitoStatus].cor}05 100%); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; border-left: 4px solid ${transitoInfo[transitoStatus].cor};">
                            <div style="font-weight: bold; margin-bottom: 1rem; color: #333; display: flex; align-items: center; gap: 0.5rem;">üöó Condi√ß√µes de Tr√¢nsito</div>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <span style="font-size: 2rem;">${transitoInfo[transitoStatus].icon}</span>
                                <div>
                                    <div style="font-weight: bold; color: #333; font-size: 1.1rem;">${transitoInfo[transitoStatus].texto}</div>
                                    <div style="font-size: 0.9rem; color: #666; margin-top: 0.2rem;">${transitoDetalhes}</div>
                                </div>
                            </div>
                            <div style="background: rgba(255,255,255,0.7); padding: 0.8rem; border-radius: 8px; font-size: 0.9rem;">
                                <strong>‚è±Ô∏è Tempo estimado:</strong> ${tempoViagem}
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                            <div style="text-align: center; padding: 1rem; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 10px;">
                                <div style="font-size: 0.8rem; color: #666; margin-bottom: 0.3rem;">üíß Umidade</div>
                                <div style="font-size: 1.4rem; font-weight: bold; color: #1976d2;">${humidity}%</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); border-radius: 10px;">
                                <div style="font-size: 0.8rem; color: #666; margin-bottom: 0.3rem;">üí® Vento</div>
                                <div style="font-size: 1.4rem; font-weight: bold; color: #7b1fa2;">${windSpeed} km/h</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: linear-gradient(135deg, #fff3e0 0%, #ffcc80 100%); border-radius: 10px;">
                                <div style="font-size: 0.8rem; color: #666; margin-bottom: 0.3rem;">üìä Press√£o</div>
                                <div style="font-size: 1.4rem; font-weight: bold; color: #f57c00;">${pressure} hPa</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: linear-gradient(135deg, #fff8e1 0%, #fff176 100%); border-radius: 10px;">
                                <div style="font-size: 0.8rem; color: #666; margin-bottom: 0.3rem;">‚òÄÔ∏è √çndice UV</div>
                                <div style="font-size: 1.4rem; font-weight: bold; color: #f9a825;">${uvIndex}</div>
                            </div>
                        </div>
                        
                        ${recomendacoes.length > 0 ? `
                        <div style="background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%); padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; border-left: 4px solid #4caf50;">
                            <div style="font-weight: bold; margin-bottom: 1rem; color: #2e7d32; display: flex; align-items: center; gap: 0.5rem;">üí° Recomenda√ß√µes</div>
                            <div style="font-size: 0.9rem; line-height: 1.6;">
                                ${recomendacoes.map(rec => `<div style="margin-bottom: 0.5rem;">${rec}</div>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <div style="display: flex; gap: 1rem;">
                            <button onclick="atualizarTempoReal('${eventoId}')" style="flex: 1; padding: 1rem; background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: 500;">
                                üîÑ Atualizar
                            </button>
                            <button onclick="closeWeatherDetail()" style="flex: 1; padding: 1rem; background: linear-gradient(135deg, #2196f3 0%, #42a5f5 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: 500;">
                                Fechar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', detailHTML);
        }
        
        function closeWeatherDetail() {
            const modal = document.querySelector('[style*="position: fixed"][style*="z-index: 10000"]');
            if (modal) modal.remove();
        }
        
        function atualizarTempoReal(eventoId) {
            // Simular atualiza√ß√£o em tempo real
            const loadingHTML = '<div style="text-align: center; padding: 1rem;"><div style="display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite;"></div><br>Atualizando...</div>';
            document.getElementById('eventWeatherDisplay').innerHTML = loadingHTML;
            
            // Adicionar anima√ß√£o de loading
            const style = document.createElement('style');
            style.textContent = '@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';
            document.head.appendChild(style);
            
            setTimeout(() => {
                loadEventWeather();
                closeWeatherDetail();
                // Mostrar notifica√ß√£o de atualiza√ß√£o
                const notification = document.createElement('div');
                notification.innerHTML = '‚úÖ Condi√ß√µes atualizadas!';
                notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 1rem; border-radius: 8px; z-index: 10001; font-weight: bold;';
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }, 2000);
        }

        // Sistema de Login
        function fazerLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            const usuario = usuarios.find(u => u.login === username && u.senha === password && u.ativo);
            
            if (usuario) {
                localStorage.setItem('bbb_logged_in', 'true');
                localStorage.setItem('bbb_user_id', usuario.id);
                localStorage.setItem('bbb_user_permissions', JSON.stringify(usuario.permissoes));
                document.getElementById('loginError').style.display = 'none';
                document.getElementById('loginScreen').classList.remove('active');
                document.getElementById('mainScreen').classList.add('active');
                
                // Aplicar permiss√µes ap√≥s o DOM estar pronto
                setTimeout(() => {
                    aplicarPermissoes(usuario.permissoes);
                    const currentPage = localStorage.getItem('bbb_current_page') || 'dashboard';
                    showPage(currentPage);
                }, 50);
            } else {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('loginError').textContent = 'Usu√°rio ou senha incorretos ou usu√°rio desabilitado!';
            }
        }

        function logout() {
            localStorage.removeItem('bbb_logged_in');
            localStorage.removeItem('bbb_user_id');
            localStorage.removeItem('bbb_user_permissions');
            document.getElementById('mainScreen').classList.remove('active');
            document.getElementById('loginScreen').classList.add('active');
            document.getElementById('loginForm').reset();
            document.getElementById('loginError').style.display = 'none';
            // Restaurar todos os bot√µes da navega√ß√£o
            document.querySelectorAll('.nav-btn').forEach(btn => btn.style.display = 'inline-block');
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            localStorage.setItem('bbb_current_page', pageId);
            
            if (pageId === 'dashboard') atualizarContadores();
            if (pageId === 'lista_personagens') carregarPersonagens();
            if (pageId === 'lista_elenco') carregarElenco();
            if (pageId === 'lista_motoristas') carregarMotoristas();
            if (pageId === 'lista_casas') carregarCasas();
            if (pageId === 'lista_clientes') carregarClientes();
            if (pageId === 'usuarios_cadastrados') carregarUsuarios();
            if (pageId === 'reservar_evento') {
                carregarCasasFestas();
                carregarPersonagensSelect();
            }
            if (pageId === 'todos_eventos') {
                paginaAtualEventos = 0;
                recarregarDados();
                console.log('Navegando para todos os eventos. Total:', eventos.length);
                carregarTodosEventos();
            }
            if (pageId === 'eventos_futuros') {
                recarregarDados();
                console.log('Navegando para eventos futuros. Total:', eventos.length);
                carregarEventosFuturos();
            }
            if (pageId === 'confirmar_dados') {
                recarregarDados();
                console.log('Navegando para confirmar dados. Total:', eventos.length);
                carregarConfirmarDados();
            }
            if (pageId === 'equipe_escalada') carregarEquipeEscalada();
            if (pageId === 'eventos_pendente_escala') carregarEventosPendenteEscala();
            if (pageId === 'relatorio_escalacoes') carregarRelatorioEscalacoes();
            if (pageId === 'relatorio_eventos_finalizados') carregarEventosFinalizados();
            if (pageId === 'relatorio_confirmacao_dados') carregarRelatorioConfirmacao();
            if (pageId === 'cadastro_manutencao') {
                carregarPersonagensManutencao();
                document.getElementById('data_registro').value = new Date().toISOString().split('T')[0];
            }
            if (pageId === 'lista_manutencao') carregarManutencoes();
            if (pageId === 'pagamentos_receber') carregarPagamentosReceber();
            if (pageId === 'pagamentos_pagos') carregarPagamentosPagos();
            if (pageId === 'fechamento_mensal') {
                document.getElementById('mesAno').value = new Date().toISOString().slice(0, 7);
            }
            if (pageId === 'pagamento_caches') {
                document.getElementById('mesAnoCaches').value = new Date().toISOString().slice(0, 7);
            }
            
            // Atualizar previs√£o do tempo dos eventos quando navegar para p√°ginas relacionadas
            if (pageId.includes('evento') || pageId === 'dashboard') {
                setTimeout(loadEventWeather, 100);
            }
        }

        function toggleSubmenu(menuId) {
            const menu = document.getElementById(menuId);
            menu.classList.toggle('active');
        }
        
        function gerarRelatorioEventos() {
            mostrarOpcoesRelatorio('eventos');
        }
        
        function mostrarOpcoesRelatorio(tipo) {
            const opcoes = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="fecharOpcoesRelatorio()">
                    <div style="background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
                        <h3 style="margin-bottom: 1rem; text-align: center;">Escolha o formato do relat√≥rio</h3>
                        <div style="display: flex; gap: 1rem;">
                            <button onclick="gerarRelatorio('${tipo}', 'csv')" style="background: #28a745; color: white; border: none; padding: 1rem 2rem; border-radius: 5px; cursor: pointer; font-size: 1rem;">
                                üìÑ CSV
                            </button>
                            <button onclick="gerarRelatorio('${tipo}', 'pdf')" style="background: #dc3545; color: white; border: none; padding: 1rem 2rem; border-radius: 5px; cursor: pointer; font-size: 1rem;">
                                üìÅ PDF
                            </button>
                        </div>
                        <button onclick="fecharOpcoesRelatorio()" style="background: #6c757d; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; margin-top: 1rem; width: 100%;">
                            Cancelar
                        </button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', opcoes);
        }
        
        function fecharOpcoesRelatorio() {
            const modal = document.querySelector('[style*="position: fixed"]');
            if (modal) modal.remove();
        }
        
        function gerarRelatorio(tipo, formato) {
            fecharOpcoesRelatorio();
            
            let dados = [];
            let nomeArquivo = '';
            
            switch(tipo) {
                case 'eventos':
                    dados = eventos.map(e => ({
                        Data: e.data_evento,
                        Cliente: clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === e.cpf_cliente.replace(/\D/g, ''))?.nome_cliente || 'N/A',
                        Valor: `R$ ${parseFloat(e.valor_total || 0).toFixed(2).replace('.', ',')}`,
                        Status: e.sinal_pago ? 'Pago' : 'Pendente'
                    }));
                    nomeArquivo = 'relatorio_eventos';
                    break;
                case 'personagens':
                    dados = personagens.map(p => ({
                        Personagem: p.personagem,
                        Figurino: p.figurino || 'N/A',
                        Tema: p.tema || 'N/A',
                        Quantidade: p.quantidade,
                        Valor: `R$ ${parseFloat(p.valor).toFixed(2).replace('.', ',')}`
                    }));
                    nomeArquivo = 'relatorio_personagens';
                    break;
                case 'elenco':
                    dados = elenco.map(e => ({
                        Nome: e.nome_completo,
                        CPF: e.cpf,
                        Perfil: e.perfil,
                        WhatsApp: e.whatsapp || 'N/A',
                        PIX: e.chave_pix || 'N/A'
                    }));
                    nomeArquivo = 'relatorio_elenco';
                    break;
                case 'motoristas':
                    dados = motoristas.map(m => ({
                        Nome: m.nome_completo,
                        CPF: m.cpf,
                        Carro: m.modelo_carro,
                        WhatsApp: m.whatsapp || 'N/A',
                        PIX: m.chave_pix || 'N/A'
                    }));
                    nomeArquivo = 'relatorio_motoristas';
                    break;
                case 'casas':
                    dados = casas.map(c => ({
                        Nome: c.nome_casa,
                        Endereco: `${c.logradouro}, ${c.numero}`,
                        Bairro: c.bairro,
                        Cidade: c.cidade,
                        Telefone: c.telefone || 'N/A'
                    }));
                    nomeArquivo = 'relatorio_casas';
                    break;
                case 'clientes':
                    dados = clientes.map(c => ({
                        Nome: c.nome_cliente,
                        CPF: c.cpf_cliente,
                        Aniversariante: c.nome_aniversariante,
                        Telefone: c.telefone_cliente || 'N/A',
                        Email: c.email_cliente || 'N/A'
                    }));
                    nomeArquivo = 'relatorio_clientes';
                    break;
                case 'manutencao':
                    dados = manutencoes.map(m => ({
                        Data: m.data_registro,
                        Personagem: personagens.find(p => p.id == m.personagem_id)?.personagem || 'N/A',
                        Status: m.status,
                        Itens: m.itens.length
                    }));
                    nomeArquivo = 'relatorio_manutencao';
                    break;
                case 'financeiro':
                    dados = eventos.map(e => ({
                        Data: e.data_evento,
                        Cliente: clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === e.cpf_cliente.replace(/\D/g, ''))?.nome_cliente || 'N/A',
                        ValorTotal: `R$ ${parseFloat(e.valor_total || 0).toFixed(2).replace('.', ',')}`,
                        Sinal: `R$ ${parseFloat(e.valor_sinal || 0).toFixed(2).replace('.', ',')}`,
                        SinalPago: e.sinal_pago ? 'Sim' : 'N√£o',
                        RestantePago: e.valor_restante_pago ? 'Sim' : 'N√£o'
                    }));
                    nomeArquivo = 'relatorio_financeiro';
                    break;
            }
            
            if (formato === 'csv') {
                baixarCSV(dados, `${nomeArquivo}.csv`);
            } else {
                gerarPDF(dados, nomeArquivo);
            }
        }
        
        function gerarRelatorioPersonagens() {
            mostrarOpcoesRelatorio('personagens');
        }
        
        function gerarRelatorioElenco() {
            mostrarOpcoesRelatorio('elenco');
        }
        
        function gerarRelatorioMotoristas() {
            mostrarOpcoesRelatorio('motoristas');
        }
        
        function gerarRelatorioCasas() {
            mostrarOpcoesRelatorio('casas');
        }
        
        function gerarRelatorioClientes() {
            mostrarOpcoesRelatorio('clientes');
        }
        
        function gerarRelatorioManutencao() {
            mostrarOpcoesRelatorio('manutencao');
        }
        
        function gerarRelatorioFinanceiro() {
            mostrarOpcoesRelatorio('financeiro');
        }
        
        // Fun√ß√µes para excluir dados
        function excluirTodosEventos() {
            if (confirm('Tem certeza que deseja excluir TODOS os eventos? Esta a√ß√£o n√£o pode ser desfeita!')) {
                eventos = [];
                localStorage.setItem('eventos', JSON.stringify(eventos));
                alert('‚úÖ Todos os eventos foram exclu√≠dos!');
                location.reload();
            }
        }
        
        function excluirTodosPersonagens() {
            if (confirm('Tem certeza que deseja excluir TODOS os personagens? Esta a√ß√£o n√£o pode ser desfeita!')) {
                personagens = [];
                localStorage.setItem('personagens', JSON.stringify(personagens));
                alert('‚úÖ Todos os personagens foram exclu√≠dos!');
                location.reload();
            }
        }
        
        function excluirTodoElenco() {
            if (confirm('Tem certeza que deseja excluir TODO o elenco? Esta a√ß√£o n√£o pode ser desfeita!')) {
                elenco = [];
                localStorage.setItem('elenco', JSON.stringify(elenco));
                alert('‚úÖ Todo o elenco foi exclu√≠do!');
                location.reload();
            }
        }
        
        function excluirTodosMotoristas() {
            if (confirm('Tem certeza que deseja excluir TODOS os motoristas? Esta a√ß√£o n√£o pode ser desfeita!')) {
                motoristas = [];
                localStorage.setItem('motoristas', JSON.stringify(motoristas));
                alert('‚úÖ Todos os motoristas foram exclu√≠dos!');
                location.reload();
            }
        }
        
        function excluirTodasCasas() {
            if (confirm('Tem certeza que deseja excluir TODAS as casas de festas? Esta a√ß√£o n√£o pode ser desfeita!')) {
                casas = [];
                localStorage.setItem('casas', JSON.stringify(casas));
                alert('‚úÖ Todas as casas de festas foram exclu√≠das!');
                location.reload();
            }
        }
        
        function excluirTodosClientes() {
            if (confirm('Tem certeza que deseja excluir TODOS os clientes? Esta a√ß√£o n√£o pode ser desfeita!')) {
                clientes = [];
                localStorage.setItem('clientes', JSON.stringify(clientes));
                alert('‚úÖ Todos os clientes foram exclu√≠dos!');
                location.reload();
            }
        }
        
        function excluirTodasManutencoes() {
            if (confirm('Tem certeza que deseja excluir TODAS as manuten√ß√µes? Esta a√ß√£o n√£o pode ser desfeita!')) {
                manutencoes = [];
                localStorage.setItem('manutencoes', JSON.stringify(manutencoes));
                alert('‚úÖ Todas as manuten√ß√µes foram exclu√≠das!');
                location.reload();
            }
        }
        
        function excluirDadosFinanceiros() {
            if (confirm('Tem certeza que deseja excluir TODOS os dados financeiros? Esta a√ß√£o n√£o pode ser desfeita!')) {
                eventos.forEach(e => {
                    e.sinal_pago = false;
                    e.valor_restante_pago = false;
                    e.data_pagamento_sinal = null;
                    e.data_pagamento_restante = null;
                });
                localStorage.setItem('eventos', JSON.stringify(eventos));
                alert('Dados financeiros exclu√≠dos com sucesso!');
                location.reload();
            }
        }
        
        function baixarCSV(dados, nomeArquivo) {
            if (dados.length === 0) {
                alert('Nenhum dado para exportar!');
                return;
            }
            
            const cabecalhos = Object.keys(dados[0]);
            let csv = cabecalhos.join(',') + '\n';
            
            dados.forEach(linha => {
                const valores = cabecalhos.map(cabecalho => {
                    const valor = linha[cabecalho] || '';
                    return `"${valor.toString().replace(/"/g, '""')}"`;
                });
                csv += valores.join(',') + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = nomeArquivo;
            link.click();
        }
        
        function gerarPDF(dados, nomeArquivo) {
            if (dados.length === 0) {
                alert('Nenhum dado para exportar!');
                return;
            }
            
            // Criar conte√∫do HTML para PDF
            let html = `
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${nomeArquivo}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        h1 { color: #8B4513; text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                    </style>
                </head>
                <body>
                    <h1>BBB FESTA - ${nomeArquivo.replace('_', ' ').toUpperCase()}</h1>
                    <table>
                        <thead>
                            <tr>
            `;
            
            // Adicionar cabe√ßalhos
            const cabecalhos = Object.keys(dados[0]);
            cabecalhos.forEach(cabecalho => {
                html += `<th>${cabecalho}</th>`;
            });
            
            html += `
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // Adicionar dados
            dados.forEach(linha => {
                html += '<tr>';
                cabecalhos.forEach(cabecalho => {
                    html += `<td>${linha[cabecalho] || ''}</td>`;
                });
                html += '</tr>';
            });
            
            html += `
                        </tbody>
                    </table>
                    <p style="text-align: center; margin-top: 30px; color: #666;">
                        Gerado em: ${new Date().toLocaleString('pt-BR')}
                    </p>
                </body>
                </html>
            `;
            
            // Abrir em nova janela para impress√£o/PDF
            const novaJanela = window.open('', '_blank');
            novaJanela.document.write(html);
            novaJanela.document.close();
            
            // Aguardar carregamento e imprimir
            setTimeout(() => {
                novaJanela.print();
            }, 500);
        }
        
        function toggleDataPagamentoAvulso() {
            const select = document.getElementById('valor_avulso_pago');
            const div = document.getElementById('dataPagamentoAvulsoDiv');
            const input = document.getElementById('dataPagamentoAvulso');
            
            if (select.value === 'true') {
                div.style.display = 'block';
                input.value = new Date().toLocaleString('pt-BR');
            } else {
                div.style.display = 'none';
                input.value = '';
            }
        }

        function atualizarContadores() {
            document.getElementById('countPersonagens').textContent = personagens.length;
            document.getElementById('countElenco').textContent = elenco.length;
            document.getElementById('countMotoristas').textContent = motoristas.length;
            document.getElementById('countCasas').textContent = casas.length;
            document.getElementById('countClientes').textContent = clientes.length;
            document.getElementById('countEventos').textContent = eventos.length;
            document.getElementById('countManutencao').textContent = manutencoes.length;
            
            const totalAReceber = calcularTotalAReceber();
            document.getElementById('countFinanceiro').textContent = `R$ ${totalAReceber.toFixed(2).replace('.', ',')}`;
        }

        // Formul√°rio de Personagens
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                fazerLogin();
            });

            document.getElementById('personagensForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const valorFormatado = formData.get('valor');
                const valorNumerico = valorFormatado.replace(/[R$\s\.]/g, '').replace(',', '.');
                
                const personagem = {
                    id: Date.now(),
                    personagem: formData.get('personagem'),
                    figurino: formData.get('figurino'),
                    tema: formData.get('tema'),
                    quantidade: formData.get('quantidade'),
                    valor: valorNumerico,
                    cache_individual: removerFormatacaoMoeda(formData.get('cache_personagem')) || '0',
                    foto: null
                };
                
                const fotoFile = formData.get('foto');
                if (fotoFile && fotoFile.size > 0) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        personagem.foto = e.target.result;
                        salvarPersonagem(personagem);
                    };
                    reader.readAsDataURL(fotoFile);
                } else {
                    salvarPersonagem(personagem);
                }
            });

            document.getElementById('elencoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const perfis = [];
                document.querySelectorAll('input[name="perfil"]:checked').forEach(cb => {
                    perfis.push(cb.value);
                });
                
                const membro = {
                    id: Date.now(),
                    nome_completo: formData.get('nome_completo'),
                    cpf: formData.get('cpf'),
                    data_nascimento: formData.get('data_nascimento'),
                    whatsapp: formData.get('whatsapp'),
                    altura: formData.get('altura'),
                    calcado: formData.get('calcado'),
                    perfil: perfis.join(', '),
                    chave_pix: formData.get('chave_pix'),
                    cache: removerFormatacaoMoeda(formData.get('cache')) || '0',
                    foto: null
                };
                
                const fotoFile = formData.get('foto');
                if (fotoFile && fotoFile.size > 0) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        membro.foto = e.target.result;
                        salvarElenco(membro);
                    };
                    reader.readAsDataURL(fotoFile);
                } else {
                    salvarElenco(membro);
                }
            });

            document.getElementById('motoristasForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const perfisMotorista = [];
                document.querySelectorAll('input[name="perfil_motorista"]:checked').forEach(cb => {
                    perfisMotorista.push(cb.value);
                });
                
                const motorista = {
                    id: Date.now(),
                    nome_completo: formData.get('nome_completo'),
                    cpf: formData.get('cpf'),
                    whatsapp: formData.get('whatsapp'),
                    modelo_carro: formData.get('modelo_carro'),
                    perfil: perfisMotorista.join(', '),
                    chave_pix: formData.get('chave_pix'),
                    foto: null
                };
                
                const fotoFile = formData.get('foto');
                if (fotoFile && fotoFile.size > 0) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        motorista.foto = e.target.result;
                        salvarMotorista(motorista);
                    };
                    reader.readAsDataURL(fotoFile);
                } else {
                    salvarMotorista(motorista);
                }
            });

            document.getElementById('casasForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                
                const casa = {
                    id: Date.now(),
                    nome_casa: formData.get('nome_casa'),
                    cep: formData.get('cep'),
                    logradouro: formData.get('logradouro'),
                    numero: formData.get('numero'),
                    complemento: formData.get('complemento'),
                    bairro: formData.get('bairro'),
                    cidade: formData.get('cidade'),
                    estado: formData.get('estado'),
                    telefone: formData.get('telefone')
                };
                
                salvarCasa(casa);
            });

            document.getElementById('clientesForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                
                const cliente = {
                    id: Date.now(),
                    nome_cliente: formData.get('nome_cliente'),
                    cpf_cliente: formData.get('cpf_cliente'),
                    nome_empresa_cliente: formData.get('nome_empresa_cliente'),
                    tipo_documento: tipoDocumento,
                    data_nascimento_cliente: formData.get('data_nascimento_cliente'),
                    email_cliente: formData.get('email_cliente'),
                    telefone_cliente: formData.get('telefone_cliente'),
                    cep_cliente: formData.get('cep_cliente'),
                    logradouro_cliente: formData.get('logradouro_cliente'),
                    numero_cliente: formData.get('numero_cliente'),
                    complemento_cliente: formData.get('complemento_cliente'),
                    bairro_cliente: formData.get('bairro_cliente'),
                    cidade_cliente: formData.get('cidade_cliente'),
                    estado_cliente: formData.get('estado_cliente'),
                    nome_aniversariante: formData.get('nome_aniversariante'),
                    data_nascimento_aniversariante: formData.get('data_nascimento_aniversariante')
                };
                
                salvarCliente(cliente);
            });

            // CEP lookup para casas
            document.getElementById('cep_casa').addEventListener('blur', function() {
                const cep = this.value.replace(/\D/g, '');
                if (cep.length === 8) {
                    fetch(`https://viacep.com.br/ws/${cep}/json/`)
                        .then(response => response.json())
                        .then(data => {
                            if (!data.erro) {
                                document.getElementById('logradouro_casa').value = data.logradouro;
                                document.getElementById('bairro_casa').value = data.bairro;
                                document.getElementById('cidade_casa').value = data.localidade;
                                document.getElementById('estado_casa').value = data.uf;
                            }
                        })
                        .catch(error => console.log('Erro ao buscar CEP:', error));
                }
            });

            // CEP lookup para clientes
            document.getElementById('cep_cliente').addEventListener('blur', function() {
                const cep = this.value.replace(/\D/g, '');
                if (cep.length === 8) {
                    fetch(`https://viacep.com.br/ws/${cep}/json/`)
                        .then(response => response.json())
                        .then(data => {
                            if (!data.erro) {
                                document.getElementById('logradouro_cliente').value = data.logradouro;
                                document.getElementById('bairro_cliente').value = data.bairro;
                                document.getElementById('cidade_cliente').value = data.localidade;
                                document.getElementById('estado_cliente').value = data.uf;
                            }
                        })
                        .catch(error => console.log('Erro ao buscar CEP:', error));
                }
            });

            // M√°scaras para formul√°rio de usu√°rios
            document.getElementById('cpf_usuario').addEventListener('input', function() {
                this.value = this.value.replace(/\D/g, '').replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            });

            document.getElementById('telefone_usuario').addEventListener('input', function() {
                this.value = this.value.replace(/\D/g, '').replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            });

            document.getElementById('eventoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                
                const evento = {
                    id: Date.now(),
                    cpf_cliente: formData.get('cpf_cliente'),
                    nome_empresa_evento: formData.get('nome_empresa_evento'),
                    tipo_documento_evento: tipoDocumentoEvento,
                    casa_festa: outroLocalAtivo ? null : formData.get('casa_festa'),
                    outro_local: outroLocalAtivo,
                    cep_evento: formData.get('cep_evento'),
                    endereco_evento: formData.get('endereco_evento'),
                    numero_evento: formData.get('numero_evento'),
                    complemento_evento: formData.get('complemento_evento'),
                    bairro_evento: formData.get('bairro_evento'),
                    cidade_evento: formData.get('cidade_evento'),
                    estado_evento: formData.get('estado_evento'),
                    telefone_evento: formData.get('telefone_evento'),
                    data_evento: formData.get('data_evento'),
                    hora_entrada: formData.get('hora_entrada'),
                    hora_saida: formData.get('hora_saida'),
                    duracao: formData.get('duracao'),
                    personagens: personagensSelecionadosEvento,
                    valor_total: removerFormatacaoMoeda(formData.get('valor_total')),
                    valor_sinal: removerFormatacaoMoeda(formData.get('valor_sinal')) || '0',
                    forma_pagamento_sinal: formData.get('forma_pagamento_sinal'),
                    sinal_pago: formData.get('sinal_pago_status') === 'true',
                    data_pagamento_sinal: formData.get('sinal_pago_status') === 'true' ? document.getElementById('dataPagamentoSinal').value : null,
                    valor_avulso: removerFormatacaoMoeda(formData.get('valor_avulso')) || '0',
                    forma_pagamento_avulso: formData.get('forma_pagamento_avulso'),
                    valor_avulso_pago: formData.get('valor_avulso_pago') === 'true',
                    data_pagamento_avulso: formData.get('valor_avulso_pago') === 'true' ? document.getElementById('dataPagamentoAvulso').value : null,
                    desconto: removerFormatacaoMoeda(formData.get('desconto')) || '0',
                    deslocamento: removerFormatacaoMoeda(formData.get('deslocamento')) || '0',
                    valor_falta_receber: removerFormatacaoMoeda(formData.get('valor_falta_receber')),
                    forma_pagamento_restante: formData.get('forma_pagamento_restante'),
                    pagamento_total_pago: formData.get('pagamento_total_pago') === 'true',
                    data_pagamento_restante: formData.get('pagamento_total_pago') === 'true' ? document.getElementById('dataPagamentoRestante').value : null,
                    observacoes: formData.get('observacoes'),
                    valor_restante_pago: false,
                    confirmado: false,
                    contrato_aceito: false,
                    status_contrato: 'pendente',
                    data_criacao: new Date().toISOString()
                };
                
                eventos.push(evento);
                localStorage.setItem('eventos', JSON.stringify(eventos));
                
                document.getElementById('eventoSuccess').style.display = 'block';
                document.getElementById('eventoSuccess').textContent = '‚úÖ Evento reservado com sucesso!';
                
                document.getElementById('eventoForm').reset();
                personagensSelecionadosEvento = [];
                document.getElementById('personagensSelecionados').innerHTML = '';
                
                atualizarContadores();
                loadEventWeather();
                
                setTimeout(() => {
                    document.getElementById('eventoSuccess').style.display = 'none';
                }, 3000);
            });

            // Buscar cliente por CPF/CNPJ
            document.getElementById('cpf_evento').addEventListener('blur', function() {
                const documento = this.value.replace(/\D/g, '');
                const tamanhoEsperado = tipoDocumentoEvento === 'cpf' ? 11 : 14;
                
                if (documento.length === tamanhoEsperado) {
                    const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === documento);
                    if (cliente) {
                        mostrarDadosCliente(cliente);
                    } else {
                        document.getElementById('dadosClienteEvento').style.display = 'none';
                        alert('Cliente n√£o encontrado! Cadastre o cliente primeiro.');
                    }
                }
            });

            // CEP lookup para eventos
            document.getElementById('cep_evento').addEventListener('blur', function() {
                const cep = this.value.replace(/\D/g, '');
                if (cep.length === 8) {
                    fetch(`https://viacep.com.br/ws/${cep}/json/`)
                        .then(response => response.json())
                        .then(data => {
                            if (!data.erro) {
                                document.getElementById('endereco_evento').value = data.logradouro;
                                document.getElementById('bairro_evento').value = data.bairro;
                                document.getElementById('cidade_evento').value = data.localidade;
                                document.getElementById('estado_evento').value = data.uf;
                            }
                        })
                        .catch(error => console.log('Erro ao buscar CEP:', error));
                }
            });

            // Listeners para c√°lculo autom√°tico
            document.getElementById('desconto').addEventListener('input', calcularValorTotalEvento);
            document.getElementById('deslocamento').addEventListener('input', calcularValorTotalEvento);
            document.getElementById('valor_sinal').addEventListener('input', calcularValorTotalEvento);
            document.getElementById('valor_avulso').addEventListener('input', calcularValorTotalEvento);
            document.getElementById('pagamento_total_pago').addEventListener('change', calcularValorTotalEvento);
            
            // M√°scaras para valores monet√°rios
            document.getElementById('valor_sinal').addEventListener('input', function() {
                this.value = formatarMoeda(this.value);
            });
            document.getElementById('valor_avulso').addEventListener('input', function() {
                this.value = formatarMoeda(this.value);
            });
            document.getElementById('desconto').addEventListener('input', function() {
                this.value = formatarMoeda(this.value);
            });
            document.getElementById('deslocamento').addEventListener('input', function() {
                this.value = formatarMoeda(this.value);
            });
            
            // M√°scara para cach√™ do elenco e personagens
            document.getElementById('cache_elenco').addEventListener('input', function() {
                this.value = formatarMoeda(this.value);
            });
            
            if (document.getElementById('cache_personagem')) {
                document.getElementById('cache_personagem').addEventListener('input', function() {
                    this.value = formatarMoeda(this.value);
                });
            }
            
            if (document.getElementById('edit_cache_personagem')) {
                document.getElementById('edit_cache_personagem').addEventListener('input', function() {
                    this.value = formatarMoeda(this.value);
                });
            }
            
            // Listeners para c√°lculo de hora de sa√≠da
            document.getElementById('hora_entrada').addEventListener('change', calcularHoraSaida);
            document.getElementById('duracao').addEventListener('input', calcularHoraSaida);

            document.getElementById('manutencaoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                
                const manutencao = {
                    id: Date.now(),
                    data_registro: formData.get('data_registro'),
                    personagem_id: formData.get('personagem_manutencao'),
                    itens: [...itensManutencaoSelecionados],
                    status: 'pendente',
                    data_criacao: new Date().toISOString(),
                    data_finalizacao: null,
                    informacoes_realizadas: ''
                };
                
                salvarManutencao(manutencao);
            });

            document.getElementById('realizarManutencaoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const manutencaoId = parseInt(formData.get('manutencao_id'));
                const status = formData.get('status');
                const informacoes = formData.get('informacoes_realizadas');
                
                atualizarManutencao(manutencaoId, status, informacoes);
            });

            document.getElementById('editarPersonagemForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const id = parseInt(document.getElementById('edit_personagem_id').value);
                const personagem = personagens.find(p => p.id === id);
                
                if (personagem) {
                    personagem.personagem = document.getElementById('edit_personagem').value;
                    personagem.figurino = document.getElementById('edit_figurino').value;
                    personagem.tema = document.getElementById('edit_tema').value;
                    personagem.quantidade = document.getElementById('edit_quantidade').value;
                    personagem.valor = document.getElementById('edit_valor').value.replace(/[R$\s\.]/g, '').replace(',', '.');
                    personagem.cache_individual = removerFormatacaoMoeda(document.getElementById('edit_cache_personagem').value) || '0';
                    
                    localStorage.setItem('personagens', JSON.stringify(personagens));
                    alert('‚úÖ Personagem atualizado com sucesso!');
                    showPage('lista_personagens');
                }
            });

            document.getElementById('editarEventoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const id = parseInt(document.getElementById('edit_evento_id').value);
                const evento = eventos.find(e => e.id === id);
                
                if (evento) {
                    evento.cpf_cliente = document.getElementById('edit_cpf_evento').value;
                    evento.nome_empresa_evento = document.getElementById('edit_nome_empresa_evento').value;
                    evento.tipo_documento_evento = tipoDocumentoEventoEdicao;
                    evento.data_evento = document.getElementById('edit_data_evento').value;
                    evento.hora_entrada = document.getElementById('edit_hora_entrada').value;
                    evento.duracao = document.getElementById('edit_duracao').value;
                    evento.valor_sinal = removerFormatacaoMoeda(document.getElementById('edit_valor_sinal').value) || '0';
                    evento.sinal_pago = document.getElementById('edit_sinal_pago_status').value === 'true';
                    evento.desconto = removerFormatacaoMoeda(document.getElementById('edit_desconto').value) || '0';
                    evento.deslocamento = removerFormatacaoMoeda(document.getElementById('edit_deslocamento').value) || '0';
                    evento.pagamento_total_pago = document.getElementById('edit_pagamento_total_pago').value === 'true';
                    evento.observacoes = document.getElementById('edit_observacoes').value;
                    evento.personagens = [...personagensEdicaoSelecionados];
                    
                    // Recalcular valor total
                    let valorTotal = 0;
                    personagensEdicaoSelecionados.forEach(p => {
                        valorTotal += parseFloat(p.valor || 0) * parseInt(p.quantidade_evento || 1);
                    });
                    valorTotal = valorTotal - parseFloat(evento.desconto || 0) + parseFloat(evento.deslocamento || 0);
                    evento.valor_total = valorTotal.toString();
                    evento.valor_falta_receber = (valorTotal - parseFloat(evento.valor_sinal || 0)).toString();
                    
                    localStorage.setItem('eventos', JSON.stringify(eventos));
                    alert('‚úÖ Evento atualizado com sucesso!');
                    showPage('todos_eventos');
                }
            });

            // Listeners para rec√°lculo autom√°tico na edi√ß√£o
            document.addEventListener('input', function(e) {
                if (e.target.id === 'edit_desconto' || e.target.id === 'edit_deslocamento') {
                    calcularValorTotalEdicao();
                }
            });

            document.getElementById('editarCasaForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const id = parseInt(document.getElementById('edit_casa_id').value);
                const casa = casas.find(c => c.id === id);
                
                if (casa) {
                    casa.nome_casa = document.getElementById('edit_nome_casa').value;
                    casa.cep = document.getElementById('edit_cep_casa').value;
                    casa.logradouro = document.getElementById('edit_logradouro_casa').value;
                    casa.numero = document.getElementById('edit_numero_casa').value;
                    casa.complemento = document.getElementById('edit_complemento_casa').value;
                    casa.bairro = document.getElementById('edit_bairro_casa').value;
                    casa.cidade = document.getElementById('edit_cidade_casa').value;
                    casa.estado = document.getElementById('edit_estado_casa').value;
                    casa.telefone = document.getElementById('edit_telefone_casa').value;
                    
                    localStorage.setItem('casas', JSON.stringify(casas));
                    alert('‚úÖ Casa de festas atualizada com sucesso!');
                    showPage('lista_casas');
                }
            });

            document.getElementById('editarClienteForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const id = parseInt(document.getElementById('edit_cliente_id').value);
                const cliente = clientes.find(c => c.id === id);
                
                if (cliente) {
                    cliente.nome_cliente = document.getElementById('edit_nome_cliente').value;
                    cliente.cpf_cliente = document.getElementById('edit_cpf_cliente').value;
                    cliente.nome_empresa_cliente = document.getElementById('edit_nome_empresa_cliente').value;
                    cliente.tipo_documento = tipoDocumentoEdicao;
                    cliente.data_nascimento_cliente = document.getElementById('edit_data_nascimento_cliente').value;
                    cliente.email_cliente = document.getElementById('edit_email_cliente').value;
                    cliente.telefone_cliente = document.getElementById('edit_telefone_cliente').value;
                    cliente.cep_cliente = document.getElementById('edit_cep_cliente').value;
                    cliente.logradouro_cliente = document.getElementById('edit_logradouro_cliente').value;
                    cliente.numero_cliente = document.getElementById('edit_numero_cliente').value;
                    cliente.complemento_cliente = document.getElementById('edit_complemento_cliente').value;
                    cliente.bairro_cliente = document.getElementById('edit_bairro_cliente').value;
                    cliente.cidade_cliente = document.getElementById('edit_cidade_cliente').value;
                    cliente.estado_cliente = document.getElementById('edit_estado_cliente').value;
                    cliente.nome_aniversariante = document.getElementById('edit_nome_aniversariante').value;
                    cliente.data_nascimento_aniversariante = document.getElementById('edit_data_nascimento_aniversariante').value;
                    
                    localStorage.setItem('clientes', JSON.stringify(clientes));
                    alert('‚úÖ Cliente atualizado com sucesso!');
                    showPage('lista_clientes');
                }
            });

            document.getElementById('informacoesPagamentoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const tipo = document.getElementById('pagamento_tipo').value;
                const id = document.getElementById('pagamento_id').value;
                const status = document.getElementById('status_pagamento').value;
                
                salvarStatusPagamento(tipo, id, status);
            });

            document.getElementById('escalarEventoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const eventoId = parseInt(document.getElementById('escala_evento_id').value);
                salvarEscalacao(eventoId);
            });

            // Adicionar listeners para formul√°rios de usu√°rios
            document.getElementById('usuarioForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                
                const usuario = {
                    id: Date.now(),
                    nome: formData.get('nome_usuario'),
                    cpf: formData.get('cpf_usuario'),
                    telefone: formData.get('telefone_usuario'),
                    login: formData.get('login_usuario'),
                    senha: formData.get('senha_usuario'),
                    ativo: true,
                    permissoes: []
                };
                
                // Verificar se login j√° existe
                if (usuarios.find(u => u.login === usuario.login)) {
                    alert('‚ùå Login j√° existe! Escolha outro.');
                    return;
                }
                
                usuarios.push(usuario);
                localStorage.setItem('usuarios', JSON.stringify(usuarios));
                
                document.getElementById('usuarioSuccess').style.display = 'block';
                document.getElementById('usuarioSuccess').textContent = '‚úÖ Usu√°rio cadastrado com sucesso!';
                document.getElementById('usuarioForm').reset();
                carregarUsuarios();
            });

            document.getElementById('permissoesForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const usuarioId = parseInt(document.getElementById('usuario_id_permissoes').value);
                const permissoes = [];
                document.querySelectorAll('input[name="permissao"]:checked').forEach(cb => {
                    permissoes.push(cb.value);
                });
                
                const usuario = usuarios.find(u => u.id === usuarioId);
                if (usuario) {
                    usuario.permissoes = permissoes;
                    localStorage.setItem('usuarios', JSON.stringify(usuarios));
                    alert('‚úÖ Permiss√µes salvas com sucesso!');
                    showPage('cadastro_usuarios');
                }
            });

            // Inicializar widgets
            // Debug inicial
        console.log('Sistema BBB FESTA iniciado');
        console.log('Total de eventos carregados:', eventos.length);
        console.log('Total de clientes carregados:', clientes.length);
        console.log('Total de casas carregadas:', casas.length);
        
        initializeWidgets();
            
            // Verificar login
            const isLoggedIn = localStorage.getItem('bbb_logged_in');
            if (isLoggedIn === 'true') {
                const userPermissions = JSON.parse(localStorage.getItem('bbb_user_permissions') || '[]');
                document.getElementById('loginScreen').classList.remove('active');
                document.getElementById('mainScreen').classList.add('active');
                
                // Aplicar permiss√µes ap√≥s o DOM estar pronto
                setTimeout(() => {
                    aplicarPermissoes(userPermissions);
                    const currentPage = localStorage.getItem('bbb_current_page') || 'dashboard';
                    showPage(currentPage);
                }, 50);
            }
        });

        function carregarUsuarios() {
            const lista = document.getElementById('listaUsuarios');
            if (usuarios.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum usu√°rio cadastrado</p>';
                return;
            }
            
            lista.innerHTML = '';
            usuarios.forEach(u => {
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid #e9ecef;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <h4 style="color: #8B4513; margin-bottom: 0.5rem;">üë• ${u.nome}</h4>
                            <p><strong>Login:</strong> ${u.login}</p>
                            <p><strong>CPF:</strong> ${u.cpf}</p>
                            <p><strong>Telefone:</strong> ${u.telefone || 'N√£o informado'}</p>
                            <p><strong>Status:</strong> <span style="color: ${u.ativo ? '#28a745' : '#dc3545'}; font-weight: bold;">${u.ativo ? '‚úÖ Ativo' : '‚ùå Inativo'}</span></p>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <button onclick="alternarStatusUsuario(${u.id})" style="background: ${u.ativo ? '#dc3545' : '#28a745'}; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">
                                ${u.ativo ? '‚ùå Desabilitar' : '‚úÖ Habilitar'}
                            </button>
                            <button onclick="gerenciarPermissoes(${u.id})" style="background: #007bff; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">
                                üîê Permiss√µes
                            </button>
                        </div>
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function alternarStatusUsuario(id) {
            const usuario = usuarios.find(u => u.id === id);
            if (usuario) {
                usuario.ativo = !usuario.ativo;
                localStorage.setItem('usuarios', JSON.stringify(usuarios));
                carregarUsuarios();
            }
        }

        function gerenciarPermissoes(id) {
            const usuario = usuarios.find(u => u.id === id);
            if (usuario) {
                document.getElementById('usuario_id_permissoes').value = id;
                document.getElementById('dadosUsuarioPermissoes').innerHTML = `
                    <h4 style="color: #333; margin-bottom: 0.5rem;">üë• ${usuario.nome}</h4>
                    <p><strong>Login:</strong> ${usuario.login}</p>
                    <p><strong>Status:</strong> <span style="color: ${usuario.ativo ? '#28a745' : '#dc3545'}; font-weight: bold;">${usuario.ativo ? '‚úÖ Ativo' : '‚ùå Inativo'}</span></p>
                `;
                
                // Limpar checkboxes
                document.querySelectorAll('input[name="permissao"]').forEach(cb => cb.checked = false);
                
                // Marcar permiss√µes do usu√°rio
                if (usuario.permissoes) {
                    usuario.permissoes.forEach(permissao => {
                        const checkbox = document.querySelector(`input[name="permissao"][value="${permissao}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
                
                showPage('gerenciar_permissoes');
            }
        }

        function aplicarPermissoes(permissoes) {
            const mapeamentoBotoes = {
                'dashboard': 'Dashboard',
                'eventos': 'Eventos', 
                'personagens': 'Personagens',
                'elenco': 'Elenco',
                'motoristas': 'Motoristas',
                'casas_festas': 'Casa de Festas',
                'clientes': 'Clientes',
                'manutencao': 'Manuten√ß√£o',
                'financeiro': 'Financeiro',
                'configuracoes': 'Configura√ß√µes'
            };
            
            const botoes = document.querySelectorAll('.nav-btn:not(.btn-danger)');
            
            botoes.forEach(botao => {
                const texto = botao.textContent.trim();
                let paginaEncontrada = null;
                
                // Encontrar a p√°gina baseada no texto do bot√£o
                Object.keys(mapeamentoBotoes).forEach(pagina => {
                    if (texto.includes(mapeamentoBotoes[pagina])) {
                        paginaEncontrada = pagina;
                    }
                });
                
                if (paginaEncontrada) {
                    if (permissoes.includes(paginaEncontrada)) {
                        botao.style.display = 'inline-block';
                    } else {
                        botao.style.display = 'none';
                    }
                }
            });
        }

        function salvarPersonagem(personagem) {
            personagens.push(personagem);
            localStorage.setItem('personagens', JSON.stringify(personagens));
            
            document.getElementById('personagensSuccess').style.display = 'block';
            document.getElementById('personagensSuccess').textContent = '‚úÖ Personagem cadastrado com sucesso!';
            document.getElementById('personagensForm').reset();
        }

        function carregarPersonagens() {
            const lista = document.getElementById('listaPersonagens');
            if (personagens.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum personagem cadastrado</p>';
                return;
            }
            
            lista.innerHTML = '';
            personagens.forEach(p => {
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid #e9ecef; display: flex; gap: 1rem; align-items: center;';
                card.innerHTML = `
                    <div style="flex-shrink: 0;">
                        ${p.foto ? 
                            `<img src="${p.foto}" alt="${p.personagem}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 10px;">` : 
                            `<div style="width: 80px; height: 80px; background: #DAA520; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 2rem;">ü¶Å</div>`
                        }
                    </div>
                    <div style="flex: 1;">
                        <h4 style="color: #8B4513; margin-bottom: 0.5rem;">ü¶Å ${p.personagem}</h4>
                        <p><strong>Figurino:</strong> ${p.figurino || 'N√£o informado'}</p>
                        <p><strong>Tema:</strong> ${p.tema || 'N√£o informado'}</p>
                        <p><strong>Quantidade:</strong> ${p.quantidade}</p>
                        <p><strong>Valor:</strong> R$ ${parseFloat(p.valor).toFixed(2).replace('.', ',')}</p>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="editarPersonagem(${p.id})" style="background: #007bff; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">‚úèÔ∏è Editar</button>
                        <button onclick="excluirPersonagem(${p.id})" style="background: #dc3545; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">üóëÔ∏è Excluir</button>
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function excluirPersonagem(id) {
            if (confirm('Tem certeza que deseja excluir este personagem?')) {
                personagens = personagens.filter(p => p.id !== id);
                localStorage.setItem('personagens', JSON.stringify(personagens));
                carregarPersonagens();
            }
        }

        function editarPersonagem(id) {
            const personagem = personagens.find(p => p.id === id);
            if (personagem) {
                document.getElementById('edit_personagem_id').value = id;
                document.getElementById('edit_personagem').value = personagem.personagem;
                document.getElementById('edit_figurino').value = personagem.figurino || '';
                document.getElementById('edit_tema').value = personagem.tema || '';
                document.getElementById('edit_quantidade').value = personagem.quantidade;
                document.getElementById('edit_valor').value = `R$ ${parseFloat(personagem.valor).toFixed(2).replace('.', ',')}`;
                showPage('editar_personagem');
            }
        }

        function calcularIdade(dataNascimento) {
            const hoje = new Date();
            const nascimento = new Date(dataNascimento);
            let idade = hoje.getFullYear() - nascimento.getFullYear();
            const mes = hoje.getMonth() - nascimento.getMonth();
            if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
                idade--;
            }
            return idade;
        }

        function salvarElenco(membro) {
            elenco.push(membro);
            localStorage.setItem('elenco', JSON.stringify(elenco));
            
            document.getElementById('elencoSuccess').style.display = 'block';
            document.getElementById('elencoSuccess').textContent = '‚úÖ Membro do elenco cadastrado com sucesso!';
            document.getElementById('elencoForm').reset();
        }

        function carregarElenco() {
            const lista = document.getElementById('listaElenco');
            if (elenco.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum membro do elenco cadastrado</p>';
                return;
            }
            
            lista.innerHTML = '';
            elenco.forEach(e => {
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid #e9ecef; display: flex; gap: 1rem; align-items: center;';
                card.innerHTML = `
                    <div style="flex-shrink: 0;">
                        ${e.foto ? 
                            `<img src="${e.foto}" alt="${e.nome_completo}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 10px;">` : 
                            `<div style="width: 80px; height: 80px; background: #228B22; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 2rem;">üé≠</div>`
                        }
                    </div>
                    <div style="flex: 1;">
                        <h4 style="color: #8B4513; margin-bottom: 0.5rem;">üé≠ ${e.nome_completo}</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                            <div>
                                <p><strong>CPF:</strong> ${e.cpf}</p>
                                <p><strong>Idade:</strong> ${e.data_nascimento ? calcularIdade(e.data_nascimento) + ' anos' : 'N√£o informado'}</p>
                                <p><strong>WhatsApp:</strong> ${e.whatsapp || 'N√£o informado'}</p>
                            </div>
                            <div>
                                <p><strong>Altura:</strong> ${e.altura ? e.altura + ' cm' : 'N√£o informado'}</p>
                                <p><strong>Cal√ßado:</strong> ${e.calcado || 'N√£o informado'}</p>
                                <p><strong>PIX:</strong> ${e.chave_pix || 'N√£o informado'}</p>
                            </div>
                        </div>
                        <p><strong>Perfil:</strong> ${e.perfil || 'N√£o informado'}</p>
                        <p><strong>Cach√™:</strong> R$ ${parseFloat(e.cache || 0).toFixed(2).replace('.', ',')}</p>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="editarElenco(${e.id})" style="background: #007bff; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">‚úèÔ∏è Editar</button>
                        <button onclick="excluirElenco(${e.id})" style="background: #dc3545; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">üóëÔ∏è Excluir</button>
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function excluirElenco(id) {
            if (confirm('Tem certeza que deseja excluir este membro do elenco?')) {
                elenco = elenco.filter(e => e.id !== id);
                localStorage.setItem('elenco', JSON.stringify(elenco));
                carregarElenco();
            }
        }

        function editarElenco(id) {
            const membro = elenco.find(e => e.id === id);
            if (membro) {
                alert(`Editar ${membro.nome_completo} - Fun√ß√£o em desenvolvimento`);
            }
        }

        function salvarMotorista(motorista) {
            motoristas.push(motorista);
            localStorage.setItem('motoristas', JSON.stringify(motoristas));
            
            document.getElementById('motoristasSuccess').style.display = 'block';
            document.getElementById('motoristasSuccess').textContent = '‚úÖ Motorista cadastrado com sucesso!';
            document.getElementById('motoristasForm').reset();
        }

        function carregarMotoristas() {
            const lista = document.getElementById('listaMotoristas');
            if (motoristas.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum motorista cadastrado</p>';
                return;
            }
            
            lista.innerHTML = '';
            motoristas.forEach(m => {
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid #e9ecef; display: flex; gap: 1rem; align-items: center;';
                card.innerHTML = `
                    <div style="flex-shrink: 0;">
                        ${m.foto ? 
                            `<img src="${m.foto}" alt="${m.nome_completo}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 10px;">` : 
                            `<div style="width: 80px; height: 80px; background: #8B4513; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 2rem;">üöó</div>`
                        }
                    </div>
                    <div style="flex: 1;">
                        <h4 style="color: #8B4513; margin-bottom: 0.5rem;">üöó ${m.nome_completo}</h4>
                        <p><strong>CPF:</strong> ${m.cpf}</p>
                        <p><strong>WhatsApp:</strong> ${m.whatsapp || 'N√£o informado'}</p>
                        <p><strong>Modelo do Carro:</strong> ${m.modelo_carro}</p>
                        <p><strong>Perfil:</strong> ${m.perfil || 'DRIVE'}</p>
                        <p><strong>PIX:</strong> ${m.chave_pix || 'N√£o informado'}</p>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="editarMotorista(${m.id})" style="background: #007bff; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">‚úèÔ∏è Editar</button>
                        <button onclick="excluirMotorista(${m.id})" style="background: #dc3545; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">üóëÔ∏è Excluir</button>
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function excluirMotorista(id) {
            if (confirm('Tem certeza que deseja excluir este motorista?')) {
                motoristas = motoristas.filter(m => m.id !== id);
                localStorage.setItem('motoristas', JSON.stringify(motoristas));
                carregarMotoristas();
            }
        }

        function editarMotorista(id) {
            const motorista = motoristas.find(m => m.id === id);
            if (motorista) {
                alert(`Editar ${motorista.nome_completo} - Fun√ß√£o em desenvolvimento`);
            }
        }

        function salvarCasa(casa) {
            casas.push(casa);
            localStorage.setItem('casas', JSON.stringify(casas));
            
            document.getElementById('casasSuccess').style.display = 'block';
            document.getElementById('casasSuccess').textContent = '‚úÖ Casa de festas cadastrada com sucesso!';
            document.getElementById('casasForm').reset();
        }

        function carregarCasas() {
            const lista = document.getElementById('listaCasas');
            if (casas.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhuma casa de festas cadastrada</p>';
                return;
            }
            
            lista.innerHTML = '';
            casas.forEach(c => {
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid #e9ecef;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h4 style="color: #8B4513; margin-bottom: 0.5rem;">üè† ${c.nome_casa}</h4>
                            <p><strong>Endere√ßo:</strong> ${c.logradouro}, ${c.numero}${c.complemento ? ', ' + c.complemento : ''}</p>
                            <p><strong>Bairro:</strong> ${c.bairro} - ${c.cidade}/${c.estado}</p>
                            <p><strong>CEP:</strong> ${c.cep}</p>
                            <p><strong>Telefone:</strong> ${c.telefone || 'N√£o informado'}</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="editarCasa(${c.id})" style="background: #007bff; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">‚úèÔ∏è Editar</button>
                            <button onclick="excluirCasa(${c.id})" style="background: #dc3545; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">üóëÔ∏è Excluir</button>
                        </div>
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function excluirCasa(id) {
            if (confirm('Tem certeza que deseja excluir esta casa de festas?')) {
                casas = casas.filter(c => c.id !== id);
                localStorage.setItem('casas', JSON.stringify(casas));
                carregarCasas();
            }
        }

        function editarCasa(id) {
            const casa = casas.find(c => c.id === id);
            if (casa) {
                document.getElementById('edit_casa_id').value = id;
                document.getElementById('edit_nome_casa').value = casa.nome_casa || '';
                document.getElementById('edit_cep_casa').value = casa.cep || '';
                document.getElementById('edit_logradouro_casa').value = casa.logradouro || '';
                document.getElementById('edit_numero_casa').value = casa.numero || '';
                document.getElementById('edit_complemento_casa').value = casa.complemento || '';
                document.getElementById('edit_bairro_casa').value = casa.bairro || '';
                document.getElementById('edit_cidade_casa').value = casa.cidade || '';
                document.getElementById('edit_estado_casa').value = casa.estado || '';
                document.getElementById('edit_telefone_casa').value = casa.telefone || '';
                showPage('editar_casa');
            }
        }

        function salvarCliente(cliente) {
            clientes.push(cliente);
            localStorage.setItem('clientes', JSON.stringify(clientes));
            
            document.getElementById('clientesSuccess').style.display = 'block';
            document.getElementById('clientesSuccess').textContent = '‚úÖ Cliente cadastrado com sucesso!';
            document.getElementById('clientesForm').reset();
        }

        function carregarClientes() {
            const lista = document.getElementById('listaClientes');
            if (clientes.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum cliente cadastrado</p>';
                return;
            }
            
            lista.innerHTML = '';
            clientes.forEach(c => {
                const idadeCliente = calcularIdade(c.data_nascimento_cliente);
                const idadeAniversariante = calcularIdade(c.data_nascimento_aniversariante);
                
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid #e9ecef;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h4 style="color: #8B4513; margin-bottom: 0.5rem;">üë• ${c.nome_cliente}</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                                <div>
                                    <h5 style="color: #666; margin-bottom: 0.5rem;">Dados do Cliente:</h5>
                                    <p><strong>${c.tipo_documento === 'cnpj' ? 'CNPJ' : 'CPF'}:</strong> ${c.cpf_cliente}</p>
                                    ${c.nome_empresa_cliente ? `<p><strong>Empresa:</strong> ${c.nome_empresa_cliente}</p>` : ''}
                                    <p><strong>${c.tipo_documento === 'cnpj' ? 'Data Abertura' : 'Idade'}:</strong> ${c.tipo_documento === 'cnpj' ? new Date(c.data_nascimento_cliente).toLocaleDateString('pt-BR') : idadeCliente + ' anos'}</p>
                                    <p><strong>Email:</strong> ${c.email_cliente || 'N√£o informado'}</p>
                                    <p><strong>Telefone:</strong> ${c.telefone_cliente || 'N√£o informado'}</p>
                                </div>
                                <div>
                                    <h5 style="color: #666; margin-bottom: 0.5rem;">Aniversariante:</h5>
                                    <p><strong>Nome:</strong> ${c.nome_aniversariante}</p>
                                    <p><strong>Idade:</strong> ${idadeAniversariante} anos</p>
                                </div>
                            </div>
                            <p><strong>Endere√ßo:</strong> ${c.logradouro_cliente}, ${c.numero_cliente}${c.complemento_cliente ? ', ' + c.complemento_cliente : ''}</p>
                            <p><strong>Bairro:</strong> ${c.bairro_cliente} - ${c.cidade_cliente}/${c.estado_cliente} - CEP: ${c.cep_cliente}</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="editarCliente(${c.id})" style="background: #007bff; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">‚úèÔ∏è Editar</button>
                            <button onclick="excluirCliente(${c.id})" style="background: #dc3545; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">üóëÔ∏è Excluir</button>
                        </div>
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function excluirCliente(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                clientes = clientes.filter(c => c.id !== id);
                localStorage.setItem('clientes', JSON.stringify(clientes));
                carregarClientes();
            }
        }

        function editarCliente(id) {
            const cliente = clientes.find(c => c.id === id);
            if (cliente) {
                document.getElementById('edit_cliente_id').value = id;
                document.getElementById('edit_nome_cliente').value = cliente.nome_cliente || '';
                document.getElementById('edit_cpf_cliente').value = cliente.cpf_cliente || '';
                document.getElementById('edit_data_nascimento_cliente').value = cliente.data_nascimento_cliente || '';
                document.getElementById('edit_email_cliente').value = cliente.email_cliente || '';
                document.getElementById('edit_telefone_cliente').value = cliente.telefone_cliente || '';
                document.getElementById('edit_cep_cliente').value = cliente.cep_cliente || '';
                document.getElementById('edit_logradouro_cliente').value = cliente.logradouro_cliente || '';
                document.getElementById('edit_numero_cliente').value = cliente.numero_cliente || '';
                document.getElementById('edit_complemento_cliente').value = cliente.complemento_cliente || '';
                document.getElementById('edit_bairro_cliente').value = cliente.bairro_cliente || '';
                document.getElementById('edit_cidade_cliente').value = cliente.cidade_cliente || '';
                document.getElementById('edit_estado_cliente').value = cliente.estado_cliente || '';
                document.getElementById('edit_nome_aniversariante').value = cliente.nome_aniversariante || '';
                document.getElementById('edit_data_nascimento_aniversariante').value = cliente.data_nascimento_aniversariante || '';
                showPage('editar_cliente');
            }
        }

        // Vari√°veis globais para eventos
        let personagensSelecionadosEvento = [];
        let outroLocalAtivo = false;

        function mostrarDadosCliente(cliente) {
            document.getElementById('dadosClienteEvento').style.display = 'block';
            
            document.getElementById('cliente_nome').innerHTML = `<strong>Nome:</strong> ${cliente.nome_cliente}`;
            
            // Mostrar CPF ou CNPJ baseado no tipo de documento
            const tipoDoc = cliente.tipo_documento === 'cnpj' ? 'CNPJ' : 'CPF';
            document.getElementById('cliente_cpf').innerHTML = `<strong>${tipoDoc}:</strong> ${cliente.cpf_cliente}`;
            
            // Mostrar idade ou data de abertura baseado no tipo de documento
            if (cliente.tipo_documento === 'cnpj') {
                document.getElementById('cliente_idade').innerHTML = `<strong>Data Abertura:</strong> ${new Date(cliente.data_nascimento_cliente).toLocaleDateString('pt-BR')}`;
                // Mostrar nome da empresa se for CNPJ
                if (cliente.nome_empresa_cliente) {
                    document.getElementById('cliente_nome').innerHTML += `<br><strong>Empresa:</strong> ${cliente.nome_empresa_cliente}`;
                }
            } else {
                document.getElementById('cliente_idade').innerHTML = `<strong>Idade:</strong> ${calcularIdade(cliente.data_nascimento_cliente)} anos`;
            }
            
            document.getElementById('cliente_telefone').innerHTML = `<strong>Telefone:</strong> ${cliente.telefone_cliente || 'N√£o informado'}`;
            document.getElementById('cliente_email').innerHTML = `<strong>Email:</strong> ${cliente.email_cliente || 'N√£o informado'}`;
            
            document.getElementById('aniversariante_nome').innerHTML = `<strong>Nome:</strong> ${cliente.nome_aniversariante}`;
            document.getElementById('aniversariante_idade').innerHTML = `<strong>Idade:</strong> ${calcularIdade(cliente.data_nascimento_aniversariante)} anos`;
            
            document.getElementById('cliente_endereco').innerHTML = `<strong>Endere√ßo:</strong> ${cliente.logradouro_cliente}, ${cliente.numero_cliente}${cliente.complemento_cliente ? ', ' + cliente.complemento_cliente : ''}`;
            document.getElementById('cliente_bairro').innerHTML = `<strong>Bairro:</strong> ${cliente.bairro_cliente}`;
            document.getElementById('cliente_cidade').innerHTML = `<strong>Cidade:</strong> ${cliente.cidade_cliente}/${cliente.estado_cliente} - CEP: ${cliente.cep_cliente}`;
        }

        function carregarCasasFestas() {
            const select = document.getElementById('casa_festa');
            select.innerHTML = '<option value="">Selecione uma casa de festas</option>';
            casas.forEach(casa => {
                const option = document.createElement('option');
                option.value = casa.id;
                option.textContent = casa.nome_casa;
                select.appendChild(option);
            });
            
            select.addEventListener('change', function() {
                const casaId = this.value;
                if (casaId && !outroLocalAtivo) {
                    const casa = casas.find(c => c.id == casaId);
                    if (casa) {
                        document.getElementById('dados_casa_selecionada').style.display = 'block';
                        document.getElementById('info_casa_selecionada').innerHTML = `
                            <p><strong>Nome:</strong> ${casa.nome_casa}</p>
                            <p><strong>Endere√ßo:</strong> ${casa.logradouro}, ${casa.numero}${casa.complemento ? ', ' + casa.complemento : ''}</p>
                            <p><strong>Bairro:</strong> ${casa.bairro} - ${casa.cidade}/${casa.estado}</p>
                            <p><strong>CEP:</strong> ${casa.cep}</p>
                            <p><strong>Telefone:</strong> ${casa.telefone || 'N√£o informado'}</p>
                        `;
                    }
                } else {
                    document.getElementById('dados_casa_selecionada').style.display = 'none';
                }
            });
        }

        function ativarOutroLocal() {
            outroLocalAtivo = !outroLocalAtivo;
            const btn = document.getElementById('btn_outro_local');
            const campos = document.getElementById('campos_outro_local');
            const select = document.getElementById('casa_festa');
            const dadosCasa = document.getElementById('dados_casa_selecionada');
            
            if (outroLocalAtivo) {
                btn.textContent = 'üè† Usar Casa Cadastrada';
                btn.style.background = '#dc3545';
                btn.style.color = 'white';
                campos.style.display = 'block';
                select.disabled = true;
                select.value = '';
                dadosCasa.style.display = 'none';
            } else {
                btn.textContent = 'üè† Outro Local';
                btn.style.background = '#ffc107';
                btn.style.color = 'black';
                campos.style.display = 'none';
                select.disabled = false;
                limparCamposOutroLocal();
            }
        }

        function limparCamposOutroLocal() {
            document.getElementById('cep_evento').value = '';
            document.getElementById('endereco_evento').value = '';
            document.getElementById('numero_evento').value = '';
            document.getElementById('complemento_evento').value = '';
            document.getElementById('bairro_evento').value = '';
            document.getElementById('cidade_evento').value = '';
            document.getElementById('estado_evento').value = '';
            document.getElementById('telefone_evento').value = '';
        }

        function carregarPersonagensSelect() {
            const select = document.getElementById('personagem_select');
            select.innerHTML = '<option value="">Escolha um personagem</option>';
            personagens.forEach(p => {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = `${p.personagem} - R$ ${parseFloat(p.valor).toFixed(2).replace('.', ',')}`;
                select.appendChild(option);
            });
        }

        function adicionarPersonagemEvento() {
            const select = document.getElementById('personagem_select');
            const personagemId = select.value;
            
            if (!personagemId) {
                alert('Selecione um personagem!');
                return;
            }
            
            const personagem = personagens.find(p => p.id == personagemId);
            if (!personagem) return;
            
            if (personagensSelecionadosEvento.find(p => p.id == personagemId)) {
                alert('Personagem j√° foi adicionado!');
                return;
            }
            
            personagensSelecionadosEvento.push({
                ...personagem,
                quantidade_evento: 1
            });
            
            atualizarPersonagensSelecionados();
            select.value = '';
        }

        function atualizarPersonagensSelecionados() {
            const div = document.getElementById('personagensSelecionados');
            
            if (personagensSelecionadosEvento.length === 0) {
                div.innerHTML = '<p style="color: #666;">Nenhum personagem selecionado</p>';
                calcularValorTotalEvento();
                return;
            }
            
            div.innerHTML = '';
            personagensSelecionadosEvento.forEach((p, index) => {
                const personagemDiv = document.createElement('div');
                personagemDiv.style.cssText = 'display: flex; align-items: center; gap: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 10px; margin-bottom: 1rem; border: 2px solid #DEB887;';
                personagemDiv.innerHTML = `
                    <div style="flex: 1;">
                        <strong>${p.personagem}</strong> - R$ ${parseFloat(p.valor).toFixed(2).replace('.', ',')}
                        <br><small>${p.figurino || 'Sem figurino'} | ${p.tema || 'Sem tema'}</small>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <label>Qtd:</label>
                        <input type="number" value="${p.quantidade_evento}" min="1" max="${p.quantidade}" style="width: 60px;" onchange="alterarQuantidadePersonagem(${index}, this.value)">
                    </div>
                    <button onclick="removerPersonagemEvento(${index})" style="background: #dc3545; color: white; border: none; padding: 0.5rem; border-radius: 5px; cursor: pointer;">üóëÔ∏è</button>
                `;
                div.appendChild(personagemDiv);
            });
            
            calcularValorTotalEvento();
        }

        function alterarQuantidadePersonagem(index, quantidade) {
            personagensSelecionadosEvento[index].quantidade_evento = parseInt(quantidade);
            calcularValorTotalEvento();
        }

        function removerPersonagemEvento(index) {
            personagensSelecionadosEvento.splice(index, 1);
            atualizarPersonagensSelecionados();
        }

        function calcularValorTotalEvento() {
            let total = 0;
            personagensSelecionadosEvento.forEach(p => {
                total += parseFloat(p.valor) * parseInt(p.quantidade_evento);
            });
            
            const desconto = parseFloat(removerFormatacaoMoeda(document.getElementById('desconto').value)) || 0;
            const deslocamento = parseFloat(removerFormatacaoMoeda(document.getElementById('deslocamento').value)) || 0;
            
            total = total - desconto + deslocamento;
            
            document.getElementById('valor_total').value = `R$ ${total.toFixed(2).replace('.', ',')}`;
            
            const valorSinal = parseFloat(removerFormatacaoMoeda(document.getElementById('valor_sinal').value)) || 0;
            const valorAvulso = parseFloat(removerFormatacaoMoeda(document.getElementById('valor_avulso').value)) || 0;
            const valorFaltaReceber = total - valorSinal - valorAvulso;
            
            document.getElementById('valor_falta_receber').value = `R$ ${valorFaltaReceber.toFixed(2).replace('.', ',')}`;
        }
        
        function removerFormatacaoMoeda(valor) {
            if (!valor) return '0';
            return valor.toString().replace(/[R$\s\.]/g, '').replace(',', '.');
        }
        
        function formatarMoeda(valor) {
            valor = valor.replace(/\D/g, '');
            valor = (valor / 100).toFixed(2) + '';
            valor = valor.replace('.', ',');
            valor = valor.replace(/(\d)(\d{3})(\d{3}),/g, '$1.$2.$3,');
            valor = valor.replace(/(\d)(\d{3}),/g, '$1.$2,');
            return 'R$ ' + valor;
        }
        
        function toggleDataPagamentoSinal() {
            const select = document.getElementById('sinal_pago_status');
            const div = document.getElementById('dataPagamentoSinalDiv');
            const input = document.getElementById('dataPagamentoSinal');
            
            if (select.value === 'true') {
                div.style.display = 'block';
                input.value = new Date().toLocaleString('pt-BR');
            } else {
                div.style.display = 'none';
                input.value = '';
            }
        }
        
        function toggleDataPagamentoRestante() {
            const select = document.getElementById('pagamento_total_pago');
            const div = document.getElementById('dataPagamentoRestanteDiv');
            const input = document.getElementById('dataPagamentoRestante');
            
            if (select.value === 'true') {
                div.style.display = 'block';
                input.value = new Date().toLocaleString('pt-BR');
                atualizarValorFaltaReceber();
            } else {
                div.style.display = 'none';
                input.value = '';
            }
        }
        
        function atualizarValorFaltaReceber() {
            calcularValorTotalEvento();
        }
        
        function marcarValorRestantePago(eventoId) {
            const evento = eventos.find(e => e.id === eventoId);
            if (evento) {
                const valorAvulsoPago = parseFloat(evento.valor_avulso || 0);
                const valorFaltaAtual = parseFloat(evento.valor_falta_receber || 0);
                
                if (evento.valor_avulso_pago) {
                    evento.valor_falta_receber = (valorFaltaAtual - valorAvulsoPago).toString();
                }
                
                evento.valor_restante_pago = true;
                evento.data_pagamento_restante = new Date().toLocaleString('pt-BR');
                
                localStorage.setItem('eventos', JSON.stringify(eventos));
            }
        }

        function calcularHoraSaida() {
            const horaEntrada = document.getElementById('hora_entrada').value;
            const duracao = parseInt(document.getElementById('duracao').value) || 0;
            
            if (horaEntrada && duracao > 0) {
                const [horas, minutos] = horaEntrada.split(':').map(Number);
                const totalMinutos = horas * 60 + minutos + (duracao * 60);
                
                const horasSaida = Math.floor(totalMinutos / 60) % 24;
                const minutosSaida = totalMinutos % 60;
                
                const horaSaida = `${horasSaida.toString().padStart(2, '0')}:${minutosSaida.toString().padStart(2, '0')}`;
                document.getElementById('hora_saida').value = horaSaida;
            }
        }

        function toggleDataPagamentoSinal() {
            const sinalPago = document.getElementById('sinal_pago_status').value === 'true';
            const divData = document.getElementById('dataPagamentoSinalDiv');
            if (sinalPago) {
                divData.style.display = 'block';
                const agora = new Date();
                const dataHora = `${agora.toLocaleDateString('pt-BR')} √†s ${agora.toLocaleTimeString('pt-BR')}`;
                document.getElementById('dataPagamentoSinal').value = dataHora;
            } else {
                divData.style.display = 'none';
                document.getElementById('dataPagamentoSinal').value = '';
            }
        }
        
        function toggleDataPagamentoRestante() {
            const restantePago = document.getElementById('pagamento_total_pago').value === 'true';
            const divData = document.getElementById('dataPagamentoRestanteDiv');
            if (restantePago) {
                divData.style.display = 'block';
                const agora = new Date();
                const dataHora = `${agora.toLocaleDateString('pt-BR')} √†s ${agora.toLocaleTimeString('pt-BR')}`;
                document.getElementById('dataPagamentoRestante').value = dataHora;
            } else {
                divData.style.display = 'none';
                document.getElementById('dataPagamentoRestante').value = '';
            }
        }

        function salvarEvento(evento) {
            eventos.push(evento);
            localStorage.setItem('eventos', JSON.stringify(eventos));
            
            document.getElementById('eventoSuccess').style.display = 'block';
            document.getElementById('eventoSuccess').textContent = '‚úÖ Evento reservado com sucesso!';
            document.getElementById('eventoForm').reset();
            document.getElementById('dadosClienteEvento').style.display = 'none';
            document.getElementById('dados_casa_selecionada').style.display = 'none';
            document.getElementById('campos_outro_local').style.display = 'none';
            document.getElementById('campo_nome_empresa_evento').style.display = 'none';
            document.getElementById('dataPagamentoSinalDiv').style.display = 'none';
            document.getElementById('dataPagamentoRestanteDiv').style.display = 'none';
            personagensSelecionadosEvento = [];
            atualizarPersonagensSelecionados();
            
            // Resetar tipo de documento para CPF
            tipoDocumentoEvento = 'cpf';
            selecionarTipoDocEvento('cpf');
            
            outroLocalAtivo = false;
            const btn = document.getElementById('btn_outro_local');
            btn.textContent = 'üè† Outro Local';
            btn.style.background = '#ffc107';
            btn.style.color = 'black';
            document.getElementById('casa_festa').disabled = false;
        }

        function carregarTodosEventos() {
            const lista = document.getElementById('listaTodosEventos');
            const agora = new Date();
            
            // Filtrar apenas eventos que n√£o foram finalizados
            const eventosAtivos = eventos.filter(evento => {
                const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
                const dataEventoFim = new Date(evento.data_evento + 'T' + horaSaida + ':00');
                return dataEventoFim > agora; // Apenas eventos que ainda n√£o finalizaram
            });
            
            if (eventosAtivos.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum evento ativo cadastrado</p>';
                return;
            }
            
            lista.innerHTML = '';
            
            // Ordenar eventos por data
            const eventosOrdenados = [...eventosAtivos].sort((a, b) => new Date(a.data_evento + 'T00:00:00') - new Date(b.data_evento + 'T00:00:00'));
            
            // Implementar pagina√ß√£o
            const totalPaginas = Math.ceil(eventosOrdenados.length / eventosPorPagina);
            const inicio = paginaAtualEventos * eventosPorPagina;
            const fim = inicio + eventosPorPagina;
            const eventosPagina = eventosOrdenados.slice(inicio, fim);
            
            // Atualizar informa√ß√µes de pagina√ß√£o
            document.getElementById('infoEventos').textContent = `P√°gina ${paginaAtualEventos + 1} de ${totalPaginas} (${eventosOrdenados.length} eventos)`;
            document.getElementById('btnAnterior').disabled = paginaAtualEventos === 0;
            document.getElementById('btnProximo').disabled = paginaAtualEventos >= totalPaginas - 1;
            
            eventosPagina.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                const corEvento = obterCorEvento(evento);
                const valorTotal = parseFloat(evento.valor_total || 0);
                const valorSinal = parseFloat(evento.valor_sinal || 0);
                const valorRestante = valorTotal - valorSinal;
                
                // Verificar escala√ß√£o
                const escalacao = escalacoesEventos[evento.id];
                const temElencoEscalado = escalacao && Object.keys(escalacao.personagens || {}).some(p => escalacao.personagens[p].length > 0);
                const temMotoristasEscalados = escalacao && escalacao.motoristas && escalacao.motoristas.length > 0;
                const temEscalacao = temElencoEscalado || temMotoristasEscalados;
                
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid #e9ecef;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="color: #8B4513; margin: 0;">üéâ Evento - ${new Date(evento.data_evento + 'T00:00:00').toLocaleDateString('pt-BR')} - ${evento.hora_entrada} √†s ${evento.hora_saida || calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao)}</h4>
                        <span style="background: ${corEvento}; color: white; padding: 0.3rem 0.8rem; border-radius: 6px; font-size: 0.8rem; font-weight: 500;">
                            ${obterStatusEvento(evento)}
                        </span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <h5 style="color: #666; margin-bottom: 0.5rem;">Dados do Cliente:</h5>
                            <p><strong>Cliente:</strong> ${cliente ? cliente.nome_cliente : 'Cliente n√£o encontrado'}</p>
                            ${evento.nome_empresa_evento ? `<p><strong>Empresa:</strong> ${evento.nome_empresa_evento}</p>` : ''}
                            <p><strong>Aniversariante:</strong> ${cliente ? cliente.nome_aniversariante : (evento.nome_aniversariante || 'N/A')}</p>
                            <p><strong>${evento.tipo_documento_evento === 'cnpj' ? 'CNPJ' : 'CPF'}:</strong> ${evento.cpf_cliente}</p>
                            <p><strong>Telefone:</strong> ${cliente ? cliente.telefone_cliente || 'N/A' : 'N/A'}</p>
                        </div>
                        <div>
                            <h5 style="color: #666; margin-bottom: 0.5rem;">Local do Evento:</h5>
                            <p><strong>Casa:</strong> ${casa ? casa.nome_casa : (evento.outro_local ? 'Outro Local' : 'N/A')}</p>
                            <p><strong>Endere√ßo:</strong> ${casa ? `${casa.logradouro}, ${casa.numero}${casa.complemento ? ', ' + casa.complemento : ''}` : (evento.endereco_evento ? `${evento.endereco_evento}, ${evento.numero_evento || 'S/N'}${evento.complemento_evento ? ', ' + evento.complemento_evento : ''}` : 'N/A')}</p>
                            <p><strong>Bairro:</strong> ${casa ? casa.bairro : (evento.bairro_evento || 'N/A')}</p>
                            <p><strong>CEP:</strong> ${casa ? casa.cep : (evento.cep_evento || 'N/A')}</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <h5 style="color: #666; margin-bottom: 0.5rem;">Detalhes do Evento:</h5>
                        <p><strong>Dura√ß√£o:</strong> ${evento.duracao}h (${evento.hora_entrada} - ${evento.hora_saida || calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao)})</p>
                        ${evento.personagens && evento.personagens.length > 0 ? `
                            <p><strong>Personagens:</strong> ${evento.personagens.map(p => `${p.personagem} (${p.quantidade_evento}x)`).join(', ')}</p>
                        ` : ''}
                        ${evento.observacoes ? `<p><strong>Observa√ß√µes:</strong> ${evento.observacoes}</p>` : ''}
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1rem; padding: 1rem; background: #e9ecef; border-radius: 8px;">
                        <div><strong>Valor Total:</strong><br>R$ ${valorTotal.toFixed(2).replace('.', ',')}</div>
                        <div><strong>Sinal:</strong><br>R$ ${valorSinal.toFixed(2).replace('.', ',')}</div>
                        <div><strong>Valor Restante:</strong><br>R$ ${valorRestante.toFixed(2).replace('.', ',')}</div>
                        ${evento.desconto && parseFloat(evento.desconto) > 0 ? `<div><strong>Desconto:</strong><br>R$ ${parseFloat(evento.desconto).toFixed(2).replace('.', ',')}</div>` : ''}
                        ${evento.deslocamento && parseFloat(evento.deslocamento) > 0 ? `<div><strong>Deslocamento:</strong><br>R$ ${parseFloat(evento.deslocamento).toFixed(2).replace('.', ',')}</div>` : ''}
                        <div><strong>Pagamento:</strong><br>${evento.forma_pagamento_sinal || 'N/A'}</div>
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
                            <button onclick="editarEvento(${evento.id})" style="background: #6c757d; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">‚úèÔ∏è Editar</button>
                            ${temEscalacao ? `<button onclick="abrirEscalacao(${evento.id})" style="background: #6c757d; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">üë• Escalar</button>` : ''}
                            <button onclick="excluirEvento(${evento.id})" style="background: #6c757d; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">üóëÔ∏è Excluir</button>
                            <button onclick="gerarContrato(${evento.id})" style="background: #6c757d; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">üìÑ Gerar Contrato</button>
                        </div>
                        <div style="display: flex; gap: 0.3rem; margin-bottom: 0.5rem;">
                            <button onclick="alternarStatusContrato(${evento.id}, 'pendente')" style="background: ${(evento.status_contrato === 'pendente' || !evento.status_contrato) ? '#ffc107' : '#6c757d'}; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 5px; cursor: pointer; font-size: 0.8rem;">
                                ${(evento.status_contrato === 'pendente' || !evento.status_contrato) ? '‚è≥' : '‚ö™'} Pendente Confirma√ß√£o
                            </button>
                            <button onclick="alternarStatusContrato(${evento.id}, 'aceito')" style="background: ${evento.status_contrato === 'aceito' ? '#28a745' : '#6c757d'}; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 5px; cursor: pointer; font-size: 0.8rem;">
                                ${evento.status_contrato === 'aceito' ? '‚úÖ' : '‚ö™'} Contrato Aceito
                            </button>
                        </div>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 0.3rem;">
                                <span style="background: ${evento.sinal_pago ? '#28a745' : '#dc3545'}; color: white; padding: 0.3rem 0.6rem; border-radius: 15px; font-size: 0.8rem;">
                                    ${evento.sinal_pago ? '‚úÖ Sinal Pago' : '‚ùå Sinal Pendente'}
                                </span>
                                <button onclick="registrarPagamento(${evento.id}, 'sinal')" style="background: ${evento.sinal_pago ? '#dc3545' : '#28a745'}; color: white; border: none; padding: 0.2rem 0.4rem; border-radius: 3px; cursor: pointer; font-size: 0.7rem;">
                                    ${evento.sinal_pago ? 'Cancelar' : 'Pagar'}
                                </button>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.3rem;">
                                <span style="background: ${evento.valor_restante_pago ? '#28a745' : '#dc3545'}; color: white; padding: 0.3rem 0.6rem; border-radius: 15px; font-size: 0.8rem;">
                                    ${evento.valor_restante_pago ? '‚úÖ Restante Pago' : '‚ùå Restante Pendente'}
                                </span>
                                <button onclick="registrarPagamento(${evento.id}, 'restante')" style="background: ${evento.valor_restante_pago ? '#dc3545' : '#28a745'}; color: white; border: none; padding: 0.2rem 0.4rem; border-radius: 3px; cursor: pointer; font-size: 0.7rem;">
                                    ${evento.valor_restante_pago ? 'Cancelar' : 'Pagar'}
                                </button>
                            </div>
                            <span style="background: ${evento.confirmacao ? '#28a745' : '#ffc107'}; color: ${evento.confirmacao ? 'white' : 'black'}; padding: 0.3rem 0.6rem; border-radius: 15px; font-size: 0.8rem;">
                                ${evento.confirmacao ? '‚úÖ Confirmado' : '‚è≥ Aguardando'}
                            </span>
                        </div>
                        ${evento.data_pagamento_sinal ? `<p style="font-size: 0.8rem; color: #666; margin: 0.3rem 0;">üìÖ Sinal pago em: ${evento.data_pagamento_sinal}</p>` : ''}
                        ${evento.data_pagamento_restante ? `<p style="font-size: 0.8rem; color: #666; margin: 0.3rem 0;">üìÖ Valor restante pago em: ${evento.data_pagamento_restante}</p>` : ''}
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function navegarEventos(direcao) {
            const agora = new Date();
            const eventosAtivos = eventos.filter(evento => {
                const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
                const dataEventoFim = new Date(evento.data_evento + 'T' + horaSaida + ':00');
                return dataEventoFim > agora;
            });
            
            const totalPaginas = Math.ceil(eventosAtivos.length / eventosPorPagina);
            
            if (direcao === 1 && paginaAtualEventos < totalPaginas - 1) {
                paginaAtualEventos++;
            } else if (direcao === -1 && paginaAtualEventos > 0) {
                paginaAtualEventos--;
            }
            
            carregarTodosEventos();
        }
        
        function carregarEventosFuturos() {
            const lista = document.getElementById('listaEventosFuturos');
            const agora = new Date();
            
            const eventosFuturos = eventos
                .filter(evento => {
                    const dataEvento = new Date(evento.data_evento + 'T00:00:00');
                    const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
                    const [horas, minutos] = horaSaida.split(':').map(Number);
                    dataEvento.setHours(horas, minutos, 0, 0);
                    return dataEvento > agora;
                })
                .sort((a, b) => new Date(a.data_evento) - new Date(b.data_evento))
                .slice(0, 15);
            
            if (eventosFuturos.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; margin-top: 2rem;">üìÖ Nenhum evento futuro encontrado</p>';
                return;
            }
            
            let html = `
                <div style="background: linear-gradient(135deg, #8B4513, #DAA520); padding: 1rem; border-radius: 10px; margin-bottom: 1rem; color: white; text-align: center;">
                    <h2 style="margin: 0; font-size: 1.3rem;">üìÖ Pr√≥ximos 15 Eventos</h2>
                    <p style="margin: 0.5rem 0 0 0; opacity: 0.9; font-size: 0.9rem;">Eventos programados para os pr√≥ximos dias</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
            `;
            
            eventosFuturos.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                const corEvento = obterCorEvento(evento);
                
                // Verificar escala√ß√£o
                const escalacao = escalacoesEventos[evento.id];
                const temElencoEscalado = escalacao && Object.keys(escalacao.personagens || {}).some(p => escalacao.personagens[p].length > 0);
                const temMotoristasEscalados = escalacao && escalacao.motoristas && escalacao.motoristas.length > 0;
                const temEscalacao = temElencoEscalado || temMotoristasEscalados;
                
                html += `
                    <div style="background: linear-gradient(135deg, ${corEvento}15, ${corEvento}08); border-radius: 15px; padding: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 3px solid ${corEvento}; position: relative;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.8rem;">
                            <h3 style="color: #8B4513; margin: 0; font-size: 1rem;">${new Date(evento.data_evento + 'T00:00:00').toLocaleDateString('pt-BR')} - ${evento.hora_entrada} √†s ${evento.hora_saida || calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao)}</h3>
                            <span style="background: ${corEvento}; color: white; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.7rem; font-weight: bold;">
                                ${obterStatusEvento(evento)}
                            </span>
                        </div>
                        
                        <div style="margin-bottom: 0.8rem; font-size: 0.85rem;">
                            <p style="margin: 0.1rem 0; color: #333;"><strong>${evento.nome_aniversariante || (cliente ? cliente.nome_aniversariante : 'N/A')}</strong> (${evento.idade_aniversariante || (cliente ? calcularIdade(cliente.data_nascimento_aniversariante) : 'N/A')} anos)</p>
                            <p style="margin: 0.1rem 0; color: #666;">${cliente ? cliente.nome_cliente : 'N/A'}</p>
                            ${cliente && cliente.nome_empresa ? `<p style="margin: 0.1rem 0; color: #666; font-size: 0.8rem;">${cliente.nome_empresa}</p>` : ''}
                            <p style="margin: 0.1rem 0; color: #666;">${evento.hora_entrada} - ${evento.hora_saida || calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao)} (${evento.duracao}h)</p>
                            <p style="margin: 0.1rem 0; color: #666; font-size: 0.8rem;">${casa ? casa.nome_casa : (evento.outro_local ? 'Outro Local' : 'N/A')}</p>
                            <p style="margin: 0.1rem 0; color: #666; font-size: 0.75rem;">${casa ? `${casa.logradouro}, ${casa.numero} - ${casa.bairro}, ${casa.cep}` : (evento.endereco_evento ? `${evento.endereco_evento}, ${evento.numero_evento || 'S/N'} - ${evento.bairro_evento}, ${evento.cep_evento}` : '')}</p>
                        </div>
                        
                        <div style="margin-bottom: 0.8rem;">
                            <div style="font-size: 0.8rem; color: #8B4513; font-weight: bold; margin-bottom: 0.3rem;">Personagens:</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.2rem;">
                                ${evento.personagens ? evento.personagens.map(p => {
                                    const personagem = personagens.find(per => per.id === p.id);
                                    return `<span style="background: #f8f9fa; padding: 0.2rem 0.4rem; border-radius: 8px; font-size: 0.7rem; border: 1px solid #DEB887;">${personagem ? personagem.nome || personagem.personagem : 'N/A'}</span>`;
                                }).join('') : '<span style="color: #999; font-size: 0.7rem;">Nenhum</span>'}
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 0.8rem;">
                            <div style="font-size: 0.8rem; color: #8B4513; font-weight: bold; margin-bottom: 0.3rem;">Equipe Dispon√≠vel:</div>
                            <div style="font-size: 0.75rem;">
                                <div style="color: ${(() => {
                                    if (!temElencoEscalado) return '#dc3545';
                                    // Verificar se todos os personagens est√£o escalados
                                    if (evento.personagens && evento.personagens.length > 0) {
                                        const todosEscalados = evento.personagens.every(p => {
                                            const elencoEscalado = escalacao?.personagens?.[p.id] || [];
                                            return elencoEscalado.length > 0;
                                        });
                                        return todosEscalados ? '#28a745' : '#ffc107';
                                    }
                                    return '#28a745';
                                })()}; font-weight: bold;">
                                    <strong>Elenco:</strong> ${temElencoEscalado ? 
                                        (() => {
                                            const nomes = [];
                                            if (escalacao.personagens) {
                                                Object.keys(escalacao.personagens).forEach(pId => {
                                                    const elencoIds = escalacao.personagens[pId] || [];
                                                    elencoIds.forEach(eId => {
                                                        const membro = elenco.find(e => e.id == eId);
                                                        if (membro && !nomes.includes(membro.nome_completo.split(' ')[0])) {
                                                            nomes.push(membro.nome_completo.split(' ')[0]);
                                                        }
                                                    });
                                                });
                                            }
                                            // Verificar se falta escalar algu√©m
                                            if (evento.personagens && evento.personagens.length > 0) {
                                                const todosEscalados = evento.personagens.every(p => {
                                                    const elencoEscalado = escalacao?.personagens?.[p.id] || [];
                                                    return elencoEscalado.length > 0;
                                                });
                                                if (!todosEscalados) {
                                                    return nomes.length > 0 ? nomes.join(', ') + ' (Falta Escalar)' : 'Parcialmente Escalado';
                                                }
                                            }
                                            return nomes.length > 0 ? nomes.join(', ') : 'Escalado';
                                        })()
                                        : 'Pendente de Escala'}
                                </div>
                                <div style="color: ${temMotoristasEscalados ? '#28a745' : '#dc3545'}; font-weight: bold;">
                                    <strong>Motoristas:</strong> ${temMotoristasEscalados ? 
                                        escalacao.motoristas.map(mId => {
                                            const motorista = motoristas.find(m => m.id == mId);
                                            return motorista ? motorista.nome_completo.split(' ')[0] : 'N/A';
                                        }).join(', ') 
                                        : 'Pendente de Escala'}
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 0.8rem;">
                            <div style="font-size: 0.8rem; color: #8B4513; font-weight: bold; margin-bottom: 0.3rem;">Status de Pagamento:</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.3rem; margin-bottom: 0.5rem;">
                                <div style="display: flex; align-items: center; gap: 0.2rem;">
                                    <span style="background: ${evento.sinal_pago ? '#28a745' : '#dc3545'}; color: white; padding: 0.2rem 0.4rem; border-radius: 8px; font-size: 0.6rem;">
                                        ${evento.sinal_pago ? '‚úÖ Sinal Pago' : '‚ùå Sinal Pendente'}
                                    </span>
                                    <button onclick="registrarPagamento(${evento.id}, 'sinal')" style="background: ${evento.sinal_pago ? '#dc3545' : '#28a745'}; color: white; border: none; padding: 0.1rem 0.3rem; border-radius: 3px; cursor: pointer; font-size: 0.6rem;">
                                        ${evento.sinal_pago ? '‚ùå' : '‚úÖ'}
                                    </button>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.2rem;">
                                    <span style="background: ${evento.valor_restante_pago ? '#28a745' : '#dc3545'}; color: white; padding: 0.2rem 0.4rem; border-radius: 8px; font-size: 0.6rem;">
                                        ${evento.valor_restante_pago ? '‚úÖ Restante Pago' : '‚ùå Restante Pendente'}
                                    </span>
                                    <button onclick="registrarPagamento(${evento.id}, 'restante')" style="background: ${evento.valor_restante_pago ? '#dc3545' : '#28a745'}; color: white; border: none; padding: 0.1rem 0.3rem; border-radius: 3px; cursor: pointer; font-size: 0.6rem;">
                                        ${evento.valor_restante_pago ? '‚ùå' : '‚úÖ'}
                                    </button>
                                </div>
                            </div>
                            ${evento.data_pagamento_sinal ? `<p style="font-size: 0.6rem; color: #666; margin: 0.1rem 0;">üìÖ Sinal pago: ${new Date(evento.data_pagamento_sinal).toLocaleDateString('pt-BR')}</p>` : ''}
                            ${evento.data_pagamento_restante ? `<p style="font-size: 0.6rem; color: #666; margin: 0.1rem 0;">üìÖ Restante pago: ${new Date(evento.data_pagamento_restante).toLocaleDateString('pt-BR')}</p>` : ''}
                            <div style="display: flex; flex-wrap: wrap; gap: 0.3rem; margin-top: 0.3rem;">
                                <span style="background: ${evento.confirmado ? '#28a745' : '#ffc107'}; color: ${evento.confirmado ? 'white' : 'black'}; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.65rem;">
                                    ${evento.confirmado ? '‚úÖ Dados Confirmados' : '‚è≥ Aguardando Confirma√ß√£o'}
                                </span>
                                <span style="background: ${(evento.status_contrato === 'aceito') ? '#28a745' : '#ffc107'}; color: white; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.65rem;">
                                    ${(evento.status_contrato === 'aceito') ? '‚úÖ Contrato Aceito' : '‚è≥ Contrato Pendente'}
                                </span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 0.8rem;">
                            <div style="display: flex; gap: 0.3rem; margin-bottom: 0.5rem;">
                                <button onclick="gerarContrato(${evento.id})" style="background: #17a2b8; color: white; border: none; padding: 0.3rem 0.6rem; border-radius: 5px; cursor: pointer; font-size: 0.7rem;">üìÑ Gerar Contrato</button>
                                <button onclick="editarEvento(${evento.id})" style="background: #DAA520; color: white; border: none; padding: 0.3rem 0.6rem; border-radius: 5px; cursor: pointer; font-size: 0.7rem;">‚úèÔ∏è</button>
                                <button onclick="abrirEscalacao(${evento.id})" style="background: #28a745; color: white; border: none; padding: 0.3rem 0.6rem; border-radius: 5px; cursor: pointer; font-size: 0.7rem;">Escalar</button>
                            </div>
                            <div style="display: flex; gap: 0.2rem;">
                                <button onclick="alternarStatusContrato(${evento.id}, 'pendente')" style="background: ${(evento.status_contrato === 'pendente' || !evento.status_contrato) ? '#ffc107' : '#6c757d'}; color: white; border: none; padding: 0.2rem 0.4rem; border-radius: 3px; cursor: pointer; font-size: 0.6rem;">
                                    ${(evento.status_contrato === 'pendente' || !evento.status_contrato) ? '‚è≥' : '‚ö™'} Pendente
                                </button>
                                <button onclick="alternarStatusContrato(${evento.id}, 'aceito')" style="background: ${evento.status_contrato === 'aceito' ? '#28a745' : '#6c757d'}; color: white; border: none; padding: 0.2rem 0.4rem; border-radius: 3px; cursor: pointer; font-size: 0.6rem;">
                                    ${evento.status_contrato === 'aceito' ? '‚úÖ' : '‚ö™'} Aceito
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            lista.innerHTML = html;
        }

        function carregarConfirmarDados() {
            const lista = document.getElementById('listaConfirmarDados');
            const eventosParaConfirmar = eventos.filter(e => e.sinal_pago && !e.confirmado);
            
            if (eventosParaConfirmar.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum evento com sinal pago para confirmar</p>';
                return;
            }
            
            lista.innerHTML = '';
            eventosParaConfirmar.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
                
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 10px; border: 2px solid #28a745;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                        <h4 style="color: #8B4513; margin: 0;">üìÖ ${new Date(evento.data_evento).toLocaleDateString('pt-BR')} - ${evento.hora_entrada} √†s ${horaSaida}</h4>
                        <span style="background: #28a745; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">
                            ‚úÖ Sinal Pago
                        </span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <p><strong>Cliente:</strong> ${cliente ? cliente.nome_cliente : 'Cliente n√£o encontrado'}</p>
                            <p><strong>Aniversariante:</strong> ${cliente ? cliente.nome_aniversariante : (evento.nome_aniversariante || 'N/A')}</p>
                            <p><strong>Telefone:</strong> ${cliente ? cliente.telefone_cliente || 'N/A' : 'N/A'}</p>
                        </div>
                        <div>
                            <p><strong>Local:</strong> ${casa ? casa.nome_casa : (evento.outro_local ? 'Outro Local' : 'N/A')}</p>
                            <p><strong>Valor Total:</strong> R$ ${parseFloat(evento.valor_total || 0).toFixed(2).replace('.', ',')}</p>
                            <p><strong>Sinal Pago:</strong> R$ ${parseFloat(evento.valor_sinal || 0).toFixed(2).replace('.', ',')}</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e9ecef; border-radius: 8px;">
                        <strong>Endere√ßo Completo:</strong><br>
                        ${casa ? `${casa.logradouro}, ${casa.numero}${casa.complemento ? ', ' + casa.complemento : ''} - ${casa.bairro}, ${casa.cidade}/${casa.estado} - CEP: ${casa.cep}` : 
                        (evento.endereco_evento ? `${evento.endereco_evento}, ${evento.numero_evento || 'S/N'}${evento.complemento_evento ? ', ' + evento.complemento_evento : ''} - ${evento.bairro_evento}, ${evento.cidade_evento}/${evento.estado_evento} - CEP: ${evento.cep_evento}` : 'Endere√ßo n√£o informado')}
                    </div>
                    
                    ${evento.personagens && evento.personagens.length > 0 ? `
                        <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e9ecef; border-radius: 8px;">
                            <strong>Personagens:</strong> ${evento.personagens.map(p => `${p.personagem} (${p.quantidade_evento}x)`).join(', ')}
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: 1rem;">
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
                            <button onclick="confirmarEvento(${evento.id})" style="background: #28a745; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 5px; cursor: pointer; font-weight: bold;">‚úÖ CONFIRMAR EVENTO</button>
                            <button onclick="gerarContrato(${evento.id})" style="background: #17a2b8; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 5px; cursor: pointer;">üìÑ Gerar Contrato</button>
                        </div>
                        <div style="display: flex; gap: 0.3rem;">
                            <button onclick="alternarStatusContrato(${evento.id}, 'pendente')" style="background: ${(evento.status_contrato === 'pendente' || !evento.status_contrato) ? '#ffc107' : '#6c757d'}; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 5px; cursor: pointer; font-size: 0.8rem;">
                                ${(evento.status_contrato === 'pendente' || !evento.status_contrato) ? '‚è≥' : '‚ö™'} Pendente Confirma√ß√£o
                            </button>
                            <button onclick="alternarStatusContrato(${evento.id}, 'aceito')" style="background: ${evento.status_contrato === 'aceito' ? '#28a745' : '#6c757d'}; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 5px; cursor: pointer; font-size: 0.8rem;">
                                ${evento.status_contrato === 'aceito' ? '‚úÖ' : '‚ö™'} Contrato Aceito
                            </button>
                        </div>
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function carregarEquipeEscalada() {
            const lista = document.getElementById('listaEquipeEscalada');
            const agora = new Date();
            
            const eventosEscalados = eventos.filter(e => {
                const dataEvento = new Date(e.data_evento + 'T00:00:00');
                const horaSaida = calcularHoraSaidaEvento(e.hora_entrada, e.duracao);
                const [horas, minutos] = horaSaida.split(':').map(Number);
                dataEvento.setHours(horas, minutos, 0, 0);
                
                if (dataEvento <= agora) return false;
                
                const escalacao = escalacoesEventos[e.id];
                
                // Verificar se todos os personagens est√£o escalados
                let todosPersonagensEscalados = true;
                if (e.personagens && e.personagens.length > 0) {
                    todosPersonagensEscalados = e.personagens.every(p => {
                        const elencoEscalado = escalacao?.personagens?.[p.id] || [];
                        return elencoEscalado.length > 0;
                    });
                }
                
                // Verificar se tem motoristas escalados
                const temMotoristasEscalados = escalacao?.motoristas && escalacao.motoristas.length > 0;
                
                // Evento est√° completamente escalado se tem todos os personagens E motoristas
                return todosPersonagensEscalados && temMotoristasEscalados;
            }).sort((a, b) => new Date(a.data_evento) - new Date(b.data_evento));
            
            if (eventosEscalados.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhuma equipe escalada</p>';
                return;
            }
            
            lista.innerHTML = '';
            eventosEscalados.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                const escalacao = escalacoesEventos[evento.id];
                const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
                
                let personagensEscalados = '';
                let motoristasEscalados = '';
                
                if (evento.personagens && evento.personagens.length > 0) {
                    personagensEscalados = evento.personagens.map(p => {
                        const elencoEscalado = escalacao?.personagens?.[p.id] || [];
                        const nomesElenco = elencoEscalado.map(eId => {
                            const membro = elenco.find(e => e.id == eId);
                            return membro ? membro.nome_completo : 'N/A';
                        }).join(', ');
                        return `${p.personagem}: ${nomesElenco || 'N√£o escalado'}`;
                    }).join('<br>');
                }
                
                if (escalacao?.motoristas && escalacao.motoristas.length > 0) {
                    motoristasEscalados = escalacao.motoristas.map(mId => {
                        const motorista = motoristas.find(m => m.id == mId);
                        return motorista ? motorista.nome_completo : 'N/A';
                    }).join(', ');
                }
                
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 10px; border: 3px solid #28a745;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="color: #8B4513; margin: 0;">üìÖ ${new Date(evento.data_evento).toLocaleDateString('pt-BR')} - ${evento.hora_entrada} √†s ${horaSaida}</h4>
                        <span style="background: #28a745; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
                            üë• EQUIPE ESCALADA
                        </span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <p><strong>Cliente:</strong> ${cliente ? cliente.nome_cliente : 'N/A'}</p>
                            ${evento.nome_empresa_evento ? `<p><strong>Empresa:</strong> ${evento.nome_empresa_evento}</p>` : ''}
                            <p><strong>Aniversariante:</strong> ${cliente ? cliente.nome_aniversariante : (evento.nome_aniversariante || 'N/A')}</p>
                        </div>
                        <div>
                            <p><strong>Local:</strong> ${casa ? casa.nome_casa : (evento.outro_local ? 'Outro Local' : 'N/A')}</p>
                            <p><strong>Dura√ß√£o:</strong> ${evento.duracao}h</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e9ecef; border-radius: 8px;">
                        <strong>Endere√ßo Completo:</strong><br>
                        ${casa ? `${casa.logradouro}, ${casa.numero}${casa.complemento ? ', ' + casa.complemento : ''} - ${casa.bairro}, ${casa.cidade}/${casa.estado} - CEP: ${casa.cep}` : 
                        (evento.endereco_evento ? `${evento.endereco_evento}, ${evento.numero_evento || 'S/N'}${evento.complemento_evento ? ', ' + evento.complemento_evento : ''} - ${evento.bairro_evento}, ${evento.cidade_evento}/${evento.estado_evento} - CEP: ${evento.cep_evento}` : 'Endere√ßo n√£o informado')}
                    </div>
                    
                    ${personagensEscalados ? `
                        <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e8f5e8; border-radius: 8px;">
                            <strong>üé≠ Personagens Escalados:</strong><br>
                            ${personagensEscalados}
                        </div>
                    ` : ''}
                    
                    ${motoristasEscalados ? `
                        <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e3f2fd; border-radius: 8px;">
                            <strong>üöó Motoristas Escalados:</strong><br>
                            ${motoristasEscalados}
                        </div>
                    ` : ''}
                `;
                lista.appendChild(card);
            });
        }
        
        function carregarEventosPendenteEscala() {
            const lista = document.getElementById('listaEventosPendenteEscala');
            const agora = new Date();
            
            const eventosPendentes = eventos.filter(e => {
                const dataEvento = new Date(e.data_evento);
                const horaSaida = calcularHoraSaidaEvento(e.hora_entrada, e.duracao);
                const [horas, minutos] = horaSaida.split(':').map(Number);
                dataEvento.setHours(horas, minutos, 0, 0);
                
                if (dataEvento <= agora) return false;
                
                const escalacao = escalacoesEventos[e.id];
                
                // Verificar se todos os personagens est√£o escalados
                let todosPersonagensEscalados = true;
                if (e.personagens && e.personagens.length > 0) {
                    todosPersonagensEscalados = e.personagens.every(p => {
                        const elencoEscalado = escalacao?.personagens?.[p.id] || [];
                        return elencoEscalado.length > 0;
                    });
                }
                
                // Verificar se tem motoristas escalados (se necess√°rio)
                const temMotoristasEscalados = escalacao?.motoristas && escalacao.motoristas.length > 0;
                
                // Evento est√° pendente se n√£o tem todos os personagens escalados OU n√£o tem motoristas
                return !todosPersonagensEscalados || !temMotoristasEscalados;
            }).sort((a, b) => new Date(a.data_evento) - new Date(b.data_evento));
            
            if (eventosPendentes.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum evento pendente de escala√ß√£o</p>';
                return;
            }
            
            lista.innerHTML = '';
            eventosPendentes.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
                
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 10px; border: 3px solid #dc3545;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="color: #8B4513; margin: 0;">üìÖ ${new Date(evento.data_evento).toLocaleDateString('pt-BR')} - ${evento.hora_entrada} √†s ${horaSaida}</h4>
                        <span style="background: #dc3545; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
                            ‚è≥ PENDENTE ESCALA√á√ÉO
                        </span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <p><strong>Cliente:</strong> ${cliente ? cliente.nome_cliente : 'N/A'}</p>
                            ${evento.nome_empresa_evento ? `<p><strong>Empresa:</strong> ${evento.nome_empresa_evento}</p>` : ''}
                            <p><strong>Aniversariante:</strong> ${cliente ? cliente.nome_aniversariante : (evento.nome_aniversariante || 'N/A')}</p>
                        </div>
                        <div>
                            <p><strong>Local:</strong> ${casa ? casa.nome_casa : (evento.outro_local ? 'Outro Local' : 'N/A')}</p>
                            <p><strong>Dura√ß√£o:</strong> ${evento.duracao}h</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e9ecef; border-radius: 8px;">
                        <strong>Endere√ßo Completo:</strong><br>
                        ${casa ? `${casa.logradouro}, ${casa.numero}${casa.complemento ? ', ' + casa.complemento : ''} - ${casa.bairro}, ${casa.cidade}/${casa.estado} - CEP: ${casa.cep}` : 
                        (evento.endereco_evento ? `${evento.endereco_evento}, ${evento.numero_evento || 'S/N'}${evento.complemento_evento ? ', ' + evento.complemento_evento : ''} - ${evento.bairro_evento}, ${evento.cidade_evento}/${evento.estado_evento} - CEP: ${evento.cep_evento}` : 'Endere√ßo n√£o informado')}
                    </div>
                    
                    ${evento.personagens && evento.personagens.length > 0 ? `
                        <div style="margin-bottom: 1rem; padding: 0.8rem; background: #fff3cd; border-radius: 8px;">
                            <strong>üé≠ Personagens a Escalar:</strong><br>
                            ${evento.personagens.map(p => `${p.personagem} (${p.quantidade_evento}x)`).join(', ')}
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button onclick="abrirEscalacao(${evento.id})" style="background: #28a745; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 5px; cursor: pointer; font-weight: bold;">üë• ESCALAR EQUIPE</button>
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function confirmarEvento(id) {
            const evento = eventos.find(e => e.id === id);
            if (evento) {
                evento.confirmado = true;
                const agora = new Date();
                evento.data_confirmacao = `${agora.toLocaleDateString('pt-BR')} √†s ${agora.toLocaleTimeString('pt-BR')}`;
                localStorage.setItem('eventos', JSON.stringify(eventos));
                carregarConfirmarDados();
            }
        }
        
        function carregarRelatorioConfirmacao() {
            const lista = document.getElementById('listaRelatorioConfirmacao');
            const eventosConfirmados = eventos.filter(e => e.confirmado);
            
            if (eventosConfirmados.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum evento com dados confirmados</p>';
                return;
            }
            
            lista.innerHTML = '';
            eventosConfirmados.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
                const valorTotal = parseFloat(evento.valor_total || 0);
                const valorSinal = parseFloat(evento.valor_sinal || 0);
                const valorRestante = valorTotal - valorSinal;
                
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 10px; border: 3px solid #ffc107;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="color: #8B4513; margin: 0;">‚úÖ ${new Date(evento.data_evento).toLocaleDateString('pt-BR')} - ${evento.hora_entrada} √†s ${horaSaida}</h4>
                        <span style="background: #ffc107; color: black; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
                            ‚úÖ DADOS CONFIRMADOS
                        </span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <p><strong>Cliente:</strong> ${cliente ? cliente.nome_cliente : 'N/A'}</p>
                            <p><strong>Aniversariante:</strong> ${cliente ? cliente.nome_aniversariante : (evento.nome_aniversariante || 'N/A')}</p>
                            <p><strong>Telefone:</strong> ${cliente ? cliente.telefone_cliente || 'N/A' : 'N/A'}</p>
                        </div>
                        <div>
                            <p><strong>Local:</strong> ${casa ? casa.nome_casa : (evento.outro_local ? 'Outro Local' : 'N/A')}</p>
                            <p><strong>Valor Total:</strong> R$ ${valorTotal.toFixed(2).replace('.', ',')}</p>
                            <p><strong>Sinal:</strong> R$ ${valorSinal.toFixed(2).replace('.', ',')} ${evento.sinal_pago ? '‚úÖ' : '‚ùå'}</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e9ecef; border-radius: 8px;">
                        <strong>Endere√ßo Completo:</strong><br>
                        ${casa ? `${casa.logradouro}, ${casa.numero}${casa.complemento ? ', ' + casa.complemento : ''} - ${casa.bairro}, ${casa.cidade}/${casa.estado} - CEP: ${casa.cep}` : 
                        (evento.endereco_evento ? `${evento.endereco_evento}, ${evento.numero_evento || 'S/N'}${evento.complemento_evento ? ', ' + evento.complemento_evento : ''} - ${evento.bairro_evento}, ${evento.cidade_evento}/${evento.estado_evento} - CEP: ${evento.cep_evento}` : 'Endere√ßo n√£o informado')}
                    </div>
                    
                    ${evento.personagens && evento.personagens.length > 0 ? `
                        <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e8f5e8; border-radius: 8px;">
                            <strong>Personagens:</strong> ${evento.personagens.map(p => `${p.personagem} (${p.quantidade_evento}x)`).join(', ')}
                        </div>
                    ` : ''}
                    
                    <div style="margin-bottom: 1rem; padding: 0.8rem; background: #d4edda; border-radius: 8px;">
                        <strong>‚úÖ Data de Confirma√ß√£o:</strong> ${evento.data_confirmacao || 'N/A'}
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button onclick="gerarContrato(${evento.id})" style="background: #17a2b8; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">üìÑ Gerar Contrato</button>
                        <span style="background: ${evento.valor_restante_pago ? '#28a745' : '#dc3545'}; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">
                            Restante: ${evento.valor_restante_pago ? '‚úÖ Pago' : '‚ùå Pendente'}
                        </span>
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function marcarSinalPago(id) {
            const evento = eventos.find(e => e.id === id);
            if (evento) {
                evento.sinal_pago = !evento.sinal_pago;
                localStorage.setItem('eventos', JSON.stringify(eventos));
                carregarEscala();
            }
        }

        function marcarValorRestantePago(id) {
            const evento = eventos.find(e => e.id === id);
            if (evento) {
                evento.valor_restante_pago = !evento.valor_restante_pago;
                localStorage.setItem('eventos', JSON.stringify(eventos));
                carregarEscala();
            }
        }

        function editarEvento(id) {
            const evento = eventos.find(e => e.id === id);
            if (evento) {
                document.getElementById('edit_evento_id').value = id;
                document.getElementById('edit_cpf_evento').value = evento.cpf_cliente || '';
                document.getElementById('edit_nome_empresa_evento').value = evento.nome_empresa_evento || '';
                
                // Configurar tipo de documento
                tipoDocumentoEventoEdicao = evento.tipo_documento_evento || 'cpf';
                selecionarTipoDocEventoEdicao(tipoDocumentoEventoEdicao);
                
                document.getElementById('edit_data_evento').value = evento.data_evento || '';
                document.getElementById('edit_hora_entrada').value = evento.hora_entrada || '';
                document.getElementById('edit_duracao').value = evento.duracao || '';
                document.getElementById('edit_valor_sinal').value = evento.valor_sinal ? `R$ ${parseFloat(evento.valor_sinal).toFixed(2).replace('.', ',')}` : '';
                document.getElementById('edit_sinal_pago_status').value = evento.sinal_pago ? 'true' : 'false';
                document.getElementById('edit_desconto').value = evento.desconto ? `R$ ${parseFloat(evento.desconto).toFixed(2).replace('.', ',')}` : '';
                document.getElementById('edit_deslocamento').value = evento.deslocamento ? `R$ ${parseFloat(evento.deslocamento).toFixed(2).replace('.', ',')}` : '';
                document.getElementById('edit_pagamento_total_pago').value = evento.pagamento_total_pago ? 'true' : 'false';
                document.getElementById('edit_valor_total').value = evento.valor_total ? `R$ ${parseFloat(evento.valor_total).toFixed(2).replace('.', ',')}` : '';
                document.getElementById('edit_observacoes').value = evento.observacoes || '';
                
                // Carregar personagens do evento
                personagensEdicaoSelecionados = evento.personagens ? [...evento.personagens] : [];
                carregarPersonagensSelectEdicao();
                atualizarPersonagensEdicaoSelecionados();
                
                showPage('editar_evento');
            }
        }

        function excluirEvento(id) {
            if (confirm('Tem certeza que deseja excluir este evento?')) {
                eventos = eventos.filter(e => e.id !== id);
                localStorage.setItem('eventos', JSON.stringify(eventos));
                carregarTodosEventos();
            }
        }

        function gerarContrato(id) {
            alert('Fun√ß√£o de gerar contrato em desenvolvimento');
        }

        // Fun√ß√µes de Manuten√ß√£o
        function carregarPersonagensManutencao() {
            const select = document.getElementById('personagem_manutencao');
            select.innerHTML = '<option value="">Selecione um personagem</option>';
            personagens.forEach(p => {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = p.personagem;
                select.appendChild(option);
            });
        }

        function adicionarItem() {
            const tipoItem = document.getElementById('tipo_item').value.trim();
            
            if (!tipoItem) {
                alert('Digite o tipo de item!');
                return;
            }
            
            const item = {
                id: Date.now(),
                tipo: tipoItem,
                responsavel: '',
                informacoes: ''
            };
            
            itensManutencaoSelecionados.push(item);
            atualizarItensManutencao();
            document.getElementById('tipo_item').value = '';
        }

        function atualizarItensManutencao() {
            const div = document.getElementById('itensManutencao');
            
            if (itensManutencaoSelecionados.length === 0) {
                div.innerHTML = '<p style="color: #666;">Nenhum item adicionado</p>';
                return;
            }
            
            div.innerHTML = '';
            itensManutencaoSelecionados.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.style.cssText = 'display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 1rem; align-items: end; padding: 1rem; background: #f8f9fa; border-radius: 10px; margin-bottom: 1rem; border: 2px solid #DEB887;';
                itemDiv.innerHTML = `
                    <div>
                        <strong>Tipo:</strong> ${item.tipo}
                    </div>
                    <div class="form-group">
                        <label>Respons√°vel:</label>
                        <select onchange="alterarResponsavel(${index}, this.value)" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                            <option value="">Selecione</option>
                            <option value="Ed Monteiro" ${item.responsavel === 'Ed Monteiro' ? 'selected' : ''}>Ed Monteiro</option>
                            <option value="Atila" ${item.responsavel === 'Atila' ? 'selected' : ''}>Atila</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Informa√ß√µes:</label>
                        <textarea onchange="alterarInformacoes(${index}, this.value)" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px; resize: vertical; min-height: 60px;" placeholder="Qual manuten√ß√£o ser√° feita...">${item.informacoes}</textarea>
                    </div>
                    <button onclick="removerItem(${index})" style="background: #dc3545; color: white; border: none; padding: 0.5rem; border-radius: 5px; cursor: pointer;">üóëÔ∏è</button>
                `;
                div.appendChild(itemDiv);
            });
        }

        function alterarResponsavel(index, responsavel) {
            itensManutencaoSelecionados[index].responsavel = responsavel;
        }

        function alterarInformacoes(index, informacoes) {
            itensManutencaoSelecionados[index].informacoes = informacoes;
        }

        function removerItem(index) {
            itensManutencaoSelecionados.splice(index, 1);
            atualizarItensManutencao();
        }

        function salvarManutencao(manutencao) {
            manutencoes.push(manutencao);
            localStorage.setItem('manutencoes', JSON.stringify(manutencoes));
            
            document.getElementById('manutencaoSuccess').style.display = 'block';
            document.getElementById('manutencaoSuccess').textContent = '‚úÖ Manuten√ß√£o cadastrada com sucesso!';
            document.getElementById('manutencaoForm').reset();
            document.getElementById('data_registro').value = new Date().toISOString().split('T')[0];
            itensManutencaoSelecionados = [];
            atualizarItensManutencao();
        }

        function carregarManutencoes() {
            const lista = document.getElementById('listaManutencoes');
            if (manutencoes.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhuma manuten√ß√£o cadastrada</p>';
                return;
            }
            
            lista.innerHTML = '';
            manutencoes.forEach(m => {
                const personagem = personagens.find(p => p.id == m.personagem_id);
                
                let corStatus = '#6c757d';
                let textoStatus = 'Pendente';
                if (m.status === 'em_andamento') {
                    corStatus = '#ffc107';
                    textoStatus = 'Em Andamento';
                } else if (m.status === 'realizado') {
                    corStatus = '#28a745';
                    textoStatus = 'Realizado';
                }
                
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 10px; border: 2px solid #DEB887;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                        <h4 style="color: #8B4513; margin: 0;">üîß Manuten√ß√£o #${m.id}</h4>
                        <span style="background: ${corStatus}; color: ${m.status === 'em_andamento' ? 'black' : 'white'}; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">
                            ${textoStatus}
                        </span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <p><strong>Data de Registro:</strong> ${new Date(m.data_registro).toLocaleDateString('pt-BR')}</p>
                            <p><strong>Personagem:</strong> ${personagem ? personagem.personagem : 'Personagem n√£o encontrado'}</p>
                        </div>
                        <div>
                            ${m.data_finalizacao ? `<p><strong>Data de Finaliza√ß√£o:</strong> ${new Date(m.data_finalizacao).toLocaleDateString('pt-BR')}</p>` : ''}
                            <p><strong>Total de Itens:</strong> ${m.itens.length}</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem; padding: 1rem; background: #e9ecef; border-radius: 8px;">
                        <h5 style="color: #666; margin-bottom: 0.5rem;">Itens para Manuten√ß√£o:</h5>
                        ${m.itens.map(item => `
                            <div style="margin-bottom: 0.5rem; padding: 0.5rem; background: white; border-radius: 5px;">
                                <strong>${item.tipo}</strong> - Respons√°vel: ${item.responsavel || 'N√£o definido'}
                                ${item.informacoes ? `<br><small>Informa√ß√µes: ${item.informacoes}</small>` : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    ${m.informacoes_realizadas ? `
                        <div style="margin-bottom: 1rem; padding: 1rem; background: #d4edda; border-radius: 8px;">
                            <h5 style="color: #155724; margin-bottom: 0.5rem;">Informa√ß√µes Realizadas:</h5>
                            <p style="margin: 0;">${m.informacoes_realizadas}</p>
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="realizarManutencao(${m.id})" style="background: #007bff; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 5px; cursor: pointer;">üîß Realizar Manuten√ß√£o</button>
                        <button onclick="excluirManutencao(${m.id})" style="background: #dc3545; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 5px; cursor: pointer;">üóëÔ∏è Excluir</button>
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function realizarManutencao(id) {
            const manutencao = manutencoes.find(m => m.id === id);
            if (!manutencao) return;
            
            const personagem = personagens.find(p => p.id == manutencao.personagem_id);
            
            document.getElementById('dadosManutencao').innerHTML = `
                <h4 style="color: #8B4513; margin-bottom: 1rem;">Dados da Manuten√ß√£o #${manutencao.id}</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <p><strong>Data de Registro:</strong> ${new Date(manutencao.data_registro).toLocaleDateString('pt-BR')}</p>
                        <p><strong>Personagem:</strong> ${personagem ? personagem.personagem : 'N√£o encontrado'}</p>
                    </div>
                    <div>
                        <p><strong>Status Atual:</strong> ${manutencao.status}</p>
                        <p><strong>Total de Itens:</strong> ${manutencao.itens.length}</p>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding: 1rem; background: #e9ecef; border-radius: 8px;">
                    <h5>Itens:</h5>
                    ${manutencao.itens.map(item => `
                        <div style="margin-bottom: 0.5rem;">
                            <strong>${item.tipo}</strong> - ${item.responsavel || 'Sem respons√°vel'}
                            ${item.informacoes ? `<br><small>${item.informacoes}</small>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('manutencao_id').value = id;
            document.getElementById('status_manutencao').value = manutencao.status;
            document.getElementById('informacoes_realizadas').value = manutencao.informacoes_realizadas || '';
            
            showPage('realizar_manutencao');
        }

        function atualizarManutencao(id, status, informacoes) {
            const manutencao = manutencoes.find(m => m.id === id);
            if (manutencao) {
                manutencao.status = status;
                manutencao.informacoes_realizadas = informacoes;
                
                if (status === 'realizado' && !manutencao.data_finalizacao) {
                    manutencao.data_finalizacao = new Date().toISOString();
                }
                
                localStorage.setItem('manutencoes', JSON.stringify(manutencoes));
                
                document.getElementById('realizarManutencaoSuccess').style.display = 'block';
                document.getElementById('realizarManutencaoSuccess').textContent = '‚úÖ Manuten√ß√£o atualizada com sucesso!';
                
                setTimeout(() => {
                    showPage('lista_manutencao');
                }, 1500);
            }
        }

        function excluirManutencao(id) {
            if (confirm('Tem certeza que deseja excluir esta manuten√ß√£o?')) {
                manutencoes = manutencoes.filter(m => m.id !== id);
                localStorage.setItem('manutencoes', JSON.stringify(manutencoes));
                carregarManutencoes();
            }
        }

        // Fun√ß√µes Financeiras
        function calcularTotalAReceber() {
            let total = 0;
            eventos.forEach(evento => {
                if (!evento.sinal_pago) {
                    total += parseFloat(evento.valor_sinal || 0);
                }
                if (!evento.pagamento_total_pago) {
                    total += parseFloat(evento.valor_falta_receber || 0);
                }
            });
            return total;
        }

        function carregarPagamentosReceber() {
            let totalSinaisPendentes = 0;
            let totalValoresRestantes = 0;
            
            const eventosReceber = eventos.filter(e => !e.sinal_pago || !e.pagamento_total_pago);
            
            eventos.forEach(evento => {
                if (!evento.sinal_pago) {
                    totalSinaisPendentes += parseFloat(evento.valor_sinal || 0);
                }
                if (!evento.pagamento_total_pago) {
                    totalValoresRestantes += parseFloat(evento.valor_falta_receber || 0);
                }
            });
            
            const totalAReceber = totalSinaisPendentes + totalValoresRestantes;
            
            document.getElementById('totalSinaisPendentes').textContent = `R$ ${totalSinaisPendentes.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalValoresRestantes').textContent = `R$ ${totalValoresRestantes.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalAReceber').textContent = `R$ ${totalAReceber.toFixed(2).replace('.', ',')}`;
            
            const lista = document.getElementById('listaEventosReceber');
            if (eventosReceber.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum pagamento pendente</p>';
                return;
            }
            
            lista.innerHTML = '';
            eventosReceber.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 10px; border: 2px solid #dc3545;';
                card.innerHTML = `
                    <h4 style="color: #8B4513; margin-bottom: 1rem;">üíµ Evento - ${new Date(evento.data_evento).toLocaleDateString('pt-BR')}</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <p><strong>Cliente:</strong> ${cliente ? cliente.nome_cliente : 'N√£o encontrado'}</p>
                            <p><strong>Aniversariante:</strong> ${cliente ? cliente.nome_aniversariante : 'N/A'}</p>
                        </div>
                        <div>
                            <p><strong>Sinal Pendente:</strong> ${!evento.sinal_pago ? `R$ ${parseFloat(evento.valor_sinal || 0).toFixed(2).replace('.', ',')}` : 'Pago'}</p>
                            <p><strong>Restante Pendente:</strong> ${!evento.pagamento_total_pago ? `R$ ${parseFloat(evento.valor_falta_receber || 0).toFixed(2).replace('.', ',')}` : 'Pago'}</p>
                        </div>
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function carregarPagamentosPagos() {
            let totalSinaisPagos = 0;
            let totalDeslocamentos = 0;
            let totalValoresPagos = 0;
            let totalDescontos = 0;
            
            eventos.forEach(evento => {
                if (evento.sinal_pago) {
                    totalSinaisPagos += parseFloat(evento.valor_sinal || 0);
                }
                totalDeslocamentos += parseFloat(evento.deslocamento || 0);
                totalDescontos += parseFloat(evento.desconto || 0);
                if (evento.pagamento_total_pago) {
                    totalValoresPagos += parseFloat(evento.valor_total || 0);
                }
            });
            
            document.getElementById('totalSinaisPagos').textContent = `R$ ${totalSinaisPagos.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalDeslocamentos').textContent = `R$ ${totalDeslocamentos.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalValoresPagos').textContent = `R$ ${totalValoresPagos.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalDescontos').textContent = `R$ ${totalDescontos.toFixed(2).replace('.', ',')}`;
            
            const eventosPagos = eventos.filter(e => e.sinal_pago || e.pagamento_total_pago);
            
            const lista = document.getElementById('listaEventosPagos');
            if (eventosPagos.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum pagamento realizado</p>';
                return;
            }
            
            lista.innerHTML = '';
            eventosPagos.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 10px; border: 2px solid #28a745;';
                card.innerHTML = `
                    <h4 style="color: #8B4513; margin-bottom: 1rem;">‚úÖ Evento - ${new Date(evento.data_evento).toLocaleDateString('pt-BR')}</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <p><strong>Cliente:</strong> ${cliente ? cliente.nome_cliente : 'N√£o encontrado'}</p>
                            <p><strong>Sinal:</strong> ${evento.sinal_pago ? `R$ ${parseFloat(evento.valor_sinal || 0).toFixed(2).replace('.', ',')}` : 'Pendente'}</p>
                        </div>
                        <div>
                            <p><strong>Total Pago:</strong> ${evento.pagamento_total_pago ? `R$ ${parseFloat(evento.valor_total || 0).toFixed(2).replace('.', ',')}` : 'Pendente'}</p>
                            <p><strong>Deslocamento:</strong> R$ ${parseFloat(evento.deslocamento || 0).toFixed(2).replace('.', ',')}</p>
                        </div>
                    </div>
                `;
                lista.appendChild(card);
            });
        }

        function gerarFechamento() {
            const mesAno = document.getElementById('mesAno').value;
            if (!mesAno) {
                alert('Selecione um m√™s/ano!');
                return;
            }
            
            const [ano, mes] = mesAno.split('-');
            const diasNoMes = new Date(ano, mes, 0).getDate();
            const dataInicio = new Date(ano, mes - 1, 1);
            const dataFim = new Date(ano, mes - 1, diasNoMes);
            
            const eventosMes = eventos.filter(evento => {
                const dataEvento = new Date(evento.data_evento);
                return dataEvento >= dataInicio && dataEvento <= dataFim;
            });
            
            let totalRecebido = 0;
            let totalPendente = 0;
            let totalDeslocamentos = 0;
            let totalDescontos = 0;
            
            eventosMes.forEach(evento => {
                if (evento.sinal_pago) {
                    totalRecebido += parseFloat(evento.valor_sinal || 0);
                }
                if (evento.pagamento_total_pago) {
                    totalRecebido += parseFloat(evento.valor_total || 0) - parseFloat(evento.valor_sinal || 0);
                } else {
                    totalPendente += parseFloat(evento.valor_falta_receber || 0);
                }
                if (!evento.sinal_pago) {
                    totalPendente += parseFloat(evento.valor_sinal || 0);
                }
                totalDeslocamentos += parseFloat(evento.deslocamento || 0);
                totalDescontos += parseFloat(evento.desconto || 0);
            });
            
            const resultado = document.getElementById('resultadoFechamento');
            resultado.innerHTML = `
                <div style="background: #f8f9fa; padding: 2rem; border-radius: 10px; border: 2px solid #DEB887;">
                    <h3 style="color: #8B4513; text-align: center; margin-bottom: 2rem;">Fechamento de ${mes}/${ano} (${diasNoMes} dias)</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div style="background: #28a745; color: white; padding: 1rem; border-radius: 8px; text-align: center;">
                            <h4>Total Recebido</h4>
                            <div style="font-size: 1.5rem; font-weight: bold;">R$ ${totalRecebido.toFixed(2).replace('.', ',')}</div>
                        </div>
                        <div style="background: #dc3545; color: white; padding: 1rem; border-radius: 8px; text-align: center;">
                            <h4>Total Pendente</h4>
                            <div style="font-size: 1.5rem; font-weight: bold;">R$ ${totalPendente.toFixed(2).replace('.', ',')}</div>
                        </div>
                        <div style="background: #007bff; color: white; padding: 1rem; border-radius: 8px; text-align: center;">
                            <h4>Deslocamentos</h4>
                            <div style="font-size: 1.5rem; font-weight: bold;">R$ ${totalDeslocamentos.toFixed(2).replace('.', ',')}</div>
                        </div>
                        <div style="background: #ffc107; color: black; padding: 1rem; border-radius: 8px; text-align: center;">
                            <h4>Descontos</h4>
                            <div style="font-size: 1.5rem; font-weight: bold;">R$ ${totalDescontos.toFixed(2).replace('.', ',')}</div>
                        </div>
                    </div>
                    
                    <div style="background: #e9ecef; padding: 1rem; border-radius: 8px;">
                        <h4>Resumo do M√™s:</h4>
                        <p><strong>Total de Eventos:</strong> ${eventosMes.length}</p>
                        <p><strong>Receita L√≠quida:</strong> R$ ${(totalRecebido - totalDescontos + totalDeslocamentos).toFixed(2).replace('.', ',')}</p>
                        <p><strong>Per√≠odo:</strong> 01/${mes}/${ano} a ${diasNoMes}/${mes}/${ano}</p>
                    </div>
                </div>
            `;
        }

        function carregarCaches() {
            const mesAno = document.getElementById('mesAnoCaches').value;
            if (!mesAno) {
                alert('Selecione um m√™s/ano!');
                return;
            }
            
            const [ano, mes] = mesAno.split('-');
            const dataInicio = new Date(ano, mes - 1, 1);
            const dataFim = new Date(ano, mes - 1, new Date(ano, mes, 0).getDate());
            
            const eventosMes = eventos.filter(evento => {
                const dataEvento = new Date(evento.data_evento);
                return dataEvento >= dataInicio && dataEvento <= dataFim;
            });
            
            const cachesElenco = {};
            const cachesMotoristas = {};
            
            // Carregar status salvos
            const statusSalvos = JSON.parse(localStorage.getItem('statusCaches')) || {};
            
            eventosMes.forEach(evento => {
                if (evento.personagens) {
                    evento.personagens.forEach(p => {
                        const valorCache = parseFloat(p.valor || 0) * parseInt(p.quantidade_evento || 1) * 0.3;
                        
                        elenco.forEach(membro => {
                            if (membro.perfil && membro.perfil.includes('CARA LIMPA')) {
                                if (!cachesElenco[membro.id]) {
                                    cachesElenco[membro.id] = {
                                        nome: membro.nome_completo,
                                        eventos: [],
                                        total: 0,
                                        status: statusSalvos[`elenco_${membro.id}_${mesAno}`] || 'falta_pagar'
                                    };
                                }
                                cachesElenco[membro.id].eventos.push({
                                    data: evento.data_evento,
                                    valor: valorCache,
                                    personagem: p.personagem
                                });
                                cachesElenco[membro.id].total += valorCache;
                            }
                        });
                        
                        motoristas.forEach(motorista => {
                            if (motorista.perfil && motorista.perfil.includes('DRIVE')) {
                                if (!cachesMotoristas[motorista.id]) {
                                    cachesMotoristas[motorista.id] = {
                                        nome: motorista.nome_completo,
                                        eventos: [],
                                        total: 0,
                                        status: statusSalvos[`motorista_${motorista.id}_${mesAno}`] || 'falta_pagar'
                                    };
                                }
                                const valorDrive = parseFloat(evento.deslocamento || 0) * 0.5;
                                cachesMotoristas[motorista.id].eventos.push({
                                    data: evento.data_evento,
                                    valor: valorDrive,
                                    tipo: 'Deslocamento'
                                });
                                cachesMotoristas[motorista.id].total += valorDrive;
                            }
                        });
                    });
                }
            });
            
            cachesData = { elenco: cachesElenco, motoristas: cachesMotoristas, mesAno };
            atualizarTotaisCaches();
            mostrarTipo(tipoVisualizacao);
        }

        function atualizarTotaisCaches() {
            let totalPago = 0;
            let totalAPagar = 0;
            
            Object.values(cachesData.elenco || {}).forEach(cache => {
                if (cache.status === 'pago') totalPago += cache.total;
                else totalAPagar += cache.total;
            });
            
            Object.values(cachesData.motoristas || {}).forEach(cache => {
                if (cache.status === 'pago') totalPago += cache.total;
                else totalAPagar += cache.total;
            });
            
            document.getElementById('totalCachesPagos').textContent = `R$ ${totalPago.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalCachesAPagar').textContent = `R$ ${totalAPagar.toFixed(2).replace('.', ',')}`;
        }

        function mostrarTipo(tipo) {
            tipoVisualizacao = tipo;
            
            document.getElementById('btnElenco').style.background = tipo === 'elenco' ? '#28a745' : '#6f42c1';
            document.getElementById('btnDrive').style.background = tipo === 'drive' ? '#28a745' : '#fd7e14';
            document.getElementById('btnTodos').style.background = tipo === 'todos' ? '#28a745' : '#007bff';
            
            const lista = document.getElementById('listaCaches');
            lista.innerHTML = '';
            
            if (!cachesData.elenco && !cachesData.motoristas) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Carregue os cach√™s primeiro</p>';
                return;
            }
            
            if (tipo === 'elenco' || tipo === 'todos') {
                Object.entries(cachesData.elenco || {}).forEach(([id, cache]) => {
                    criarCardCache('elenco', id, cache, 'üé≠');
                });
            }
            
            if (tipo === 'drive' || tipo === 'todos') {
                Object.entries(cachesData.motoristas || {}).forEach(([id, cache]) => {
                    criarCardCache('motorista', id, cache, 'üöó');
                });
            }
        }

        function criarCardCache(tipo, id, cache, icone) {
            const lista = document.getElementById('listaCaches');
            const card = document.createElement('div');
            card.style.cssText = `background: #f8f9fa; padding: 1rem; margin-bottom: 0.5rem; border-radius: 8px; border: 2px solid ${cache.status === 'pago' ? '#28a745' : '#dc3545'};`;
            card.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <h5 style="color: #8B4513; margin: 0; font-size: 1rem;">${icone} ${cache.nome}</h5>
                    <span style="background: ${cache.status === 'pago' ? '#28a745' : '#dc3545'}; color: white; padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.7rem;">
                        ${cache.status === 'pago' ? 'Pago' : 'Falta Pagar'}
                    </span>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                    <span><strong>Total:</strong> R$ ${cache.total.toFixed(2).replace('.', ',')}</span>
                    <span><strong>Eventos:</strong> ${cache.eventos.length}</span>
                </div>
                
                <button onclick="abrirInformacoesPagamento('${tipo}', ${id})" style="background: #007bff; color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-size: 0.8rem; width: 100%;">
                    üíµ Informa√ß√µes de Pagamento
                </button>
            `;
            lista.appendChild(card);
        }

        function abrirInformacoesPagamento(tipo, id) {
            const cache = tipo === 'elenco' ? cachesData.elenco[id] : cachesData.motoristas[id];
            
            document.getElementById('dadosPagamento').innerHTML = `
                <h4 style="color: #8B4513; margin-bottom: 1rem;">${tipo === 'elenco' ? 'üé≠' : 'üöó'} ${cache.nome}</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <p><strong>Total do M√™s:</strong> R$ ${cache.total.toFixed(2).replace('.', ',')}</p>
                        <p><strong>Eventos:</strong> ${cache.eventos.length}</p>
                    </div>
                    <div>
                        <p><strong>Status Atual:</strong> ${cache.status === 'pago' ? 'Pago' : 'Falta Pagar'}</p>
                        <p><strong>Tipo:</strong> ${tipo === 'elenco' ? 'Elenco' : 'Motorista'}</p>
                    </div>
                </div>
                <div style="background: #e9ecef; padding: 1rem; border-radius: 8px; max-height: 200px; overflow-y: auto;">
                    <h5>Eventos do M√™s:</h5>
                    ${cache.eventos.map(evento => `
                        <div style="margin-bottom: 0.3rem; padding: 0.3rem; background: white; border-radius: 3px; font-size: 0.8rem;">
                            ${new Date(evento.data).toLocaleDateString('pt-BR')} - ${evento.personagem || evento.tipo} - R$ ${evento.valor.toFixed(2).replace('.', ',')}
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('pagamento_tipo').value = tipo;
            document.getElementById('pagamento_id').value = id;
            document.getElementById('status_pagamento').value = cache.status;
            
            showPage('informacoes_pagamento');
        }

        function salvarStatusPagamento(tipo, id, status) {
            const statusSalvos = JSON.parse(localStorage.getItem('statusCaches')) || {};
            const chave = `${tipo}_${id}_${cachesData.mesAno}`;
            statusSalvos[chave] = status;
            localStorage.setItem('statusCaches', JSON.stringify(statusSalvos));
            
            if (tipo === 'elenco' && cachesData.elenco[id]) {
                cachesData.elenco[id].status = status;
            } else if (tipo === 'motorista' && cachesData.motoristas[id]) {
                cachesData.motoristas[id].status = status;
            }
            
            atualizarTotaisCaches();
            alert('‚úÖ Status atualizado com sucesso!');
            showPage('pagamento_caches');
            mostrarTipo(tipoVisualizacao);
        }

        // Fun√ß√µes para edi√ß√£o de eventos
        function carregarPersonagensSelectEdicao() {
            const select = document.getElementById('edit_personagem_select');
            select.innerHTML = '<option value="">Escolha um personagem</option>';
            personagens.forEach(p => {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = `${p.personagem} - R$ ${parseFloat(p.valor).toFixed(2).replace('.', ',')}`;
                select.appendChild(option);
            });
        }

        function adicionarPersonagemEdicao() {
            const select = document.getElementById('edit_personagem_select');
            const personagemId = select.value;
            
            if (!personagemId) {
                alert('Selecione um personagem!');
                return;
            }
            
            const personagem = personagens.find(p => p.id == personagemId);
            if (!personagem) return;
            
            if (personagensEdicaoSelecionados.find(p => p.id == personagemId)) {
                alert('Personagem j√° foi adicionado!');
                return;
            }
            
            personagensEdicaoSelecionados.push({
                ...personagem,
                quantidade_evento: 1
            });
            
            atualizarPersonagensEdicaoSelecionados();
            select.value = '';
        }

        function atualizarPersonagensEdicaoSelecionados() {
            const div = document.getElementById('edit_personagensSelecionados');
            
            if (personagensEdicaoSelecionados.length === 0) {
                div.innerHTML = '<p style="color: #666;">Nenhum personagem selecionado</p>';
                calcularValorTotalEdicao();
                return;
            }
            
            div.innerHTML = '';
            personagensEdicaoSelecionados.forEach((p, index) => {
                const personagemDiv = document.createElement('div');
                personagemDiv.style.cssText = 'display: flex; align-items: center; gap: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 10px; margin-bottom: 1rem; border: 2px solid #DEB887;';
                personagemDiv.innerHTML = `
                    <div style="flex: 1;">
                        <strong>${p.personagem}</strong> - R$ ${parseFloat(p.valor).toFixed(2).replace('.', ',')}
                        <br><small>${p.figurino || 'Sem figurino'} | ${p.tema || 'Sem tema'}</small>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <label>Qtd:</label>
                        <input type="number" value="${p.quantidade_evento}" min="1" max="${p.quantidade}" style="width: 60px;" onchange="alterarQuantidadePersonagemEdicao(${index}, this.value)">
                    </div>
                    <button onclick="removerPersonagemEdicao(${index})" style="background: #dc3545; color: white; border: none; padding: 0.5rem; border-radius: 5px; cursor: pointer;">üóëÔ∏è</button>
                `;
                div.appendChild(personagemDiv);
            });
            
            calcularValorTotalEdicao();
        }

        function alterarQuantidadePersonagemEdicao(index, quantidade) {
            personagensEdicaoSelecionados[index].quantidade_evento = parseInt(quantidade);
            calcularValorTotalEdicao();
        }

        function removerPersonagemEdicao(index) {
            personagensEdicaoSelecionados.splice(index, 1);
            atualizarPersonagensEdicaoSelecionados();
        }

        function calcularValorTotalEdicao() {
            let total = 0;
            personagensEdicaoSelecionados.forEach(p => {
                total += parseFloat(p.valor) * parseInt(p.quantidade_evento);
            });
            
            const desconto = parseFloat(removerFormatacaoMoeda(document.getElementById('edit_desconto').value)) || 0;
            const deslocamento = parseFloat(removerFormatacaoMoeda(document.getElementById('edit_deslocamento').value)) || 0;
            
            total = total - desconto + deslocamento;
            
            document.getElementById('edit_valor_total').value = `R$ ${total.toFixed(2).replace('.', ',')}`;
        }

        // Fun√ß√µes para CPF/CNPJ
        let tipoDocumento = 'cpf';
        let tipoDocumentoEdicao = 'cpf';
        let tipoDocumentoEvento = 'cpf';
        let tipoDocumentoEventoEdicao = 'cpf';

        function selecionarTipoDoc(tipo) {
            tipoDocumento = tipo;
            const btnCpf = document.getElementById('btn_cpf');
            const btnCnpj = document.getElementById('btn_cnpj');
            const input = document.getElementById('cpf_cliente');
            const campoEmpresa = document.getElementById('campo_nome_empresa');
            const labelData = document.getElementById('label_data_nascimento');
            
            if (tipo === 'cpf') {
                btnCpf.style.background = '#28a745';
                btnCnpj.style.background = '#6c757d';
                input.placeholder = '000.000.000-00';
                input.maxLength = 14;
                campoEmpresa.style.display = 'none';
                labelData.textContent = 'üìÖ Data de Nascimento:';
            } else {
                btnCpf.style.background = '#6c757d';
                btnCnpj.style.background = '#28a745';
                input.placeholder = '00.000.000/0000-00';
                input.maxLength = 18;
                campoEmpresa.style.display = 'block';
                labelData.textContent = 'üìÖ Data de Abertura do CNPJ:';
            }
            input.value = '';
        }

        function selecionarTipoDocEdicao(tipo) {
            tipoDocumentoEdicao = tipo;
            const btnCpf = document.getElementById('edit_btn_cpf');
            const btnCnpj = document.getElementById('edit_btn_cnpj');
            const input = document.getElementById('edit_cpf_cliente');
            const campoEmpresa = document.getElementById('edit_campo_nome_empresa');
            const labelData = document.getElementById('edit_label_data_nascimento');
            
            if (tipo === 'cpf') {
                btnCpf.style.background = '#28a745';
                btnCnpj.style.background = '#6c757d';
                input.placeholder = '000.000.000-00';
                input.maxLength = 14;
                campoEmpresa.style.display = 'none';
                labelData.textContent = 'üìÖ Data de Nascimento:';
            } else {
                btnCpf.style.background = '#6c757d';
                btnCnpj.style.background = '#28a745';
                input.placeholder = '00.000.000/0000-00';
                input.maxLength = 18;
                campoEmpresa.style.display = 'block';
                labelData.textContent = 'üìÖ Data de Abertura do CNPJ:';
            }
        }

        function selecionarTipoDocEvento(tipo) {
            tipoDocumentoEvento = tipo;
            const btnCpf = document.getElementById('btn_cpf_evento');
            const btnCnpj = document.getElementById('btn_cnpj_evento');
            const input = document.getElementById('cpf_evento');
            const campoEmpresa = document.getElementById('campo_nome_empresa_evento');
            
            if (tipo === 'cpf') {
                btnCpf.style.background = '#28a745';
                btnCnpj.style.background = '#6c757d';
                input.placeholder = '000.000.000-00';
                input.maxLength = 14;
                campoEmpresa.style.display = 'none';
            } else {
                btnCpf.style.background = '#6c757d';
                btnCnpj.style.background = '#28a745';
                input.placeholder = '00.000.000/0000-00';
                input.maxLength = 18;
                campoEmpresa.style.display = 'block';
            }
            input.value = '';
        }

        function selecionarTipoDocEventoEdicao(tipo) {
            tipoDocumentoEventoEdicao = tipo;
            const btnCpf = document.getElementById('edit_btn_cpf_evento');
            const btnCnpj = document.getElementById('edit_btn_cnpj_evento');
            const input = document.getElementById('edit_cpf_evento');
            const campoEmpresa = document.getElementById('edit_campo_nome_empresa_evento');
            
            if (tipo === 'cpf') {
                btnCpf.style.background = '#28a745';
                btnCnpj.style.background = '#6c757d';
                input.placeholder = '000.000.000-00';
                input.maxLength = 14;
                campoEmpresa.style.display = 'none';
            } else {
                btnCpf.style.background = '#6c757d';
                btnCnpj.style.background = '#28a745';
                input.placeholder = '00.000.000/0000-00';
                input.maxLength = 18;
                campoEmpresa.style.display = 'block';
            }
        }

        function formatarCPF(valor) {
            valor = valor.replace(/\D/g, '');
            valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
            valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
            valor = valor.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            return valor;
        }

        function formatarCNPJ(valor) {
            valor = valor.replace(/\D/g, '');
            valor = valor.replace(/(\d{2})(\d)/, '$1.$2');
            valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
            valor = valor.replace(/(\d{3})(\d)/, '$1/$2');
            valor = valor.replace(/(\d{4})(\d{1,2})$/, '$1-$2');
            return valor;
        }

        function formatarMoeda(valor) {
            valor = valor.replace(/\D/g, '');
            valor = (parseFloat(valor) / 100).toFixed(2);
            valor = valor.replace('.', ',');
            valor = valor.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            return 'R$ ' + valor;
        }

        function removerFormatacaoMoeda(valor) {
            return valor.replace(/[R$\s\.]/g, '').replace(',', '.');
        }

        // Fun√ß√µes de Escala√ß√£o
        function escalarEvento(id) {
            const evento = eventos.find(e => e.id === id);
            if (!evento) return;
            
            const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
            
            document.getElementById('dadosEventoEscala').innerHTML = `
                <h4 style="color: #8B4513; margin-bottom: 1rem;">Evento - ${new Date(evento.data_evento).toLocaleDateString('pt-BR')} √†s ${evento.hora_entrada}</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <p><strong>Cliente:</strong> ${cliente ? cliente.nome_cliente : 'N√£o encontrado'}</p>
                        <p><strong>Aniversariante:</strong> ${cliente ? cliente.nome_aniversariante : 'N/A'}</p>
                    </div>
                    <div>
                        <p><strong>Dura√ß√£o:</strong> ${evento.duracao}h</p>
                        <p><strong>Valor:</strong> R$ ${parseFloat(evento.valor_total || 0).toFixed(2).replace('.', ',')}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('escala_evento_id').value = id;
            carregarPersonagensEscala(evento);
            carregarMotoristasEscala();
            motoristasEscalaSelecionados = escalacoesEventos[id]?.motoristas || [];
            atualizarMotoristasEscala();
            
            showPage('escalar_evento');
        }

        function carregarPersonagensEscala(evento) {
            const div = document.getElementById('personagensEscala');
            
            if (!evento.personagens || evento.personagens.length === 0) {
                div.innerHTML = '<p style="color: #666;">Nenhum personagem no evento</p>';
                return;
            }
            
            div.innerHTML = '';
            evento.personagens.forEach((personagem, index) => {
                const personagemDiv = document.createElement('div');
                personagemDiv.style.cssText = 'display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 10px; margin-bottom: 1rem; border: 2px solid #DEB887;';
                
                const escalacaoAtual = escalacoesEventos[evento.id]?.personagens?.[personagem.id] || [];
                
                personagemDiv.innerHTML = `
                    <div>
                        <h5 style="color: #8B4513; margin-bottom: 0.5rem;">${personagem.personagem}</h5>
                        <p><strong>Quantidade:</strong> ${personagem.quantidade_evento}x</p>
                        <p><strong>Figurino:</strong> ${personagem.figurino || 'N/A'}</p>
                        <p><strong>Tema:</strong> ${personagem.tema || 'N/A'}</p>
                    </div>
                    <div>
                        <label style="font-weight: bold; margin-bottom: 0.5rem; display: block;">Elenco Escalado:</label>
                        <div id="elenco_${personagem.id}" style="margin-bottom: 1rem;"></div>
                        <div style="display: flex; gap: 0.5rem;">
                            <select id="select_elenco_${personagem.id}" style="flex: 1; padding: 0.5rem; border: 1px solid #ddd; border-radius: 5px;">
                                <option value="">Selecione um membro do elenco</option>
                            </select>
                            <button type="button" onclick="adicionarElencoPersonagem('${personagem.id}')" style="background: #28a745; color: white; border: none; padding: 0.5rem; border-radius: 5px; cursor: pointer;">+</button>
                        </div>
                    </div>
                `;
                
                div.appendChild(personagemDiv);
                
                // Carregar op√ß√µes de elenco
                const selectElenco = document.getElementById(`select_elenco_${personagem.id}`);
                elenco.forEach(e => {
                    const option = document.createElement('option');
                    option.value = e.id;
                    option.textContent = `${e.nome_completo} (${e.perfil})`;
                    selectElenco.appendChild(option);
                });
                
                // Mostrar elenco j√° escalado
                atualizarElencoPersonagem(personagem.id, escalacaoAtual);
            });
        }

        function atualizarElencoPersonagem(personagemId, elencoEscalado) {
            const div = document.getElementById(`elenco_${personagemId}`);
            
            if (elencoEscalado.length === 0) {
                div.innerHTML = '<p style="color: #999; font-size: 0.9rem;">Nenhum elenco escalado</p>';
                return;
            }
            
            div.innerHTML = '';
            elencoEscalado.forEach((elencoId, index) => {
                const membro = elenco.find(e => e.id == elencoId);
                if (membro) {
                    const elencoDiv = document.createElement('div');
                    elencoDiv.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 0.3rem 0.5rem; background: #e9ecef; border-radius: 5px; margin-bottom: 0.3rem; font-size: 0.9rem;';
                    elencoDiv.innerHTML = `
                        <span>${membro.nome_completo}</span>
                        <button onclick="removerElencoPersonagem('${personagemId}', ${index})" style="background: #dc3545; color: white; border: none; padding: 0.2rem 0.4rem; border-radius: 3px; cursor: pointer; font-size: 0.8rem;">√ó</button>
                    `;
                    div.appendChild(elencoDiv);
                }
            });
        }

        function adicionarElencoPersonagem(personagemId) {
            const select = document.getElementById(`select_elenco_${personagemId}`);
            const elencoId = select.value;
            
            if (!elencoId) {
                alert('‚ö†Ô∏è Selecione um membro do elenco!');
                return;
            }
            
            const eventoId = parseInt(document.getElementById('escala_evento_id').value);
            
            if (!escalacoesEventos[eventoId]) {
                escalacoesEventos[eventoId] = { personagens: {}, motoristas: [] };
            }
            
            if (!escalacoesEventos[eventoId].personagens[personagemId]) {
                escalacoesEventos[eventoId].personagens[personagemId] = [];
            }
            
            if (escalacoesEventos[eventoId].personagens[personagemId].includes(elencoId)) {
                alert('Este membro j√° foi escalado para este personagem!');
                return;
            }
            
            escalacoesEventos[eventoId].personagens[personagemId].push(elencoId);
            atualizarElencoPersonagem(personagemId, escalacoesEventos[eventoId].personagens[personagemId]);
            select.value = '';
        }

        function removerElencoPersonagem(personagemId, index) {
            const eventoId = parseInt(document.getElementById('escala_evento_id').value);
            
            if (escalacoesEventos[eventoId]?.personagens?.[personagemId]) {
                escalacoesEventos[eventoId].personagens[personagemId].splice(index, 1);
                atualizarElencoPersonagem(personagemId, escalacoesEventos[eventoId].personagens[personagemId]);
            }
        }

        function carregarMotoristasEscala() {
            const select = document.getElementById('motorista_select');
            select.innerHTML = '<option value="">Escolha um motorista</option>';
            motoristas.forEach(m => {
                const option = document.createElement('option');
                option.value = m.id;
                option.textContent = `${m.nome_completo} (${m.modelo_carro})`;
                select.appendChild(option);
            });
        }

        function adicionarMotoristaEscala() {
            const select = document.getElementById('motorista_select');
            const motoristaId = select.value;
            
            if (!motoristaId) {
                alert('‚ö†Ô∏è Selecione um motorista!');
                return;
            }
            
            if (motoristasEscalaSelecionados.includes(motoristaId)) {
                alert('Este motorista j√° foi escalado!');
                return;
            }
            
            motoristasEscalaSelecionados.push(motoristaId);
            atualizarMotoristasEscala();
            select.value = '';
        }

        function atualizarMotoristasEscala() {
            const div = document.getElementById('motoristasEscala');
            
            if (motoristasEscalaSelecionados.length === 0) {
                div.innerHTML = '<p style="color: #999;">Nenhum motorista escalado</p>';
                return;
            }
            
            div.innerHTML = '';
            motoristasEscalaSelecionados.forEach((motoristaId, index) => {
                const motorista = motoristas.find(m => m.id == motoristaId);
                if (motorista) {
                    const motoristaDiv = document.createElement('div');
                    motoristaDiv.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 10px; margin-bottom: 1rem; border: 2px solid #DEB887;';
                    motoristaDiv.innerHTML = `
                        <div>
                            <strong>${motorista.nome_completo}</strong><br>
                            <small>${motorista.modelo_carro} | ${motorista.whatsapp || 'Sem WhatsApp'}</small>
                        </div>
                        <button onclick="removerMotoristaEscala(${index})" style="background: #dc3545; color: white; border: none; padding: 0.5rem; border-radius: 5px; cursor: pointer;">üóëÔ∏è</button>
                    `;
                    div.appendChild(motoristaDiv);
                }
            });
        }

        function removerMotoristaEscala(index) {
            motoristasEscalaSelecionados.splice(index, 1);
            atualizarMotoristasEscala();
        }

        function salvarEscalacao(eventoId) {
            // Verificar se h√° elenco selecionado mas n√£o adicionado
            const evento = eventos.find(e => e.id === eventoId);
            if (evento && evento.personagens) {
                for (let personagem of evento.personagens) {
                    const select = document.getElementById(`select_elenco_${personagem.id}`);
                    if (select && select.value) {
                        alert('‚ö†Ô∏è Clique em ADICIONAR para selecionar o elenco antes de salvar!');
                        return;
                    }
                }
            }
            
            // Verificar se h√° motorista selecionado mas n√£o adicionado
            const selectMotorista = document.getElementById('motorista_select');
            if (selectMotorista && selectMotorista.value) {
                alert('‚ö†Ô∏è Clique em ADICIONAR para selecionar o drive antes de salvar!');
                return;
            }
            
            if (!escalacoesEventos[eventoId]) {
                escalacoesEventos[eventoId] = { personagens: {}, motoristas: [] };
            }
            
            escalacoesEventos[eventoId].motoristas = [...motoristasEscalaSelecionados];
            
            localStorage.setItem('escalacoes', JSON.stringify(escalacoesEventos));
            
            alert('‚úÖ Escala√ß√£o salva com sucesso!');
            showPage('eventos_futuros');
        }

        // Fun√ß√µes auxiliares para escala√ß√£o
        function formatarData(data) {
            return new Date(data).toLocaleDateString('pt-BR');
        }
        
        function obterCorEvento(evento) {
            const agora = new Date();
            const dataEvento = new Date(evento.data_evento + 'T' + evento.hora_entrada + ':00');
            const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
            const [horasSaida, minutosSaida] = horaSaida.split(':').map(Number);
            const dataEventoFim = new Date(evento.data_evento + 'T' + horaSaida + ':00');
            
            // Verificar se o evento j√° foi finalizado (passou da hora de sa√≠da)
            if (dataEventoFim <= agora) {
                return '#6c757d'; // Cinza para eventos finalizados
            }
            
            // Verificar se o evento est√° acontecendo agora (entre hora entrada e sa√≠da)
            if (dataEvento <= agora && agora < dataEventoFim) {
                return '#28a745'; // Verde para evento acontecendo
            }
            
            // Calcular dias restantes baseado na data atual
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            const dataEventoSemHora = new Date(evento.data_evento + 'T00:00:00');
            dataEventoSemHora.setHours(0, 0, 0, 0);
            const diasRestantes = Math.ceil((dataEventoSemHora - hoje) / (1000 * 60 * 60 * 24));
            
            // Prioridade para sinal n√£o pago (roxo)
            if (!evento.sinal_pago) return '#6f42c1';
            
            // Cores baseadas nos dias restantes
            if (diasRestantes === 0) return '#28a745'; // Verde para dia do evento
            if (diasRestantes === 1) return '#dc3545'; // Vermelho para 1 dia
            if (diasRestantes >= 2 && diasRestantes <= 4) return '#ffc107'; // Amarelo para 4-2 dias
            if (diasRestantes >= 5) return '#007bff'; // Azul para mais de 5 dias
            
            return '#007bff'; // Padr√£o azul
        }
        
        function obterStatusEvento(evento) {
            const agora = new Date();
            const dataEvento = new Date(evento.data_evento + 'T' + evento.hora_entrada + ':00');
            const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
            const dataEventoFim = new Date(evento.data_evento + 'T' + horaSaida + ':00');
            
            // Verificar se o evento j√° foi finalizado (passou da hora de sa√≠da)
            if (dataEventoFim <= agora) {
                return '‚ö´ Evento Finalizado';
            }
            
            // Verificar se o evento est√° acontecendo agora
            if (dataEvento <= agora && agora < dataEventoFim) {
                return 'üü¢ Evento Acontecendo';
            }
            
            // Calcular dias restantes baseado na data atual
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            const dataEventoSemHora = new Date(evento.data_evento + 'T00:00:00');
            dataEventoSemHora.setHours(0, 0, 0, 0);
            const diasRestantes = Math.ceil((dataEventoSemHora - hoje) / (1000 * 60 * 60 * 24));
            
            // Prioridade para sinal n√£o pago
            if (!evento.sinal_pago) return 'üü£ Sinal n√£o pago';
            
            // Status baseado nos dias restantes
            if (diasRestantes === 0) return 'üü¢ Dia do evento';
            if (diasRestantes === 1) return 'üî¥ 1 dia';
            if (diasRestantes >= 2 && diasRestantes <= 4) return 'üü° Entre 4 a 2 dias';
            if (diasRestantes >= 5) return 'üîµ Mais de 5 dias';
            
            return 'üîµ Futuro';
        }
        
        function calcularHoraSaidaEvento(horaEntrada, duracao) {
            const [horas, minutos] = horaEntrada.split(':').map(Number);
            const totalMinutos = horas * 60 + minutos + (parseInt(duracao) * 60);
            const horasSaida = Math.floor(totalMinutos / 60) % 24;
            const minutosSaida = totalMinutos % 60;
            return `${horasSaida.toString().padStart(2, '0')}:${minutosSaida.toString().padStart(2, '0')}`;
        }
        
        function abrirEscalacao(eventoId) {
            const evento = eventos.find(e => e.id === eventoId);
            if (!evento) return;
            
            const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
            const casa = casas.find(c => c.id == evento.casa_festa);
            
            // Calcular hora de t√©rmino
            const [horas, minutos] = evento.hora_entrada.split(':').map(Number);
            const totalMinutos = horas * 60 + minutos + (parseInt(evento.duracao) * 60);
            const horasSaida = Math.floor(totalMinutos / 60) % 24;
            const minutosSaida = totalMinutos % 60;
            const horaTermino = `${horasSaida.toString().padStart(2, '0')}:${minutosSaida.toString().padStart(2, '0')}`;
            
            // Preencher dados do evento
            document.getElementById('dadosEventoEscala').innerHTML = `
                <h3 style="color: #8B4513; margin-bottom: 1rem; text-align: center;">üéâ DADOS DO EVENTO</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 1rem;">
                    <div>
                        <h4 style="color: #666; margin-bottom: 0.8rem; border-bottom: 2px solid #DEB887; padding-bottom: 0.3rem;">üë• Cliente</h4>
                        <p><strong>Nome:</strong> ${cliente ? cliente.nome_cliente : 'N/A'}</p>
                        ${evento.nome_empresa_evento ? `<p><strong>Empresa:</strong> ${evento.nome_empresa_evento}</p>` : ''}
                        <p><strong>Telefone:</strong> ${cliente ? cliente.telefone_cliente || 'N/A' : 'N/A'}</p>
                        
                        <h4 style="color: #666; margin: 1rem 0 0.8rem 0; border-bottom: 2px solid #DEB887; padding-bottom: 0.3rem;">üéÇ Anivers√°riante</h4>
                        <p><strong>Nome:</strong> ${cliente ? cliente.nome_aniversariante : 'N/A'}</p>
                        <p><strong>Idade:</strong> ${cliente ? calcularIdade(cliente.data_nascimento_aniversariante) + ' anos' : 'N/A'}</p>
                    </div>
                    <div>
                        <h4 style="color: #666; margin-bottom: 0.8rem; border-bottom: 2px solid #DEB887; padding-bottom: 0.3rem;">üè† Local</h4>
                        <p><strong>Casa:</strong> ${casa ? casa.nome_casa : (evento.outro_local ? 'Outro Local' : 'N/A')}</p>
                        <p><strong>Endere√ßo:</strong> ${casa ? `${casa.logradouro}, ${casa.numero}${casa.complemento ? ', ' + casa.complemento : ''}` : (evento.endereco_evento ? `${evento.endereco_evento}, ${evento.numero_evento || 'S/N'}${evento.complemento_evento ? ', ' + evento.complemento_evento : ''}` : 'N/A')}</p>
                        <p><strong>Bairro:</strong> ${casa ? casa.bairro : (evento.bairro_evento || 'N/A')}</p>
                        <p><strong>Cidade:</strong> ${casa ? casa.cidade : (evento.cidade_evento || 'N/A')}</p>
                        
                        <h4 style="color: #666; margin: 1rem 0 0.8rem 0; border-bottom: 2px solid #DEB887; padding-bottom: 0.3rem;">‚è∞ Hor√°rios</h4>
                        <p><strong>Data:</strong> ${new Date(evento.data_evento).toLocaleDateString('pt-BR')}</p>
                        <p><strong>In√≠cio:</strong> ${evento.hora_entrada}</p>
                        <p><strong>T√©rmino:</strong> ${horaTermino}</p>
                        <p><strong>Dura√ß√£o:</strong> ${evento.duracao}h</p>
                    </div>
                </div>
            `;
            
            document.getElementById('escala_evento_id').value = eventoId;
            carregarPersonagensEscala(evento);
            carregarMotoristasEscala();
            motoristasEscalaSelecionados = escalacoesEventos[eventoId]?.motoristas || [];
            atualizarMotoristasEscala();
            
            showPage('escalar_evento');
        }
        
        // Fun√ß√£o para carregar relat√≥rio de escala√ß√µes
        function carregarRelatorioEscalacoes() {
            const lista = document.getElementById('listaRelatorioEscalacoes');
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            // Filtrar eventos passados que t√™m escala√ß√£o
            const eventosRealizados = eventos.filter(e => {
                const dataEvento = new Date(e.data_evento);
                dataEvento.setHours(0, 0, 0, 0);
                const escalacao = escalacoesEventos[e.id];
                const temEscalacao = escalacao && (
                    Object.keys(escalacao.personagens || {}).some(p => escalacao.personagens[p].length > 0) ||
                    (escalacao.motoristas && escalacao.motoristas.length > 0)
                );
                return dataEvento < hoje && temEscalacao;
            }).sort((a, b) => new Date(b.data_evento) - new Date(a.data_evento));
            
            if (eventosRealizados.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum evento realizado com escala√ß√£o</p>';
                return;
            }
            
            lista.innerHTML = '';
            eventosRealizados.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                const escalacao = escalacoesEventos[evento.id];
                
                // Calcular hora de t√©rmino
                const [horas, minutos] = evento.hora_entrada.split(':').map(Number);
                const totalMinutos = horas * 60 + minutos + (parseInt(evento.duracao) * 60);
                const horasSaida = Math.floor(totalMinutos / 60) % 24;
                const minutosSaida = totalMinutos % 60;
                const horaTermino = `${horasSaida.toString().padStart(2, '0')}:${minutosSaida.toString().padStart(2, '0')}`;
                
                // Obter escala√ß√£o
                let personagensEscalados = '';
                let motoristasEscalados = '';
                
                if (evento.personagens && evento.personagens.length > 0) {
                    personagensEscalados = evento.personagens.map(p => {
                        const elencoEscalado = escalacao?.personagens?.[p.id] || [];
                        const nomesElenco = elencoEscalado.map(eId => {
                            const membro = elenco.find(e => e.id == eId);
                            return membro ? membro.nome_completo : 'N/A';
                        }).join(', ');
                        return `${p.personagem}: ${nomesElenco || 'N√£o escalado'}`;
                    }).join('<br>');
                }
                
                if (escalacao?.motoristas && escalacao.motoristas.length > 0) {
                    motoristasEscalados = escalacao.motoristas.map(mId => {
                        const motorista = motoristas.find(m => m.id == mId);
                        return motorista ? motorista.nome_completo : 'N/A';
                    }).join(', ');
                }
                
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 10px; border: 2px solid #28a745;';
                card.innerHTML = `
                    <h4 style="color: #8B4513; margin-bottom: 1rem;">üìÖ ${new Date(evento.data_evento).toLocaleDateString('pt-BR')} - ${evento.hora_entrada} √†s ${horaTermino}</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <p><strong>Cliente:</strong> ${cliente ? cliente.nome_cliente : 'Cliente n√£o encontrado'}</p>
                            <p><strong>Aniversariante:</strong> ${evento.nome_aniversariante || (cliente ? cliente.nome_aniversariante : 'N/A')}</p>
                            <p><strong>Local:</strong> ${casa ? casa.nome_casa : (evento.outro_local ? 'Outro Local' : 'N/A')}</p>
                        </div>
                        <div>
                            <p><strong>Dura√ß√£o:</strong> ${evento.duracao}h</p>
                            <p><strong>Valor:</strong> R$ ${parseFloat(evento.valor_total || 0).toFixed(2).replace('.', ',')}</p>
                        </div>
                    </div>
                    ${personagensEscalados ? `
                        <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e9ecef; border-radius: 8px;">
                            <strong style="color: #8B4513;">üé≠ Personagens Escalados:</strong><br>
                            ${personagensEscalados}
                        </div>
                    ` : ''}
                    ${motoristasEscalados ? `
                        <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e9ecef; border-radius: 8px;">
                            <strong style="color: #8B4513;">üöó Motoristas:</strong> ${motoristasEscalados}
                        </div>
                    ` : ''}
                    <div style="text-align: right;">
                        <span style="background: #28a745; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">‚úÖ Evento Realizado</span>
                    </div>
                `;
                lista.appendChild(card);
            });
        }
        
        function carregarPersonagensEscala(evento) {
            const div = document.getElementById('personagensEscala');
            
            if (!evento.personagens || evento.personagens.length === 0) {
                div.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem; background: #f8f9fa; border-radius: 10px;">Nenhum personagem cadastrado para este evento</p>';
                return;
            }
            
            div.innerHTML = '';
            evento.personagens.forEach(personagemEvento => {
                const personagem = personagens.find(p => p.id === personagemEvento.id);
                if (!personagem) return;
                
                const escalacaoAtual = escalacoesEventos[evento.id]?.personagens?.[personagem.id] || [];
                
                const personagemDiv = document.createElement('div');
                personagemDiv.style.cssText = 'background: linear-gradient(145deg, #FFF8DC 0%, #F5F5DC 100%); padding: 1.5rem; margin-bottom: 1rem; border-radius: 15px; border: 2px solid #DEB887;';
                personagemDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="color: #8B4513; margin: 0; font-size: 1.2rem;">ü¶Å ${personagem.personagem}</h4>
                        <span style="background: #DAA520; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem;">Qtd: ${personagemEvento.quantidade_evento}</span>
                    </div>
                    <div style="display: flex; gap: 1rem; align-items: end;">
                        <div class="form-group" style="flex: 1;">
                            <label>Selecionar Elenco:</label>
                            <select id="elenco_select_${personagem.id}">
                                <option value="">Escolha um membro do elenco</option>
                                ${elenco.map(e => `<option value="${e.id}">${e.nome_completo}</option>`).join('')}
                            </select>
                        </div>
                        <button type="button" onclick="adicionarElencoPersonagem(${personagem.id})" style="background: #28a745; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-weight: bold;">‚ûï Adicionar</button>
                    </div>
                    <div id="elenco_escalado_${personagem.id}" style="margin-top: 1rem;"></div>
                `;
                div.appendChild(personagemDiv);
                
                // Atualizar elenco escalado para este personagem
                atualizarElencoEscalado(personagem.id, escalacaoAtual);
            });
        }
        
        function adicionarElencoPersonagem(personagemId) {
            const select = document.getElementById(`elenco_select_${personagemId}`);
            const elencoId = parseInt(select.value);
            
            if (!elencoId) {
                alert('Selecione um membro do elenco!');
                return;
            }
            
            const eventoId = parseInt(document.getElementById('escala_evento_id').value);
            
            // Inicializar escala√ß√£o se n√£o existir
            if (!escalacoesEventos[eventoId]) {
                escalacoesEventos[eventoId] = { personagens: {}, motoristas: [] };
            }
            if (!escalacoesEventos[eventoId].personagens[personagemId]) {
                escalacoesEventos[eventoId].personagens[personagemId] = [];
            }
            
            // Verificar se j√° foi escalado
            if (escalacoesEventos[eventoId].personagens[personagemId].includes(elencoId)) {
                alert('Este membro do elenco j√° foi escalado para este personagem!');
                return;
            }
            
            escalacoesEventos[eventoId].personagens[personagemId].push(elencoId);
            atualizarElencoEscalado(personagemId, escalacoesEventos[eventoId].personagens[personagemId]);
            select.value = '';
        }
        
        function atualizarElencoEscalado(personagemId, elencoIds) {
            const div = document.getElementById(`elenco_escalado_${personagemId}`);
            
            if (elencoIds.length === 0) {
                div.innerHTML = '<p style="color: #dc3545; font-weight: bold; text-align: center; padding: 1rem; background: #f8d7da; border-radius: 8px; margin: 0;">Nenhum elenco escalado</p>';
                return;
            }
            
            div.innerHTML = `
                <div style="background: #d4edda; padding: 1rem; border-radius: 8px;">
                    <h5 style="color: #155724; margin-bottom: 0.8rem; text-align: center;">üé≠ Elenco Escalado:</h5>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        ${elencoIds.map(eId => {
                            const membro = elenco.find(e => e.id == eId);
                            return membro ? `
                                <div style="background: #28a745; color: white; padding: 0.5rem 1rem; border-radius: 20px; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
                                    <span>${membro.nome_completo}</span>
                                    <button onclick="removerElencoPersonagem(${personagemId}, ${eId})" style="background: none; border: none; color: white; cursor: pointer; font-size: 1rem; padding: 0;">‚ùå</button>
                                </div>
                            ` : '';
                        }).join('')}
                    </div>
                </div>
            `;
        }
        
        function removerElencoPersonagem(personagemId, elencoId) {
            const eventoId = parseInt(document.getElementById('escala_evento_id').value);
            
            if (escalacoesEventos[eventoId]?.personagens?.[personagemId]) {
                escalacoesEventos[eventoId].personagens[personagemId] = 
                    escalacoesEventos[eventoId].personagens[personagemId].filter(id => id !== elencoId);
                atualizarElencoEscalado(personagemId, escalacoesEventos[eventoId].personagens[personagemId]);
            }
        }
        
        function carregarMotoristasEscala() {
            const select = document.getElementById('motorista_select');
            select.innerHTML = '<option value="">Escolha um motorista</option>';
            motoristas.forEach(m => {
                const option = document.createElement('option');
                option.value = m.id;
                option.textContent = `${m.nome_completo} - ${m.modelo_carro}`;
                select.appendChild(option);
            });
        }
        
        function adicionarMotoristaEscala() {
            const select = document.getElementById('motorista_select');
            const motoristaId = parseInt(select.value);
            
            if (!motoristaId) {
                alert('Selecione um motorista!');
                return;
            }
            
            if (motoristasEscalaSelecionados.includes(motoristaId)) {
                alert('Este motorista j√° foi adicionado!');
                return;
            }
            
            motoristasEscalaSelecionados.push(motoristaId);
            atualizarMotoristasEscala();
            select.value = '';
        }
        
        function atualizarMotoristasEscala() {
            const div = document.getElementById('motoristasEscala');
            
            if (motoristasEscalaSelecionados.length === 0) {
                div.innerHTML = '<p style="color: #dc3545; font-weight: bold; text-align: center; padding: 1rem; background: #f8d7da; border-radius: 8px;">Nenhum motorista escalado</p>';
                return;
            }
            
            div.innerHTML = `
                <div style="background: #d4edda; padding: 1rem; border-radius: 8px;">
                    <h5 style="color: #155724; margin-bottom: 0.8rem; text-align: center;">üöó Motoristas Escalados:</h5>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        ${motoristasEscalaSelecionados.map(mId => {
                            const motorista = motoristas.find(m => m.id == mId);
                            return motorista ? `
                                <div style="background: #17a2b8; color: white; padding: 0.8rem 1.2rem; border-radius: 20px; display: flex; align-items: center; gap: 0.8rem; font-size: 0.9rem;">
                                    <div>
                                        <div style="font-weight: bold;">${motorista.nome_completo}</div>
                                        <div style="font-size: 0.8rem; opacity: 0.9;">${motorista.modelo_carro}</div>
                                    </div>
                                    <button onclick="removerMotoristaEscala(${mId})" style="background: none; border: none; color: white; cursor: pointer; font-size: 1rem; padding: 0;">‚ùå</button>
                                </div>
                            ` : '';
                        }).join('')}
                    </div>
                </div>
            `;
        }
        
        function removerMotoristaEscala(motoristaId) {
            motoristasEscalaSelecionados = motoristasEscalaSelecionados.filter(id => id !== motoristaId);
            atualizarMotoristasEscala();
        }
        
        function salvarEscalacao(eventoId) {
            // Inicializar se n√£o existir
            if (!escalacoesEventos[eventoId]) {
                escalacoesEventos[eventoId] = { personagens: {}, motoristas: [] };
            }
            
            // Salvar motoristas
            escalacoesEventos[eventoId].motoristas = [...motoristasEscalaSelecionados];
            
            // Salvar no localStorage
            localStorage.setItem('escalacoes', JSON.stringify(escalacoesEventos));
            
            alert('‚úÖ Escala√ß√£o salva com sucesso!');
            showPage('eventos_futuros');
        }
        
        function alternarContratoEvento(eventoId) {
            const evento = eventos.find(e => e.id === eventoId);
            if (evento) {
                evento.contrato_aceito = !evento.contrato_aceito;
                localStorage.setItem('eventos', JSON.stringify(eventos));
                carregarEventosFuturos();
            }
        }
        
        function calcularHoraSaidaEvento(horaEntrada, duracao) {
            if (!horaEntrada || !duracao) return 'N/A';
            const [horas, minutos] = horaEntrada.split(':').map(Number);
            const totalMinutos = horas * 60 + minutos + (parseInt(duracao) * 60);
            const horasSaida = Math.floor(totalMinutos / 60) % 24;
            const minutosSaida = totalMinutos % 60;
            return `${horasSaida.toString().padStart(2, '0')}:${minutosSaida.toString().padStart(2, '0')}`;
        }
        
        function obterCorEvento(evento) {
            const agora = new Date();
            const dataEvento = new Date(evento.data_evento + 'T' + evento.hora_entrada + ':00');
            const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
            const dataEventoFim = new Date(evento.data_evento + 'T' + horaSaida + ':00');
            
            // Verificar se o evento j√° foi finalizado (passou da hora de sa√≠da)
            if (dataEventoFim <= agora) {
                return '#6c757d'; // Cinza para eventos finalizados
            }
            
            // Calcular dias restantes baseado na data atual
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            const dataEventoSemHora = new Date(evento.data_evento + 'T00:00:00');
            dataEventoSemHora.setHours(0, 0, 0, 0);
            const diasRestantes = Math.ceil((dataEventoSemHora - hoje) / (1000 * 60 * 60 * 24));
            
            // Prioridade para sinal n√£o pago (roxo)
            if (!evento.sinal_pago) return '#6f42c1';
            
            // Cores baseadas nos dias restantes
            if (diasRestantes === 0) return '#28a745'; // Verde para dia do evento
            if (diasRestantes === 1) return '#dc3545'; // Vermelho para 1 dia
            if (diasRestantes >= 2 && diasRestantes <= 4) return '#ffc107'; // Amarelo para 4-2 dias
            if (diasRestantes >= 5) return '#007bff'; // Azul para mais de 5 dias
            
            return '#007bff'; // Padr√£o azul
        }
        
        function obterStatusEvento(evento) {
            const agora = new Date();
            const dataEvento = new Date(evento.data_evento + 'T' + evento.hora_entrada + ':00');
            const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
            const dataEventoFim = new Date(evento.data_evento + 'T' + horaSaida + ':00');
            
            // Verificar se o evento j√° foi finalizado
            if (dataEventoFim <= agora) {
                return '‚ö´ Evento finalizado';
            }
            
            // Calcular dias restantes
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            const dataEventoSemHora = new Date(evento.data_evento + 'T00:00:00');
            dataEventoSemHora.setHours(0, 0, 0, 0);
            const diasRestantes = Math.ceil((dataEventoSemHora - hoje) / (1000 * 60 * 60 * 24));
            
            // Prioridade para sinal n√£o pago
            if (!evento.sinal_pago) return 'üü£ Sinal n√£o pago';
            
            // Status baseado nos dias restantes
            if (diasRestantes === 0) return 'üü¢ Dia do evento';
            if (diasRestantes === 1) return 'üî¥ 1 dia';
            if (diasRestantes >= 2 && diasRestantes <= 4) return 'üü° Entre 4 a 2 dias';
            if (diasRestantes >= 5) return 'üîµ Mais de 5 dias';
            
            return 'üîµ Mais de 5 dias';
        }
        
        function formatarData(data) {
            return new Date(data).toLocaleDateString('pt-BR', {
                weekday: 'short',
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }
        
        function carregarEventosFinalizados() {
            const lista = document.getElementById('listaEventosFinalizados');
            const agora = new Date();
            
            const eventosFinalizados = eventos.filter(evento => {
                const dataEvento = new Date(evento.data_evento);
                const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
                const [horas, minutos] = horaSaida.split(':').map(Number);
                dataEvento.setHours(horas, minutos, 0, 0);
                return dataEvento <= agora;
            }).sort((a, b) => new Date(b.data_evento) - new Date(a.data_evento));
            
            if (eventosFinalizados.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum evento finalizado</p>';
                return;
            }
            
            lista.innerHTML = '';
            eventosFinalizados.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                const valorTotal = parseFloat(evento.valor_total || 0);
                const valorSinal = parseFloat(evento.valor_sinal || 0);
                const valorRestante = valorTotal - valorSinal;
                
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid #e9ecef;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="color: #8B4513; margin: 0;">üéâ ${new Date(evento.data_evento).toLocaleDateString('pt-BR')} - ${evento.hora_entrada} √†s ${calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao)}</h4>
                        <span style="background: #6c757d; color: white; padding: 0.3rem 0.8rem; border-radius: 6px; font-size: 0.8rem; font-weight: 500;">
                            ‚úÖ FINALIZADO
                        </span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <p><strong>Cliente:</strong> ${cliente ? cliente.nome_cliente : 'N/A'}</p>
                            <p><strong>Aniversariante:</strong> ${cliente ? cliente.nome_aniversariante : (evento.nome_aniversariante || 'N/A')}</p>
                            <p><strong>Local:</strong> ${casa ? casa.nome_casa : (evento.outro_local ? 'Outro Local' : 'N/A')}</p>
                        </div>
                        <div>
                            <p><strong>Valor Total:</strong> R$ ${valorTotal.toFixed(2).replace('.', ',')}</p>
                            <p><strong>Sinal:</strong> R$ ${valorSinal.toFixed(2).replace('.', ',')} ${evento.sinal_pago ? '‚úÖ' : '‚ùå'}</p>
                            <p><strong>Restante:</strong> R$ ${valorRestante.toFixed(2).replace('.', ',')} ${evento.valor_restante_pago ? '‚úÖ' : '‚ùå'}</p>
                        </div>
                    </div>
                    
                    ${evento.personagens && evento.personagens.length > 0 ? `
                        <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e9ecef; border-radius: 8px;">
                            <strong>Personagens:</strong> ${evento.personagens.map(p => `${p.personagem} (${p.quantidade_evento}x)`).join(', ')}
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button onclick="gerarContrato(${evento.id})" style="background: #6c757d; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">üìÑ Gerar Contrato</button>
                    </div>
                `;
                lista.appendChild(card);
            });
        }
        
        function carregarRelatorioEscalacoes() {
            const lista = document.getElementById('listaRelatorioEscalacoes');
            const agora = new Date();
            
            const eventosFinalizadosComEscala = eventos.filter(evento => {
                const dataEvento = new Date(evento.data_evento);
                const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
                const [horas, minutos] = horaSaida.split(':').map(Number);
                dataEvento.setHours(horas, minutos, 0, 0);
                const escalacao = escalacoesEventos[evento.id];
                const temEscalacao = escalacao && (
                    Object.keys(escalacao.personagens || {}).some(p => escalacao.personagens[p].length > 0) ||
                    (escalacao.motoristas && escalacao.motoristas.length > 0)
                );
                return dataEvento <= agora && temEscalacao;
            }).sort((a, b) => new Date(b.data_evento) - new Date(a.data_evento));
            
            if (eventosFinalizadosComEscala.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhuma escala√ß√£o finalizada</p>';
                return;
            }
            
            lista.innerHTML = '';
            eventosFinalizadosComEscala.forEach(evento => {
                const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
                const casa = casas.find(c => c.id == evento.casa_festa);
                const escalacao = escalacoesEventos[evento.id];
                
                let personagensEscalados = '';
                let motoristasEscalados = '';
                
                if (evento.personagens && evento.personagens.length > 0) {
                    personagensEscalados = evento.personagens.map(p => {
                        const elencoEscalado = escalacao?.personagens?.[p.id] || [];
                        const nomesElenco = elencoEscalado.map(eId => {
                            const membro = elenco.find(e => e.id == eId);
                            return membro ? membro.nome_completo : 'N/A';
                        }).join(', ');
                        return `${p.personagem}: ${nomesElenco || 'N√£o escalado'}`;
                    }).join('<br>');
                }
                
                if (escalacao?.motoristas && escalacao.motoristas.length > 0) {
                    motoristasEscalados = escalacao.motoristas.map(mId => {
                        const motorista = motoristas.find(m => m.id == mId);
                        return motorista ? motorista.nome_completo : 'N/A';
                    }).join(', ');
                }
                
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 10px; border: 3px solid #6f42c1;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h4 style="color: #8B4513; margin: 0;">üìÖ ${new Date(evento.data_evento).toLocaleDateString('pt-BR')} - ${evento.hora_entrada} √†s ${calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao)}</h4>
                        <span style="background: #6f42c1; color: white; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
                            üìÖ ESCALA√á√ÉO FINALIZADA
                        </span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <p><strong>Cliente:</strong> ${cliente ? cliente.nome_cliente : 'N/A'}</p>
                            <p><strong>Aniversariante:</strong> ${cliente ? cliente.nome_aniversariante : (evento.nome_aniversariante || 'N/A')}</p>
                            <p><strong>Local:</strong> ${casa ? casa.nome_casa : (evento.outro_local ? 'Outro Local' : 'N/A')}</p>
                        </div>
                        <div>
                            <p><strong>Dura√ß√£o:</strong> ${evento.duracao}h</p>
                            <p><strong>Status:</strong> ‚úÖ Finalizado</p>
                        </div>
                    </div>
                    
                    ${personagensEscalados ? `
                        <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e8f5e8; border-radius: 8px;">
                            <strong>üé≠ Personagens Escalados:</strong><br>
                            ${personagensEscalados}
                        </div>
                    ` : ''}
                    
                    ${motoristasEscalados ? `
                        <div style="margin-bottom: 1rem; padding: 0.8rem; background: #e3f2fd; border-radius: 8px;">
                            <strong>üöó Motoristas:</strong> ${motoristasEscalados}
                        </div>
                    ` : ''}
                `;
                lista.appendChild(card);
            });
        }
        
        function gerarContrato(eventoId) {
            const evento = eventos.find(e => e.id === eventoId);
            const cliente = clientes.find(c => c.cpf_cliente.replace(/\D/g, '') === evento.cpf_cliente.replace(/\D/g, ''));
            const casa = casas.find(c => c.id == evento.casa_festa);
            
            const dataEvento = new Date(evento.data_evento).toLocaleDateString('pt-BR');
            const valorTotal = parseFloat(evento.valor_total || 0);
            const valorSinal = parseFloat(evento.valor_sinal || 0);
            const valorRestante = valorTotal - valorSinal;
            const horaSaida = calcularHoraSaidaEvento(evento.hora_entrada, evento.duracao);
            
            const contrato = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Contrato de Presta√ß√£o de Servi√ßos - BBB FESTA</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .header { text-align: center; margin-bottom: 30px; }
        .logo { font-size: 24px; font-weight: bold; color: #e91e63; }
        .section { margin-bottom: 20px; }
        .title { font-weight: bold; color: #333; }
        .info { background: #f5f5f5; padding: 10px; border-radius: 5px; }
        .payment { background: #e8f5e8; padding: 10px; border-radius: 5px; }
        .signature { margin-top: 50px; display: flex; justify-content: space-between; }
        .signature-box { width: 200px; text-align: center; border-top: 1px solid #000; padding-top: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo"> BBB FESTA </div>
        <h2>CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS</h2>
        <p>Contrato N¬∫: ${eventoId.toString().padStart(6, '0')}</p>
    </div>
    
    <div class="section">
        <div class="title">CONTRATANTE:</div>
        <div class="info">
            <strong>Nome:</strong> ${cliente ? cliente.nome_cliente : 'N/A'}<br>
            ${evento.nome_empresa_evento ? `<strong>Empresa:</strong> ${evento.nome_empresa_evento}<br>` : ''}
            <strong>${evento.tipo_documento_evento === 'cnpj' ? 'CNPJ' : 'CPF'}:</strong> ${evento.cpf_cliente}<br>
            <strong>Telefone:</strong> ${cliente ? cliente.telefone_cliente || 'N/A' : 'N/A'}<br>
            <strong>Email:</strong> ${cliente ? cliente.email_cliente || 'N/A' : 'N/A'}<br>
            <strong>Endere√ßo:</strong> ${cliente ? `${cliente.logradouro_cliente}, ${cliente.numero_cliente}${cliente.complemento_cliente ? ', ' + cliente.complemento_cliente : ''} - ${cliente.bairro_cliente}` : 'N/A'}<br>
            ${cliente ? `${cliente.cidade_cliente} - ${cliente.estado_cliente}, CEP: ${cliente.cep_cliente}` : 'N/A'}
        </div>
    </div>
    
    <div class="section">
        <div class="title">ANIVERSARIANTE:</div>
        <div class="info">
            <strong>Nome:</strong> ${cliente ? cliente.nome_aniversariante : (evento.nome_aniversariante || 'N/A')}<br>
            <strong>Idade:</strong> ${cliente ? calcularIdade(cliente.data_nascimento_aniversariante) : (evento.idade_aniversariante || 'N/A')} anos<br>
            <strong>Data de Nascimento:</strong> ${cliente ? new Date(cliente.data_nascimento_aniversariante).toLocaleDateString('pt-BR') : (evento.data_nascimento_aniversariante ? new Date(evento.data_nascimento_aniversariante).toLocaleDateString('pt-BR') : 'N/A')}
        </div>
    </div>
    
    <div class="section">
        <div class="title">EVENTO:</div>
        <div class="info">
            <strong>Data:</strong> ${dataEvento}<br>
            <strong>Hor√°rio:</strong> ${evento.hora_entrada} √†s ${horaSaida} (${evento.duracao}h)<br>
            <strong>Local:</strong> ${casa ? casa.nome_casa : (evento.outro_local ? 'Outro Local' : 'N/A')}<br>
            <strong>Endere√ßo:</strong> ${casa ? `${casa.logradouro}, ${casa.numero}${casa.complemento ? ', ' + casa.complemento : ''} - ${casa.bairro}` : (evento.endereco_evento ? `${evento.endereco_evento}, ${evento.numero_evento || 'S/N'}${evento.complemento_evento ? ', ' + evento.complemento_evento : ''} - ${evento.bairro_evento}` : 'N/A')}<br>
            ${casa ? `${casa.cidade} - ${casa.estado}, CEP: ${casa.cep}` : (evento.cidade_evento ? `${evento.cidade_evento} - ${evento.estado_evento}, CEP: ${evento.cep_evento}` : 'N/A')}<br>
            <strong>Telefone do Local:</strong> ${casa ? casa.telefone || 'N/A' : (evento.telefone_evento || 'N/A')}<br>
            ${evento.personagens && evento.personagens.length > 0 ? `<strong>Personagens:</strong> ${evento.personagens.map(p => `${p.personagem} (${p.quantidade_evento}x)`).join(', ')}<br>` : ''}
            <strong>Observa√ß√µes:</strong> ${evento.observacoes || 'Nenhuma'}
        </div>
    </div>
    
    <div class="section">
        <div class="title">VALORES E PAGAMENTOS:</div>
        <div class="payment">
            <strong>Valor Total:</strong> R$ ${valorTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2})}<br>
            ${evento.desconto && parseFloat(evento.desconto) > 0 ? `<strong>Desconto:</strong> R$ ${parseFloat(evento.desconto).toLocaleString('pt-BR', {minimumFractionDigits: 2})}<br>` : ''}
            ${evento.deslocamento && parseFloat(evento.deslocamento) > 0 ? `<strong>Deslocamento:</strong> R$ ${parseFloat(evento.deslocamento).toLocaleString('pt-BR', {minimumFractionDigits: 2})}<br>` : ''}
            <strong>Valor do Sinal:</strong> R$ ${valorSinal.toLocaleString('pt-BR', {minimumFractionDigits: 2})} ${evento.sinal_pago ? '‚úÖ PAGO' : '‚ùå PENDENTE'}<br>
            <strong>Valor Restante:</strong> R$ ${valorRestante.toLocaleString('pt-BR', {minimumFractionDigits: 2})} ${evento.valor_restante_pago ? '‚úÖ PAGO' : '‚ùå PENDENTE'}<br>
            <strong>Forma de Pagamento Sinal:</strong> ${evento.forma_pagamento_sinal || 'N/A'}<br>
            <strong>Forma de Pagamento Restante:</strong> ${evento.forma_pagamento_restante || 'N/A'}<br>
            <strong>Confirma√ß√£o:</strong> ${evento.confirmado ? '‚úÖ CONFIRMADO' : '‚ùå PENDENTE'}<br>
            <strong>Status do Contrato:</strong> ${evento.status_contrato === 'aceito' ? '‚úÖ ACEITO' : '‚è≥ PENDENTE DE CONFIRMA√á√ÉO'}<br>
            ${evento.data_pagamento_sinal ? `<strong>Data Pagamento Sinal:</strong> ${evento.data_pagamento_sinal}<br>` : ''}
            ${evento.data_pagamento_restante ? `<strong>Data Pagamento Restante:</strong> ${evento.data_pagamento_restante}<br>` : ''}
        </div>
    </div>
    
    <div class="section">
        <p><strong>CL√ÅUSULAS:</strong></p>
        <p>1. A BBB FESTA se compromete a prestar os servi√ßos de anima√ß√£o conforme acordado.</p>
        <p>2. O pagamento dever√° ser efetuado conforme as condi√ß√µes estabelecidas.</p>
        <p>3. Cancelamentos com menos de 7 dias de anteced√™ncia n√£o ter√£o devolu√ß√£o do sinal.</p>
        <p>4. A BBB FESTA n√£o se responsabiliza por danos causados por terceiros durante o evento.</p>
    </div>
    
    <div class="signature">
        <div class="signature-box">
            <div>BBB FESTA</div>
            <div>CONTRATADA</div>
        </div>
        <div class="signature-box">
            <div>${cliente ? cliente.nome_cliente : 'CONTRATANTE'}</div>
            <div>CONTRATANTE</div>
        </div>
    </div>
    
    <div style="text-align: center; margin-top: 30px; font-size: 12px; color: #666;">
        Contrato gerado em ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}
    </div>
</body>
</html>`;
            
            const novaJanela = window.open('', '_blank');
            novaJanela.document.write(contrato);
            novaJanela.document.close();
        }
        
        function alternarStatusContrato(eventoId, status) {
            const evento = eventos.find(e => e.id === eventoId);
            if (evento) {
                evento.status_contrato = status;
                localStorage.setItem('eventos', JSON.stringify(eventos));
                // Recarregar a p√°gina atual
                const paginaAtual = document.querySelector('.page.active').id;
                if (paginaAtual === 'eventos_futuros') carregarEventosFuturos();
                else if (paginaAtual === 'todos_eventos') carregarTodosEventos();
                else if (paginaAtual === 'confirmar_dados') carregarConfirmarDados();
                else if (paginaAtual === 'equipe_escalada') carregarEquipeEscalada();
                else if (paginaAtual === 'eventos_pendente_escala') carregarEventosPendenteEscala();
            }
        }
        
        function registrarPagamento(eventoId, tipo) {
            const evento = eventos.find(e => e.id === eventoId);
            if (evento) {
                const agora = new Date();
                const dataHora = `${agora.toLocaleDateString('pt-BR')} √†s ${agora.toLocaleTimeString('pt-BR')}`;
                
                if (tipo === 'sinal') {
                    evento.sinal_pago = !evento.sinal_pago;
                    if (evento.sinal_pago) {
                        const agora = new Date();
                        evento.data_pagamento_sinal = `${agora.toLocaleDateString('pt-BR')} √†s ${agora.toLocaleTimeString('pt-BR')}`;
                    } else {
                        evento.data_pagamento_sinal = null;
                    }
                } else if (tipo === 'restante') {
                    evento.valor_restante_pago = !evento.valor_restante_pago;
                    if (evento.valor_restante_pago) {
                        const agora = new Date();
                        evento.data_pagamento_restante = `${agora.toLocaleDateString('pt-BR')} √†s ${agora.toLocaleTimeString('pt-BR')}`;
                    } else {
                        evento.data_pagamento_restante = null;
                    }
                }
                
                localStorage.setItem('eventos', JSON.stringify(eventos));
                // Recarregar a p√°gina atual
                const paginaAtual = document.querySelector('.page.active').id;
                if (paginaAtual === 'eventos_futuros') carregarEventosFuturos();
                else if (paginaAtual === 'todos_eventos') carregarTodosEventos();
                else if (paginaAtual === 'confirmar_dados') carregarConfirmarDados();
                else if (paginaAtual === 'equipe_escalada') carregarEquipeEscalada();
                else if (paginaAtual === 'eventos_pendente_escala') carregarEventosPendenteEscala();
            }
        }

        // Event listeners para formata√ß√£o autom√°tica
        document.addEventListener('input', function(e) {
            if (e.target.id === 'cpf_cliente') {
                if (tipoDocumento === 'cpf') {
                    e.target.value = formatarCPF(e.target.value);
                } else {
                    e.target.value = formatarCNPJ(e.target.value);
                }
            }
            if (e.target.id === 'edit_cpf_cliente') {
                if (tipoDocumentoEdicao === 'cpf') {
                    e.target.value = formatarCPF(e.target.value);
                } else {
                    e.target.value = formatarCNPJ(e.target.value);
                }
            }
            if (e.target.id === 'cpf_evento') {
                if (tipoDocumentoEvento === 'cpf') {
                    e.target.value = formatarCPF(e.target.value);
                } else {
                    e.target.value = formatarCNPJ(e.target.value);
                }
            }
            if (e.target.id === 'edit_cpf_evento') {
                if (tipoDocumentoEventoEdicao === 'cpf') {
                    e.target.value = formatarCPF(e.target.value);
                } else {
                    e.target.value = formatarCNPJ(e.target.value);
                }
            }
            // Formata√ß√£o de moeda para campos de valores
            if (e.target.id === 'valor_sinal' || e.target.id === 'desconto' || e.target.id === 'deslocamento' ||
                e.target.id === 'edit_valor_sinal' || e.target.id === 'edit_desconto' || e.target.id === 'edit_deslocamento') {
                e.target.value = formatarMoeda(e.target.value);
            }
        });
        // Fun√ß√µes auxiliares para formata√ß√£o de moeda
        function formatarMoeda(valor) {
            let v = valor.replace(/\D/g, '');
            v = (v/100).toFixed(2) + '';
            v = v.replace('.', ',');
            v = v.replace(/(\d)(\d{3})(\d{3}),/g, '$1.$2.$3,');
            v = v.replace(/(\d)(\d{3}),/g, '$1.$2,');
            return 'R$ ' + v;
        }
        
        function removerFormatacaoMoeda(valor) {
            if (!valor) return '0';
            return valor.replace(/[R$\s\.]/g, '').replace(',', '.');
        }
        
        function calcularValorTotalEvento() {
            let valorTotal = 0;
            
            // Somar valores dos personagens selecionados
            if (typeof personagensSelecionadosEvento !== 'undefined') {
                personagensSelecionadosEvento.forEach(p => {
                    valorTotal += parseFloat(p.valor || 0) * parseInt(p.quantidade_evento || 1);
                });
            }
            
            // Aplicar desconto e deslocamento
            const desconto = parseFloat(removerFormatacaoMoeda(document.getElementById('desconto')?.value)) || 0;
            const deslocamento = parseFloat(removerFormatacaoMoeda(document.getElementById('deslocamento')?.value)) || 0;
            
            valorTotal = valorTotal - desconto + deslocamento;
            
            // Atualizar campo valor total
            if (document.getElementById('valor_total')) {
                document.getElementById('valor_total').value = formatarMoeda((valorTotal * 100).toString());
            }
            
            // Calcular valor que falta receber
            const valorSinal = parseFloat(removerFormatacaoMoeda(document.getElementById('valor_sinal')?.value)) || 0;
            const valorAvulso = parseFloat(removerFormatacaoMoeda(document.getElementById('valor_avulso')?.value)) || 0;
            
            let valorFaltaReceber = valorTotal - valorSinal - valorAvulso;
            
            // Se pagamento total foi pago, zerar valor a receber
            const pagamentoTotalPago = document.getElementById('pagamento_total_pago')?.value === 'true';
            if (pagamentoTotalPago) {
                valorFaltaReceber = 0;
            }
            
            if (document.getElementById('valor_falta_receber')) {
                document.getElementById('valor_falta_receber').value = formatarMoeda((valorFaltaReceber * 100).toString());
            }
        }
        
        // Fun√ß√µes de carregamento de listas
        function carregarPersonagens() {
            const lista = document.getElementById('listaPersonagens');
            if (personagens.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum personagem cadastrado</p>';
                return;
            }
            
            lista.innerHTML = '';
            personagens.forEach(p => {
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid #e9ecef;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <h4 style="color: #8B4513; margin-bottom: 0.5rem;">ü¶Å ${p.personagem}</h4>
                            <p><strong>Figurino:</strong> ${p.figurino || 'N/A'}</p>
                            <p><strong>Tema:</strong> ${p.tema || 'N/A'}</p>
                            <p><strong>Quantidade:</strong> ${p.quantidade}</p>
                            <p><strong>Valor:</strong> R$ ${parseFloat(p.valor).toFixed(2).replace('.', ',')}</p>
                            <p><strong>Cach√™ Individual:</strong> R$ ${parseFloat(p.cache_individual || 0).toFixed(2).replace('.', ',')}</p>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <button onclick="editarPersonagem(${p.id})" style="background: #007bff; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">
                                ‚úèÔ∏è Editar
                            </button>
                            <button onclick="excluirPersonagem(${p.id})" style="background: #dc3545; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">
                                üóëÔ∏è Excluir
                            </button>
                        </div>
                    </div>
                `;
                lista.appendChild(card);
            });
        }
        
        function carregarElenco() {
            const lista = document.getElementById('listaElenco');
            if (elenco.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666; padding: 2rem;">Nenhum membro do elenco cadastrado</p>';
                return;
            }
            
            lista.innerHTML = '';
            elenco.forEach(e => {
                const card = document.createElement('div');
                card.style.cssText = 'background: #f8f9fa; padding: 1.5rem; margin-bottom: 1rem; border-radius: 8px; border: 1px solid #e9ecef;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <h4 style="color: #8B4513; margin-bottom: 0.5rem;">üé≠ ${e.nome_completo}</h4>
                            <p><strong>CPF:</strong> ${e.cpf}</p>
                            <p><strong>Perfil:</strong> ${e.perfil}</p>
                            <p><strong>WhatsApp:</strong> ${e.whatsapp || 'N/A'}</p>
                            <p><strong>Altura:</strong> ${e.altura ? e.altura + ' cm' : 'N/A'}</p>
                            <p><strong>Cal√ßado:</strong> ${e.calcado || 'N/A'}</p>
                            <p><strong>PIX:</strong> ${e.chave_pix || 'N/A'}</p>
                            <p><strong>Cach√™:</strong> R$ ${parseFloat(e.cache || 0).toFixed(2).replace('.', ',')}</p>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <button onclick="excluirElenco(${e.id})" style="background: #dc3545; color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem;">
                                üóëÔ∏è Excluir
                            </button>
                        </div>
                    </div>
                `;
                lista.appendChild(card);
            });
        }
        
        function excluirPersonagem(id) {
            if (confirm('Tem certeza que deseja excluir este personagem?')) {
                personagens = personagens.filter(p => p.id !== id);
                localStorage.setItem('personagens', JSON.stringify(personagens));
                carregarPersonagens();
            }
        }
        
        function excluirElenco(id) {
            if (confirm('Tem certeza que deseja excluir este membro do elenco?')) {
                elenco = elenco.filter(e => e.id !== id);
                localStorage.setItem('elenco', JSON.stringify(elenco));
                carregarElenco();
            }
        }
        
        function editarPersonagem(id) {
            const personagem = personagens.find(p => p.id === id);
            if (personagem) {
                document.getElementById('edit_personagem_id').value = id;
                document.getElementById('edit_personagem').value = personagem.personagem;
                document.getElementById('edit_figurino').value = personagem.figurino || '';
                document.getElementById('edit_tema').value = personagem.tema || '';
                document.getElementById('edit_quantidade').value = personagem.quantidade;
                document.getElementById('edit_valor').value = formatarMoeda((parseFloat(personagem.valor) * 100).toString());
                document.getElementById('edit_cache_personagem').value = formatarMoeda((parseFloat(personagem.cache_individual || 0) * 100).toString());
                showPage('editar_personagem');
            }
        }
        
        // Fun√ß√µes placeholder para outras funcionalidades
        function carregarMotoristas() { console.log('carregarMotoristas'); }
        function carregarCasas() { console.log('carregarCasas'); }
        function carregarClientes() { console.log('carregarClientes'); }
        function carregarTodosEventos() { console.log('carregarTodosEventos'); }
        function carregarEventosFuturos() { console.log('carregarEventosFuturos'); }
        function carregarConfirmarDados() { console.log('carregarConfirmarDados'); }
        function carregarEquipeEscalada() { console.log('carregarEquipeEscalada'); }
        function carregarEventosPendenteEscala() { console.log('carregarEventosPendenteEscala'); }
        function carregarRelatorioEscalacoes() { console.log('carregarRelatorioEscalacoes'); }
        function carregarEventosFinalizados() { console.log('carregarEventosFinalizados'); }
        function carregarRelatorioConfirmacao() { console.log('carregarRelatorioConfirmacao'); }
        function carregarPersonagensManutencao() { console.log('carregarPersonagensManutencao'); }
        function carregarManutencoes() { console.log('carregarManutencoes'); }
        function carregarPagamentosReceber() { console.log('carregarPagamentosReceber'); }
        function carregarPagamentosPagos() { console.log('carregarPagamentosPagos'); }
        function calcularTotalAReceber() { return 0; }
        
        function aplicarPermissoes(permissoes) {
            console.log('Aplicando permiss√µes:', permissoes);
        }
        
    </script>
</body>
</html>